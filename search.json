[
  {
    "objectID": "toolloop.html",
    "href": "toolloop.html",
    "title": "Tool loop",
    "section": "",
    "text": "import os\n# os.environ['ANTHROPIC_LOG'] = 'debug'\nfrom IPython.display import display, Markdown, clear_output\nfrom pprint import pprint\nfrom cachy import enable_cachy\nenable_cachy()\nmodel = models[1]\nmodel\n\n'claude-sonnet-4-5'",
    "crumbs": [
      "Tool loop"
    ]
  },
  {
    "objectID": "toolloop.html#problem-setup",
    "href": "toolloop.html#problem-setup",
    "title": "Tool loop",
    "section": "Problem setup",
    "text": "Problem setup\nAnthropic provides an interesting example of using tools to mock up a hypothetical ordering system. We’re going to take it a step further, and show how we can dramatically simplify the process, whilst completing more complex tasks.\nWe’ll start by defining the same mock customer/order data as in Anthropic’s example, plus create a entity relationship between customers and orders:\n\ndef _get_orders_customers():\n    orders = {\n        \"O1\": dict(id=\"O1\", product=\"Widget A\", quantity=2, price=19.99, status=\"Shipped\"),\n        \"O2\": dict(id=\"O2\", product=\"Gadget B\", quantity=1, price=49.99, status=\"Processing\"),\n        \"O3\": dict(id=\"O3\", product=\"Gadget B\", quantity=2, price=49.99, status=\"Shipped\")}\n\n    customers = {\n        \"C1\": dict(name=\"John Doe\", email=\"john@example.com\", phone=\"123-456-7890\",\n                   orders=[orders['O1'], orders['O2']]),\n        \"C2\": dict(name=\"Jane Smith\", email=\"jane@example.com\", phone=\"987-654-3210\",\n                   orders=[orders['O3']])\n    }\n    return orders, customers\n\n\norders, customers = _get_orders_customers()\n\nWe can now define the same functions from the original example – but note that we don’t need to manually create the large JSON schema, since Claudette handles all that for us automatically from the functions directly. We’ll add some extra functionality to update order details when cancelling too.\n\ndef get_customer_info(\n    customer_id:str # ID of the customer\n): # Customer's name, email, phone number, and list of orders\n    \"Retrieves a customer's information and their orders based on the customer ID\"\n    print(f'- Retrieving customer {customer_id}')\n    return customers.get(customer_id, \"Customer not found\")\n\ndef get_order_details(\n    order_id:str # ID of the order\n): # Order's ID, product name, quantity, price, and order status\n    \"Retrieves the details of a specific order based on the order ID\"\n    print(f'- Retrieving order {order_id}')\n    return orders.get(order_id, \"Order not found\")\n\ndef cancel_order(\n    order_id:str # ID of the order to cancel\n)-&gt;bool: # True if the cancellation is successful\n    \"Cancels an order based on the provided order ID\"\n    print(f'- Cancelling order {order_id}')\n    if order_id not in orders: return False\n    orders[order_id]['status'] = 'Cancelled'\n    return True\n\nWe’re now ready to start our chat.",
    "crumbs": [
      "Tool loop"
    ]
  },
  {
    "objectID": "toolloop.html#manual-tool-use",
    "href": "toolloop.html#manual-tool-use",
    "title": "Tool loop",
    "section": "Manual tool use",
    "text": "Manual tool use\n\ntools = [get_customer_info, get_order_details, cancel_order]\n\n\nchat = Chat(model, tools=tools)\n\nWe’ll start with the same request as Anthropic showed:\n\nr = chat('Can you tell me the email address for customer C1?')\nprint(r.stop_reason)\nr.content\n\n- Retrieving customer C1\ntool_use\n\n\n[ToolUseBlock(id='toolu_01LJ2mkQDqRdToAFHbCosv26', input={'customer_id': 'C1'}, name='get_customer_info', type='tool_use')]\n\n\nClaude asks us to use a tool. Claudette handles that automatically by just calling it again:\n\nr = chat()\ncontents(r)\n\n'The email address for customer C1 (John Doe) is **john@example.com**.'\n\n\nLet’s consider a more complex case than in the original example – what happens if a customer wants to cancel all of their orders?\n\nchat = Chat(model, tools=tools)\nr = chat('Please cancel all orders for customer C1 for me.')\nprint(r.stop_reason)\nr.content\n\n- Retrieving customer C1\ntool_use\n\n\n[TextBlock(citations=None, text=\"I'll help you cancel all orders for customer C1. First, let me retrieve the customer's information to see what orders they have.\", type='text'),\n ToolUseBlock(id='toolu_01G48VxPvsqRmUfRNWbz5JAf', input={'customer_id': 'C1'}, name='get_customer_info', type='tool_use')]",
    "crumbs": [
      "Tool loop"
    ]
  },
  {
    "objectID": "toolloop.html#tool-loop",
    "href": "toolloop.html#tool-loop",
    "title": "Tool loop",
    "section": "Tool loop",
    "text": "Tool loop\nThis is the start of a multi-stage tool use process. Doing it manually step by step is inconvenient, so let’s write a function to handle this for us:\n\nsource\n\nChat.toolloop\n\ndef toolloop(\n    pr, # Prompt to pass to Claude\n    max_steps:int=10, # Maximum number of tool requests to loop through\n    cont_func:callable=noop, # Function that stops loop if returns False\n    final_prompt:str='You have no more tool uses. Please summarize your findings. If you did not complete your goal please tell the user what further work needs to be done so they can choose how best to proceed.', # Prompt to add if last message is a tool call\n    temp:NoneType=None, # Temperature\n    maxtok:int=4096, # Maximum tokens\n    maxthinktok:int=0, # Maximum thinking tokens\n    stream:bool=False, # Stream response?\n    prefill:str='', # Optional prefill to pass to Claude as start of its response\n    tool_choice:Optional=None, # Optionally force use of some tool\n):\n\nAdd prompt pr to dialog and get a response from Claude, automatically following up with tool_use messages\n\n\nExported source\n_final_prompt = \"You have no more tool uses. Please summarize your findings. If you did not complete your goal please tell the user what further work needs to be done so they can choose how best to proceed.\"\n\n\n\n\nExported source\n@patch\n@delegates(Chat.__call__)\ndef toolloop(self:Chat,\n             pr, # Prompt to pass to Claude\n             max_steps=10, # Maximum number of tool requests to loop through\n             cont_func:callable=noop, # Function that stops loop if returns False\n             final_prompt=_final_prompt, # Prompt to add if last message is a tool call\n             **kwargs):\n    \"Add prompt `pr` to dialog and get a response from Claude, automatically following up with `tool_use` messages\"\n    @save_iter\n    def _f(o):\n        init_n = len(self.h)\n        r = self(pr, **kwargs)\n        yield r\n        if len(self.last)&gt;1: yield self.last[1]\n        for i in range(max_steps-1):\n            if self.c.stop_reason!='tool_use': break\n            r = self(final_prompt if i==max_steps-2 else None, **kwargs)\n            yield r\n            if len(self.last)&gt;1: yield self.last[1]\n            if not cont_func(*self.h[-3:]): break\n        o.value = self.h[init_n+1:]\n    return _f()\n\n\ntoolloop returns an iterable of assistant messages:\n\nchat = Chat(model, tools=tools)\npr = 'Can you tell me the email address for customer C1?'\nr = chat.toolloop(pr)\nfor o in r: display(o)\n\n- Retrieving customer C1\n\n\n[ToolUseBlock(id=‘toolu_01LJ2mkQDqRdToAFHbCosv26’, input={‘customer_id’: ‘C1’}, name=‘get_customer_info’, type=‘tool_use’)]\n\n\nid: msg_01F1ruk8y7TsTrhpWTkBc67e\ncontent: [{'id': 'toolu_01LJ2mkQDqRdToAFHbCosv26', 'input': {'customer_id': 'C1'}, 'name': 'get_customer_info', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 757, 'output_tokens': 58, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{ 'content': [ { 'content': \"{'name': 'John Doe', 'email': 'john@example.com', \"\n                            \"'phone': '123-456-7890', 'orders': [{'id': 'O1', \"\n                            \"'product': 'Widget A', 'quantity': 2, 'price': \"\n                            \"19.99, 'status': 'Shipped'}, {'id': 'O2', \"\n                            \"'product': 'Gadget B', 'quantity': 1, 'price': \"\n                            \"49.99, 'status': 'Processing'}]}\",\n                 'tool_use_id': 'toolu_01LJ2mkQDqRdToAFHbCosv26',\n                 'type': 'tool_result'}],\n  'role': 'user'}\n\n\nThe email address for customer C1 (John Doe) is john@example.com.\n\n\nid: msg_019Z6rMioA6RExGgXKGnusiM\ncontent: [{'citations': None, 'text': 'The email address for customer C1 (John Doe) is **john@example.com**.', 'type': 'text'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 953, 'output_tokens': 24, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nThe full set of tool loop messages is stored in the value attr:\n\npprint(r.value, width=120)\n\n[{'content': [{'id': 'toolu_01LJ2mkQDqRdToAFHbCosv26',\n               'input': {'customer_id': 'C1'},\n               'name': 'get_customer_info',\n               'type': 'tool_use'}],\n  'role': 'assistant'},\n {'content': [{'content': \"{'name': 'John Doe', 'email': 'john@example.com', 'phone': '123-456-7890', 'orders': \"\n                          \"[{'id': 'O1', 'product': 'Widget A', 'quantity': 2, 'price': 19.99, 'status': 'Shipped'}, \"\n                          \"{'id': 'O2', 'product': 'Gadget B', 'quantity': 1, 'price': 49.99, 'status': \"\n                          \"'Processing'}]}\",\n               'tool_use_id': 'toolu_01LJ2mkQDqRdToAFHbCosv26',\n               'type': 'tool_result'}],\n  'role': 'user'},\n {'content': [{'text': 'The email address for customer C1 (John Doe) is **john@example.com**.', 'type': 'text'}],\n  'role': 'assistant'}]\n\n\nLet’s see if it can handle the multi-stage process now:\n\norders, customers = _get_orders_customers()\n\n\nchat = Chat(model, tools=tools)\nr = chat.toolloop('Please cancel all orders for customer C1 for me.')\nfor o in r: display(o)\n\n- Retrieving customer C1\n\n\nI’ll help you cancel all orders for customer C1. First, let me retrieve the customer’s information to see what orders they have.\n\n\nid: msg_01XdX15ZJuePtveCDsM41WMm\ncontent: [{'citations': None, 'text': \"I'll help you cancel all orders for customer C1. First, let me retrieve the customer's information to see what orders they have.\", 'type': 'text'}, {'id': 'toolu_01G48VxPvsqRmUfRNWbz5JAf', 'input': {'customer_id': 'C1'}, 'name': 'get_customer_info', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 757, 'output_tokens': 87, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{ 'content': [ { 'content': \"{'name': 'John Doe', 'email': 'john@example.com', \"\n                            \"'phone': '123-456-7890', 'orders': [{'id': 'O1', \"\n                            \"'product': 'Widget A', 'quantity': 2, 'price': \"\n                            \"19.99, 'status': 'Shipped'}, {'id': 'O2', \"\n                            \"'product': 'Gadget B', 'quantity': 1, 'price': \"\n                            \"49.99, 'status': 'Processing'}]}\",\n                 'tool_use_id': 'toolu_01G48VxPvsqRmUfRNWbz5JAf',\n                 'type': 'tool_result'}],\n  'role': 'user'}\n\n\n- Cancelling order O1\n- Cancelling order O2\n\n\nNow I can see that customer C1 (John Doe) has 2 orders: - Order O1: Widget A (Status: Shipped) - Order O2: Gadget B (Status: Processing)\nLet me cancel both orders for you.\n\n\nid: msg_01CWangwZyHeqyk5m8MeSwP4\ncontent: [{'citations': None, 'text': 'Now I can see that customer C1 (John Doe) has 2 orders:\\n- Order O1: Widget A (Status: Shipped)\\n- Order O2: Gadget B (Status: Processing)\\n\\nLet me cancel both orders for you.', 'type': 'text'}, {'id': 'toolu_01Lm2DE8sU5kBASiTXDa77zP', 'input': {'order_id': 'O1'}, 'name': 'cancel_order', 'type': 'tool_use'}, {'id': 'toolu_01CQ7U8kyyvWRE8kTGfxVto5', 'input': {'order_id': 'O2'}, 'name': 'cancel_order', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 981, 'output_tokens': 154, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{ 'content': [ { 'content': 'True',\n                 'tool_use_id': 'toolu_01Lm2DE8sU5kBASiTXDa77zP',\n                 'type': 'tool_result'},\n               { 'content': 'True',\n                 'tool_use_id': 'toolu_01CQ7U8kyyvWRE8kTGfxVto5',\n                 'type': 'tool_result'}],\n  'role': 'user'}\n\n\nPerfect! I’ve successfully cancelled all orders for customer C1 (John Doe): - ✓ Order O1 (Widget A) - Cancelled - ✓ Order O2 (Gadget B) - Cancelled\nBoth orders have been cancelled successfully.\n\n\nid: msg_0133SZjYiBzUkej4NSzChNWh\ncontent: [{'citations': None, 'text': \"Perfect! I've successfully cancelled all orders for customer C1 (John Doe):\\n- ✓ Order O1 (Widget A) - Cancelled\\n- ✓ Order O2 (Gadget B) - Cancelled\\n\\nBoth orders have been cancelled successfully.\", 'type': 'text'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 1200, 'output_tokens': 65, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nOK Claude thinks the orders were cancelled – let’s check one:\n\nfor o in chat.toolloop('What is the status of order O2?'): display(o)\n\n- Retrieving order O2\n\n\nLet me check the current status of order O2 for you.\n\n\nid: msg_016cS3SURc48upqKf4hBLPMX\ncontent: [{'citations': None, 'text': 'Let me check the current status of order O2 for you.', 'type': 'text'}, {'id': 'toolu_01Kzj8EBHHxbTAnrohSNt7vk', 'input': {'order_id': 'O2'}, 'name': 'get_order_details', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 1277, 'output_tokens': 73, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{ 'content': [ { 'content': \"{'id': 'O2', 'product': 'Gadget B', 'quantity': \"\n                            \"1, 'price': 49.99, 'status': 'Cancelled'}\",\n                 'tool_use_id': 'toolu_01Kzj8EBHHxbTAnrohSNt7vk',\n                 'type': 'tool_result'}],\n  'role': 'user'}\n\n\nOrder O2 is now showing a status of Cancelled. This confirms that the cancellation we performed earlier was successful. The order details are: - Order ID: O2 - Product: Gadget B - Quantity: 1 - Price: $49.99 - Status: Cancelled\n\n\nid: msg_01NLEeZkoDPTVyps2dJoYC4x\ncontent: [{'citations': None, 'text': 'Order O2 is now showing a status of **Cancelled**. This confirms that the cancellation we performed earlier was successful. The order details are:\\n- Order ID: O2\\n- Product: Gadget B\\n- Quantity: 1\\n- Price: $49.99\\n- Status: Cancelled', 'type': 'text'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 1406, 'output_tokens': 71, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nIf we run out of tool loops lets see what happens:\n\ndef mydiv(a:float, b:float):\n    \"Divide two numbers\"\n    return a / b\n\n\nchat = Chat(model, tools=[mydiv])\nr = chat.toolloop('Please calculate this sequence using your tools: 43/23454; 652/previous result; 6843/previous result; 321/previous result', max_steps=2)\nfor o in r: display(o)\n\nI’ll calculate this sequence step by step, using the result from each division as the divisor for the next operation.\n\n\nid: msg_012jpk6qp7u58WMkKv5VWwsv\ncontent: [{'citations': None, 'text': \"I'll calculate this sequence step by step, using the result from each division as the divisor for the next operation.\", 'type': 'text'}, {'id': 'toolu_01TcqArsz5skzgeZSHACNpFL', 'input': {'a': 43, 'b': 23454}, 'name': 'mydiv', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 607, 'output_tokens': 95, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{ 'content': [ { 'content': '0.001833375969983798',\n                 'tool_use_id': 'toolu_01TcqArsz5skzgeZSHACNpFL',\n                 'type': 'tool_result'}],\n  'role': 'user'}\n\n\nI was able to complete 2 out of 4 steps in the sequence before running out of tool uses. Here’s what was calculated:\nCompleted: 1. 43 ÷ 23454 = 0.001833375969983798 2. 652 ÷ 0.001833375969983798 = 355628.0930232558\nStill needed: 3. 6843 ÷ 355628.0930232558 = (not calculated) 4. 321 ÷ (result from step 3) = (not calculated)\nTo complete this sequence, you would need to: - Divide 6843 by 355628.0930232558 - Then divide 321 by that result to get the final answer\nWould you like me to continue with these remaining calculations?\n\n\nid: msg_01GNzpAuTG1LtRm8z8rjnXV4\ncontent: [{'citations': None, 'text': \"I was able to complete 2 out of 4 steps in the sequence before running out of tool uses. Here's what was calculated:\\n\\n**Completed:**\\n1. 43 ÷ 23454 = 0.001833375969983798\\n2. 652 ÷ 0.001833375969983798 = 355628.0930232558\\n\\n**Still needed:**\\n3. 6843 ÷ 355628.0930232558 = (not calculated)\\n4. 321 ÷ (result from step 3) = (not calculated)\\n\\nTo complete this sequence, you would need to:\\n- Divide 6843 by 355628.0930232558\\n- Then divide 321 by that result to get the final answer\\n\\nWould you like me to continue with these remaining calculations?\", 'type': 'text'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 875, 'output_tokens': 198, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat = Chat(model, tools=mydiv)\nr = chat.toolloop('Try dividing 1 by 0 and see what the error result is')\nfor o in r: display(o)\n\nI’ll try dividing 1 by 0 to see what happens:\n\n\nid: msg_01Y8hq6xRjtB3jpnKUjcShHH\ncontent: [{'citations': None, 'text': \"I'll try dividing 1 by 0 to see what happens:\", 'type': 'text'}, {'id': 'toolu_016iCAFGa523mQc3JKCiWQRH', 'input': {'a': 1, 'b': 0}, 'name': 'mydiv', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 592, 'output_tokens': 87, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{ 'content': [ { 'content': 'Traceback (most recent call last):\\n'\n                            '  File '\n                            '\"/Users/jhoward/aai-ws/toolslm/toolslm/funccall.py\", '\n                            'line 215, in call_func\\n'\n                            '    try: return func(**inps)\\n'\n                            '                ^^^^^^^^^^^^\\n'\n                            '  File '\n                            '\"/Users/jhoward/aai-ws/claudette/claudette/core.py\", '\n                            'line 439, in wrapper\\n'\n                            '    return func(*new_args, **new_kwargs)\\n'\n                            '           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n'\n                            '  File '\n                            '\"/var/folders/51/b2_szf2945n072c0vj2cyty40000gn/T/ipykernel_73559/246724137.py\", '\n                            'line 3, in mydiv\\n'\n                            '    return a / b\\n'\n                            '           ~~^~~\\n'\n                            'ZeroDivisionError: division by zero\\n',\n                 'tool_use_id': 'toolu_016iCAFGa523mQc3JKCiWQRH',\n                 'type': 'tool_result'}],\n  'role': 'user'}\n\n\nAs expected, dividing by zero produces a ZeroDivisionError with the message “division by zero”. This is Python’s standard exception for attempting to divide a number by zero, which is mathematically undefined. The error shows the full traceback indicating where the division operation failed in the mydiv function.\n\n\nid: msg_01RcdGpMqujYsp2zEh13aKvf\ncontent: [{'citations': None, 'text': 'As expected, dividing by zero produces a **ZeroDivisionError** with the message \"division by zero\". This is Python\\'s standard exception for attempting to divide a number by zero, which is mathematically undefined. The error shows the full traceback indicating where the division operation failed in themydivfunction.', 'type': 'text'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 882, 'output_tokens': 70, 'server_tool_use': None, 'service_tier': 'standard'}",
    "crumbs": [
      "Tool loop"
    ]
  },
  {
    "objectID": "toolloop.html#streaming",
    "href": "toolloop.html#streaming",
    "title": "Tool loop",
    "section": "Streaming",
    "text": "Streaming\n\norders, customers = _get_orders_customers()\n\n\nchat = Chat(model, tools=tools)\nr = chat.toolloop('Please cancel all orders for customer C1 for me.', stream=True)\nfor o in r:\n    if isinstance(o, (dict,Message,list)): print(o)\n    else: \n        for x in o: print(x, end='')\n        display(o.value)\n\nI'll help you cancel all orders for customer C1. First, let me retrieve the customer's information to see what orders they have.- Retrieving customer C1\n\n\nI’ll help you cancel all orders for customer C1. First, let me retrieve the customer’s information to see what orders they have.\n\n\nid: msg_01Qz5tYWK1jA8kete3Ub2dNt\ncontent: [{'citations': None, 'text': \"I'll help you cancel all orders for customer C1. First, let me retrieve the customer's information to see what orders they have.\", 'type': 'text'}, {'id': 'toolu_019nveAUbHYAQ11nprLdWAQR', 'input': {'customer_id': 'C1'}, 'name': 'get_customer_info', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 757, 'output_tokens': 87, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_019nveAUbHYAQ11nprLdWAQR', 'content': \"{'name': 'John Doe', 'email': 'john@example.com', 'phone': '123-456-7890', 'orders': [{'id': 'O1', 'product': 'Widget A', 'quantity': 2, 'price': 19.99, 'status': 'Shipped'}, {'id': 'O2', 'product': 'Gadget B', 'quantity': 1, 'price': 49.99, 'status': 'Processing'}]}\"}]}\nNow I can see that customer C1 (John Doe) has 2 orders:\n- Order O1: Widget A (Status: Shipped)\n- Order O2: Gadget B (Status: Processing)\n\nLet me cancel both orders for you.- Cancelling order O1\n- Cancelling order O2\n\n\nNow I can see that customer C1 (John Doe) has 2 orders: - Order O1: Widget A (Status: Shipped) - Order O2: Gadget B (Status: Processing)\nLet me cancel both orders for you.\n\n\nid: msg_01MhvyKhRtSdsCmTfbSuWwE7\ncontent: [{'citations': None, 'text': 'Now I can see that customer C1 (John Doe) has 2 orders:\\n- Order O1: Widget A (Status: Shipped)\\n- Order O2: Gadget B (Status: Processing)\\n\\nLet me cancel both orders for you.', 'type': 'text'}, {'id': 'toolu_01DheUnWexZKYKSi211SgGLM', 'input': {'order_id': 'O1'}, 'name': 'cancel_order', 'type': 'tool_use'}, {'id': 'toolu_01HhVbewBrXzyGSfeWMeTEEt', 'input': {'order_id': 'O2'}, 'name': 'cancel_order', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 981, 'output_tokens': 154, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01DheUnWexZKYKSi211SgGLM', 'content': 'True'}, {'type': 'tool_result', 'tool_use_id': 'toolu_01HhVbewBrXzyGSfeWMeTEEt', 'content': 'True'}]}\nPerfect! I've successfully cancelled all orders for customer C1 (John Doe):\n- ✓ Order O1 (Widget A) - Cancelled\n- ✓ Order O2 (Gadget B) - Cancelled\n\nBoth orders have been cancelled successfully.\n\n\nPerfect! I’ve successfully cancelled all orders for customer C1 (John Doe): - ✓ Order O1 (Widget A) - Cancelled - ✓ Order O2 (Gadget B) - Cancelled\nBoth orders have been cancelled successfully.\n\n\nid: msg_01NgJQktChmU3RrU4xUpXTKq\ncontent: [{'citations': None, 'text': \"Perfect! I've successfully cancelled all orders for customer C1 (John Doe):\\n- ✓ Order O1 (Widget A) - Cancelled\\n- ✓ Order O2 (Gadget B) - Cancelled\\n\\nBoth orders have been cancelled successfully.\", 'type': 'text'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 1200, 'output_tokens': 65, 'server_tool_use': None, 'service_tier': 'standard'}",
    "crumbs": [
      "Tool loop"
    ]
  },
  {
    "objectID": "toolloop.html#async-tool-loop",
    "href": "toolloop.html#async-tool-loop",
    "title": "Tool loop",
    "section": "Async tool loop",
    "text": "Async tool loop\n\nsource\n\nAsyncChat.toolloop\n\ndef toolloop(\n    pr, # Prompt to pass to Claude\n    max_steps:int=10, # Maximum number of tool requests to loop through\n    cont_func:callable=noop, # Function that stops loop if returns False\n    final_prompt:str='You have no more tool uses. Please summarize your findings. If you did not complete your goal please tell the user what further work needs to be done so they can choose how best to proceed.', # Prompt to add if last message is a tool call\n    temp:NoneType=None, # Temperature\n    maxtok:int=4096, # Maximum tokens\n    maxthinktok:int=0, # Maximum thinking tokens\n    stream:bool=False, # Stream response?\n    prefill:str='', # Optional prefill to pass to Claude as start of its response\n    tool_choice:Union=None, # Optionally force use of some tool\n):\n\nAdd prompt pr to dialog and get a response from Claude, automatically following up with tool_use messages\n\n\nExported source\n@patch\n@delegates(AsyncChat.__call__)\ndef toolloop(\n    self: AsyncChat,\n    pr, # Prompt to pass to Claude\n    max_steps=10, # Maximum number of tool requests to loop through\n    cont_func: callable = noop, # Function that stops loop if returns False\n    final_prompt = _final_prompt, # Prompt to add if last message is a tool call\n    **kwargs\n):\n    \"Add prompt `pr` to dialog and get a response from Claude, automatically following up with `tool_use` messages\"\n    @save_iter\n    async def _f(o):\n        init_n = len(self.h)\n        r = await self(pr, **kwargs)\n        yield r\n        if len(self.last)&gt;1: yield self.last[1]\n        for i in range(max_steps-1):\n            if self.c.stop_reason != 'tool_use': break\n            r = await self(final_prompt if i==max_steps-2 else None, **kwargs)\n            yield r\n            if len(self.last)&gt;1: yield self.last[1]\n            if not cont_func(*self.h[-3:]): break\n        o.value = self.h[init_n+1:]\n    return _f()\n\n\n\norders, customers = _get_orders_customers()\n\n\ntools = [get_customer_info, get_order_details, cancel_order]\nchat = AsyncChat(model, tools=tools)\nr = chat.toolloop('Can you tell me the email address for customer C1?')\nasync for o in r: print(o)\n\n- Retrieving customer C1\nMessage(id='msg_01F1ruk8y7TsTrhpWTkBc67e', content=[ToolUseBlock(id='toolu_01LJ2mkQDqRdToAFHbCosv26', input={'customer_id': 'C1'}, name='get_customer_info', type='tool_use')], model='claude-sonnet-4-5-20250929', role='assistant', stop_reason='tool_use', stop_sequence=None, type='message', usage=In: 757; Out: 58; Cache create: 0; Cache read: 0; Total Tokens: 815; Search: 0)\n{'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01LJ2mkQDqRdToAFHbCosv26', 'content': \"{'name': 'John Doe', 'email': 'john@example.com', 'phone': '123-456-7890', 'orders': [{'id': 'O1', 'product': 'Widget A', 'quantity': 2, 'price': 19.99, 'status': 'Shipped'}, {'id': 'O2', 'product': 'Gadget B', 'quantity': 1, 'price': 49.99, 'status': 'Processing'}]}\"}]}\nMessage(id='msg_019Z6rMioA6RExGgXKGnusiM', content=[TextBlock(citations=None, text='The email address for customer C1 (John Doe) is **john@example.com**.', type='text')], model='claude-sonnet-4-5-20250929', role='assistant', stop_reason='end_turn', stop_sequence=None, type='message', usage=In: 953; Out: 24; Cache create: 0; Cache read: 0; Total Tokens: 977; Search: 0)\n\n\n\npprint(r.value)\n\n[{'content': [{'id': 'toolu_01LJ2mkQDqRdToAFHbCosv26',\n               'input': {'customer_id': 'C1'},\n               'name': 'get_customer_info',\n               'type': 'tool_use'}],\n  'role': 'assistant'},\n {'content': [{'content': \"{'name': 'John Doe', 'email': 'john@example.com', \"\n                          \"'phone': '123-456-7890', 'orders': [{'id': 'O1', \"\n                          \"'product': 'Widget A', 'quantity': 2, 'price': \"\n                          \"19.99, 'status': 'Shipped'}, {'id': 'O2', \"\n                          \"'product': 'Gadget B', 'quantity': 1, 'price': \"\n                          \"49.99, 'status': 'Processing'}]}\",\n               'tool_use_id': 'toolu_01LJ2mkQDqRdToAFHbCosv26',\n               'type': 'tool_result'}],\n  'role': 'user'},\n {'content': [{'citations': {},\n               'text': 'The email address for customer C1 (John Doe) is '\n                       '**john@example.com**.',\n               'type': 'text'}],\n  'role': 'assistant'}]",
    "crumbs": [
      "Tool loop"
    ]
  },
  {
    "objectID": "toolloop.html#code-interpreter",
    "href": "toolloop.html#code-interpreter",
    "title": "Tool loop",
    "section": "Code interpreter",
    "text": "Code interpreter\nHere is an example of using toolloop to implement a simple code interpreter with additional tools.\n\nfrom toolslm.shell import get_shell\nfrom fastcore.meta import delegates\nimport traceback\n\n\n@delegates()\nclass CodeChat(Chat):\n    imps = 'os, warnings, time, json, re, math, collections, itertools, functools, dateutil, datetime, string, types, copy, pprint, enum, numbers, decimal, fractions, random, operator, typing, dataclasses'\n    def __init__(self, model: Optional[str] = None, ask:bool=True, **kwargs):\n        super().__init__(model=model, **kwargs)\n        self.ask = ask\n        self.tools.append(self.run_cell)\n        self.shell = get_shell()\n        self.shell.run_cell('import '+self.imps)\n\nWe have one additional parameter to creating a CodeChat beyond what we pass to Chat, which is ask – if that’s True, we’ll prompt the user before running code.\n\n@patch\ndef run_cell(\n    self:CodeChat,\n    code:str,   # Code to execute in persistent IPython session\n)-&gt;str:\n    \"\"\"Asks user for permission, and if provided, executes python `code` using persistent IPython session.\n    Returns: Result of expression on last line (if exists); '#DECLINED#' if user declines request to execute\"\"\"\n    confirm = f'Press Enter to execute, or enter \"n\" to skip?\\n```\\n{code}\\n```\\n'\n    if self.ask and input(confirm): return '#DECLINED#'\n    try: res = self.shell.run_cell(code)\n    except Exception as e: return traceback.format_exc()\n    return res.stdout if res.result is None else res.result\n\nWe just pass along requests to run code to the shell’s implementation. Claude often prints results instead of just using the last expression, so we capture stdout in those cases.\n\nsp = f'''You are a knowledgable assistant. Do not use tools unless needed.\nDon't do complex calculations yourself -- use code for them.\nThe following modules are pre-imported for `run_cell` automatically:\n\n{CodeChat.imps}\n\nNever mention what tools you are using. Note that `run_cell` interpreter state is *persistent* across calls.\n\nIf a tool returns `#DECLINED#` report to the user that the attempt was declined and no further progress can be made.\nIn that case, do *not* attempt to run any further code -- stop execution *IMMEDIATELY* and tell the user it was declined.\n\nWhen using a tool, *ALWAYS* before every use of every tool, tell the user what you will be doing and why.'''\n\n\ndef get_user()-&gt;str:\n    \"Get the username of the user running this session\"\n    print(\"Looking up username\")\n    return 'Jeremy'\n\nIn order to test out multi-stage tool use, we create a mock function that Claude can call to get the current username.\n\nmodel = models[1]\nchat = CodeChat(model, tools=[get_user], sp=sp, ask=True, temp=0.3)\n\nProviding a callable to toolloop’s trace_func lets us print out information during the loop:\ntoolloop’s cont_func callable let’s us provide a function which, if it returns False, stops the loop:\n\ndef _cont_decline(call, resp, asst): return resp['content'][0].get('content') != '#DECLINED#'\n\nNow we can try our code interpreter. We start by asking for a function to be created, which we’ll use in the next prompt to test that the interpreter is persistent.\n\npr = '''Create a 1-line function `checksum` for a string `s`,\nthat multiplies together the ascii values of each character in `s` using `reduce`.'''\nfor o in chat.toolloop(pr, cont_func=_cont_decline): display(o)\n\nI’ll create a 1-line checksum function that uses reduce to multiply the ASCII values of each character in a string.\n\n\nid: msg_01NfL3YNWTZ2Chst88nr3iPu\ncontent: [{'citations': None, 'text': \"I'll create a 1-linechecksumfunction that usesreduceto multiply the ASCII values of each character in a string.\", 'type': 'text'}, {'id': 'toolu_01GgTqM917BzHJ4MjpwZFwTF', 'input': {'code': '\\nchecksum = lambda s: functools.reduce(operator.mul, (ord(c) for c in s), 1)\\n\\n# Test it\\nprint(checksum(\"abc\"))\\nprint(checksum(\"hello\"))\\nprint(checksum(\"A\"))\\n'}, 'name': 'run_cell', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 927, 'output_tokens': 141, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{ 'content': [ { 'content': '941094\\n13599570816\\n65\\n',\n                 'tool_use_id': 'toolu_01GgTqM917BzHJ4MjpwZFwTF',\n                 'type': 'tool_result'}],\n  'role': 'user'}\n\n\nPerfect! I’ve created the checksum function as a one-liner that: - Uses functools.reduce with operator.mul to multiply values together - Converts each character to its ASCII value using ord(c) - Uses a generator expression (ord(c) for c in s) to iterate through the string - Starts with an initial value of 1 (the identity for multiplication)\nThe test shows it working correctly: - \"abc\" → 97 × 98 × 99 = 941,094 - \"hello\" → 104 × 101 × 108 × 108 × 111 = 13,599,570,816 - \"A\" → 65\n\n\nid: msg_01L1Et5ywM28AckqGct1Ce4A\ncontent: [{'citations': None, 'text': 'Perfect! I\\'ve created thechecksumfunction as a one-liner that:\\n- Usesfunctools.reducewithoperator.multo multiply values together\\n- Converts each character to its ASCII value usingord(c)\\n- Uses a generator expression(ord(c) for c in s)to iterate through the string\\n- Starts with an initial value of1(the identity for multiplication)\\n\\nThe test shows it working correctly:\\n-“abc”→ 97 × 98 × 99 = 941,094\\n-“hello”→ 104 × 101 × 108 × 108 × 111 = 13,599,570,816\\n-“A”→ 65', 'type': 'text'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 1090, 'output_tokens': 175, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nBy asking for a calculation to be done on the username, we force it to use multiple steps:\n\npr = 'Use it to get the checksum of the username of this session.'\nfor o in chat.toolloop(pr): display(o)\n\nLooking up username\n\n\nI’ll get the username of this session and then calculate its checksum.\n\n\nid: msg_01HrZAji8SwDbRhbb79cUZHo\ncontent: [{'citations': None, 'text': \"I'll get the username of this session and then calculate its checksum.\", 'type': 'text'}, {'id': 'toolu_01MzJHgGgQdJ5Pc9e5s35ddF', 'input': {}, 'name': 'get_user', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 1282, 'output_tokens': 52, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{ 'content': [ { 'content': 'Jeremy',\n                 'tool_use_id': 'toolu_01MzJHgGgQdJ5Pc9e5s35ddF',\n                 'type': 'tool_result'}],\n  'role': 'user'}\n\n\nNow I’ll calculate the checksum for “Jeremy”:\n\n\nid: msg_01Fdq1ViEfUg6kzGPrYeeVa6\ncontent: [{'citations': None, 'text': 'Now I\\'ll calculate the checksum for \"Jeremy\":', 'type': 'text'}, {'id': 'toolu_016XwiSjzxo2sgJTiZw2gFH8', 'input': {'code': '\\nusername = \"Jeremy\"\\nresult = checksum(username)\\nprint(f\"Username: {username}\")\\nprint(f\"Checksum: {result}\")\\n'}, 'name': 'run_cell', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 1347, 'output_tokens': 101, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{ 'content': [ { 'content': 'Username: Jeremy\\nChecksum: 1134987783204\\n',\n                 'tool_use_id': 'toolu_016XwiSjzxo2sgJTiZw2gFH8',\n                 'type': 'tool_result'}],\n  'role': 'user'}\n\n\nThe checksum of the username “Jeremy” is 1,134,987,783,204.\nThis is calculated by multiplying the ASCII values: 74 × 101 × 114 × 101 × 109 × 121 = 1,134,987,783,204\n\n\nid: msg_01CfuVuK1hbYq6o61cv7ddp8\ncontent: [{'citations': None, 'text': 'The checksum of the username \"Jeremy\" is **1,134,987,783,204**.\\n\\nThis is calculated by multiplying the ASCII values: 74 × 101 × 114 × 101 × 109 × 121 = 1,134,987,783,204', 'type': 'text'}]\nmodel: claude-sonnet-4-5-20250929\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'input_tokens': 1475, 'output_tokens': 69, 'server_tool_use': None, 'service_tier': 'standard'}",
    "crumbs": [
      "Tool loop"
    ]
  },
  {
    "objectID": "core.html",
    "href": "core.html",
    "title": "Claudette’s source",
    "section": "",
    "text": "This is the ‘literate’ source code for Claudette. You can view the fully rendered version of the notebook here, or you can clone the git repo and run the interactive notebook in Jupyter. The notebook is converted the Python module claudette/core.py using nbdev. The goal of this source code is to both create the Python module, and also to teach the reader how it is created, without assuming much existing knowledge about Claude’s API.\nMost of the time you’ll see that we write some source code first, and then a description or discussion of it afterwards.",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#setup",
    "href": "core.html#setup",
    "title": "Claudette’s source",
    "section": "Setup",
    "text": "Setup\n\nimport os\n# os.environ['ANTHROPIC_LOG'] = 'debug'\n\nTo print every HTTP request and response in full, uncomment the above line. This functionality is provided by Anthropic’s SDK.\n\nfrom anthropic.types import Model\nfrom claudette.text_editor import *\nfrom typing import get_args\nfrom datetime import datetime\nfrom pprint import pprint\nfrom IPython.display import Image\nfrom cachy import enable_cachy\n\nimport warnings\n\n\nenable_cachy()\n\n\nwarnings.filterwarnings(\"ignore\", message=\"Pydantic serializer warnings\")\n\n\n\n\n\n\n\nTip\n\n\n\nIf you’re reading the rendered version of this notebook, you’ll see an “Exported source” collapsible widget below. If you’re reading the source notebook directly, you’ll see #| exports at the top of the cell. These show that this piece of code will be exported into the python module that this notebook creates. No other code will be included – any other code in this notebook is just for demonstration, documentation, and testing.\nYou can toggle expanding/collapsing the source code of all exported sections by using the &lt;/&gt; Code menu in the top right of the rendered notebook page.\n\n\n\n\nExported source\nmodel_types = {\n    # Anthropic\n    'claude-opus-4-6': 'opus',\n    'claude-sonnet-4-6': 'sonnet',\n    'claude-haiku-4-5': 'haiku',\n    'claude-opus-4-5': 'opus-4-5',\n    'claude-sonnet-4-5': 'sonnet-4-5',\n    'claude-opus-4-1-20250805': 'opus-4-1',\n    'claude-opus-4-20250514': 'opus-4',\n    'claude-3-opus-20240229': 'opus-3',\n    'claude-sonnet-4-20250514': 'sonnet-4',\n    'claude-3-7-sonnet-20250219': 'sonnet-3-7',\n    'claude-3-5-sonnet-20241022': 'sonnet-3-5',\n    'claude-3-haiku-20240307': 'haiku-3',\n    'claude-3-5-haiku-20241022': 'haiku-3-5',\n    # AWS\n    'anthropic.claude-opus-4-1-20250805-v1:0': 'opus',\n    'anthropic.claude-3-5-sonnet-20241022-v2:0': 'sonnet',\n    'anthropic.claude-3-opus-20240229-v1:0': 'opus-3',\n    'anthropic.claude-3-sonnet-20240229-v1:0': 'sonnet',\n    'anthropic.claude-3-haiku-20240307-v1:0': 'haiku',\n    # Google\n    'claude-opus-4-1@20250805': 'opus',\n    'claude-3-5-sonnet-v2@20241022': 'sonnet',\n    'claude-3-opus@20240229': 'opus-3',\n    'claude-3-sonnet@20240229': 'sonnet',\n    'claude-3-haiku@20240307': 'haiku',\n}\n\nall_models = list(model_types)\n\n\n\nmodels\n\n['claude-opus-4-6',\n 'claude-sonnet-4-6',\n 'claude-haiku-4-5',\n 'claude-opus-4-5',\n 'claude-sonnet-4-5',\n 'claude-opus-4-1-20250805',\n 'claude-opus-4-20250514',\n 'claude-3-opus-20240229',\n 'claude-sonnet-4-20250514',\n 'claude-3-7-sonnet-20250219']\n\n\n\n\nExported source\ntext_only_models = ('claude-3-5-haiku-20241022',)\n\n\n\n\nExported source\nhas_streaming_models = set(all_models)\nhas_system_prompt_models = set(all_models)\nhas_temperature_models = set(all_models)\nhas_extended_thinking_models = {\n    'claude-opus-4-6', 'claude-sonnet-4-6',\n    'claude-opus-4-5', 'claude-sonnet-4-5', 'claude-haiku-4-5',\n    'claude-opus-4-1-20250805', 'claude-opus-4-20250514', 'claude-sonnet-4-20250514', 'claude-3-7-sonnet-20250219'\n}\n\n\n\nhas_extended_thinking_models\n\n{'claude-3-7-sonnet-20250219',\n 'claude-haiku-4-5',\n 'claude-opus-4-1-20250805',\n 'claude-opus-4-20250514',\n 'claude-opus-4-5',\n 'claude-opus-4-6',\n 'claude-sonnet-4-20250514',\n 'claude-sonnet-4-5',\n 'claude-sonnet-4-6'}\n\n\n\nsource\n\ncan_use_extended_thinking\n\ndef can_use_extended_thinking(\n    m\n):\n\n\n\nExported source\ndef can_stream(m): return m in has_streaming_models\ndef can_set_system_prompt(m): return m in has_system_prompt_models\ndef can_set_temperature(m): return m in has_temperature_models\ndef can_use_extended_thinking(m): return m in has_extended_thinking_models\n\n\n\nsource\n\n\ncan_set_temperature\n\ndef can_set_temperature(\n    m\n):\n\n\nsource\n\n\ncan_set_system_prompt\n\ndef can_set_system_prompt(\n    m\n):\n\n\nsource\n\n\ncan_stream\n\ndef can_stream(\n    m\n):\n\nWe include these functions to provide a uniform library interface with cosette since openai models such as o1 do not have many of these capabilities.\n\nassert can_stream('claude-3-5-sonnet-20241022') and can_set_system_prompt('claude-3-5-sonnet-20241022') and can_set_temperature('claude-3-5-sonnet-20241022')\n\nThese are the current versions and prices of Anthropic’s models at the time of writing.\n\nmodel = models[1]\nmodel\n\n'claude-sonnet-4-6'",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#antropic-sdk",
    "href": "core.html#antropic-sdk",
    "title": "Claudette’s source",
    "section": "Antropic SDK",
    "text": "Antropic SDK\n\ncli = Anthropic()\n\nThis is what Anthropic’s SDK provides for interacting with Python. To use it, pass it a list of messages, with content and a role. The roles should alternate between user and assistant.\n\n\n\n\n\n\nTip\n\n\n\nAfter the code below you’ll see an indented section with an orange vertical line on the left. This is used to show the result of running the code above. Because the code is running in a Jupyter Notebook, we don’t have to use print to display results, we can just type the expression directly, as we do with r here.\n\n\n\nm = {'role': 'user', 'content': \"I'm Jeremy\"}\nr = cli.messages.create(messages=[m], model=model, max_tokens=100)\nr\n\nHi Jeremy! Nice to meet you. How can I help you today?\n\n\nid: msg_01Q3123HGtAxWnUraLL65H24\ncontainer: None\ncontent: [{'citations': None, 'text': 'Hi Jeremy! Nice to meet you. How can I help you today?', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 10, 'output_tokens': 18, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nFormatting output\nThat output is pretty long and hard to read, so let’s clean it up. We’ll start by pulling out the Content part of the message. To do that, we’re going to write our first function which will be included to the claudette/core.py module.\n\n\n\n\n\n\nTip\n\n\n\nThis is the first exported public function or class we’re creating (the previous export was of a variable). In the rendered version of the notebook for these you’ll see 4 things, in this order (unless the symbol starts with a single _, which indicates it’s private):\n\nThe signature (with the symbol name as a heading, with a horizontal rule above)\nA table of paramater docs (if provided)\nThe doc string (in italics).\nThe source code (in a collapsible “Exported source” block)\n\nAfter that, we generally provide a bit more detail on what we’ve created, and why, along with a sample usage.\n\n\n\nsource\n\n\nfind_block\n\ndef find_block(\n    r:Mapping, # The message to look in\n    blk_type:type | str=TextBlock, # The type of block to find\n):\n\nFind the first block of type blk_type in r.content.\n\n\nExported source\ndef _type(x):\n    try: return x.type\n    except AttributeError: return x.get('type')\n\ndef find_block(r:abc.Mapping, # The message to look in\n               blk_type:type|str=TextBlock  # The type of block to find\n              ):\n    \"Find the first block of type `blk_type` in `r.content`.\"\n    f = (lambda x:_type(x)==blk_type) if isinstance(blk_type,str) else (lambda x:isinstance(x,blk_type))\n    return first(o for o in r.content if f(o))\n\n\nThis makes it easier to grab the needed parts of Claude’s responses, which can include multiple pieces of content. By default, we look for the first text block. That will generally have the content we want to display.\n\nfind_block(r)\n\nTextBlock(citations=None, text='Hi Jeremy! Nice to meet you. How can I help you today?', type='text')\n\n\n\ndef contents(r):\n    \"Helper to get the contents from Claude response `r`.\"\n    blk = find_block(r)\n    if not blk and r.content: blk = r.content[0]\n    if hasattr(blk,'text'): return blk.text.strip()\n    elif hasattr(blk,'content'): return blk.content.strip()\n    elif hasattr(blk,'source'): return f'*Media Type - {blk.type}*'\n    return str(blk)\n\nFor display purposes, we often just want to show the text itself.\n\ncontents(r)\n\n'Hi Jeremy! Nice to meet you. How can I help you today?'\n\n\n\n\nExported source\n@patch\ndef _repr_markdown_(self:(Message)):\n    det = '\\n- '.join(f'{k}: `{v}`' for k,v in self.model_dump().items())\n    cts = re.sub(r'\\$', '&#36;', contents(self))  # escape `$` for jupyter latex\n    return f\"\"\"{cts}\n\n&lt;details&gt;\n\n- {det}\n\n&lt;/details&gt;\"\"\"\n\n\nJupyter looks for a _repr_markdown_ method in displayed objects; we add this in order to display just the content text, and collapse full details into a hideable section. Note that patch is from fastcore, and is used to add (or replace) functionality in an existing class. We pass the class(es) that we want to patch as type annotations to self. In this case, _repr_markdown_ is being added to Anthropic’s Message class, so when we display the message now we just see the contents, and the details are hidden away in a collapsible details block.\n\nr\n\nHi Jeremy! Nice to meet you. How can I help you today?\n\n\nid: msg_01Q3123HGtAxWnUraLL65H24\ncontainer: None\ncontent: [{'citations': None, 'text': 'Hi Jeremy! Nice to meet you. How can I help you today?', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 10, 'output_tokens': 18, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nOne key part of the response is the usage key, which tells us how many tokens we used by returning a Usage object.\nWe’ll add some helpers to make things a bit cleaner for creating and formatting these objects.\n\nr.usage\n\nIn: 10; Out: 18; Cache create: 0; Cache read: 0; Total Tokens: 28; Search: 0\n\n\n\nsource\n\n\nserver_tool_usage\n\ndef server_tool_usage(\n    web_search_requests:int=0, web_fetch_requests:int=0\n):\n\nLittle helper to create a server tool usage object\n\n\nExported source\ndef server_tool_usage(web_search_requests=0, web_fetch_requests=0):\n    'Little helper to create a server tool usage object'\n    return ServerToolUsage(web_search_requests=web_search_requests, web_fetch_requests=web_fetch_requests)\n\n\n\nserver_tool_usage(3,2)\n\nServerToolUsage(web_fetch_requests=2, web_search_requests=3)\n\n\n\nsource\n\n\nusage\n\ndef usage(\n    inp:int=0, # input tokens\n    out:int=0, # Output tokens\n    cache_create:int=0, # Cache creation tokens\n    cache_read:int=0, # Cache read tokens\n    server_tool_use:ServerToolUsage=ServerToolUsage(web_fetch_requests=0, web_search_requests=0), # server tool use\n):\n\nSlightly more concise version of Usage.\n\n\nExported source\ndef usage(inp=0, # input tokens\n          out=0,  # Output tokens\n          cache_create=0, # Cache creation tokens\n          cache_read=0, # Cache read tokens\n          server_tool_use=server_tool_usage() # server tool use\n         ):\n    'Slightly more concise version of `Usage`.'\n    return Usage(input_tokens=inp, output_tokens=out, cache_creation_input_tokens=cache_create,\n                 cache_read_input_tokens=cache_read, server_tool_use=server_tool_use)\n\n\nThe constructor provided by Anthropic is rather verbose, so we clean it up a bit, using a lowercase version of the name.\n\nusage(5)\n\nIn: 5; Out: 0; Cache create: 0; Cache read: 0; Total Tokens: 5; Search: 0\n\n\n\nsource\n\n\nUsage.total\n\ndef total(\n    \n):\n\n\n\nExported source\ndef _dgetattr(o,s,d): \n    \"Like getattr, but returns the default if the result is None\"\n    return getattr(o,s,d) or d\n\n@patch(as_prop=True)\ndef total(self:Usage): return self.input_tokens+self.output_tokens+_dgetattr(self, \"cache_creation_input_tokens\",0)+_dgetattr(self, \"cache_read_input_tokens\",0)\n\n\nAdding a total property to Usage makes it easier to see how many tokens we’ve used up altogether.\n\nusage(5,1).total\n\n6\n\n\n\nsource\n\n\nUsage.__repr__\n\ndef __repr__(\n    \n):\n\nReturn repr(self).\n\n\nExported source\n@patch\ndef __repr__(self:Usage):\n    io_toks = f'In: {self.input_tokens}; Out: {self.output_tokens}'\n    cache_toks = f'Cache create: {_dgetattr(self, \"cache_creation_input_tokens\",0)}; Cache read: {_dgetattr(self, \"cache_read_input_tokens\",0)}'\n    server_tool_use = _dgetattr(self, \"server_tool_use\",server_tool_usage())\n    server_tool_use_str = f'Search: {server_tool_use.web_search_requests}; Fetch: {server_tool_use.web_fetch_requests}'\n    total_tok = f'Total Tokens: {self.total}'\n    return f'{io_toks}; {cache_toks}; {total_tok}; {server_tool_use_str}'\n\n\nIn python, patching __repr__ lets us change how an object is displayed. (More generally, methods starting and ending in __ in Python are called dunder methods, and have some magic behavior – such as, in this case, changing how an object is displayed.) We won’t be directly displaying ServerToolUsage’s, so we can handle its display behavior in the same Usage __repr__\n\nusage(5)\n\nIn: 5; Out: 0; Cache create: 0; Cache read: 0; Total Tokens: 5; Search: 0; Fetch: 0\n\n\n\nsource\n\n\nServerToolUsage.__add__\n\ndef __add__(\n    b\n):\n\nAdd together each of the server tool use counts\n\n\nExported source\n@patch\ndef __add__(self:ServerToolUsage, b):\n    \"Add together each of the server tool use counts\"\n    return ServerToolUsage(web_search_requests=self.web_search_requests+b.web_search_requests,\n        web_fetch_requests=self.web_fetch_requests+b.web_fetch_requests)\n\n\nAnd, patching __add__ lets + work on a ServerToolUsage as well as a Usage object.\n\nserver_tool_usage(1) + server_tool_usage(2,3)\n\nServerToolUsage(web_fetch_requests=3, web_search_requests=3)\n\n\n\nsource\n\n\nUsage.__add__\n\ndef __add__(\n    b\n):\n\nAdd together each of input_tokens and output_tokens\n\n\nExported source\n@patch\ndef __add__(self:Usage, b):\n    \"Add together each of `input_tokens` and `output_tokens`\"\n    return usage(self.input_tokens+b.input_tokens, self.output_tokens+b.output_tokens,\n                 _dgetattr(self,'cache_creation_input_tokens',0)+_dgetattr(b,'cache_creation_input_tokens',0),\n                 _dgetattr(self,'cache_read_input_tokens',0)+_dgetattr(b,'cache_read_input_tokens',0),\n                 _dgetattr(self,'server_tool_use',server_tool_usage())+_dgetattr(b,'server_tool_use',server_tool_usage()))\n\n\n\nr.usage+r.usage + usage(server_tool_use=server_tool_usage(1))\n\nIn: 20; Out: 36; Cache create: 0; Cache read: 0; Total Tokens: 56; Search: 1; Fetch: 0\n\n\n\n\nCreating messages\nCreating correctly formatted dicts from scratch every time isn’t very handy, so we’ll import a couple of helper functions from the msglm library.\nLet’s use mk_msg to recreate our msg {'role': 'user', 'content': \"I'm Jeremy\"} from earlier.\n\nprompt = \"I'm Jeremy\"\nm = mk_msg(prompt)\nr = cli.messages.create(messages=[m], model=model, max_tokens=100)\nr\n\nHi Jeremy! Nice to meet you. How can I help you today?\n\n\nid: msg_01Q3123HGtAxWnUraLL65H24\ncontainer: None\ncontent: [{'citations': None, 'text': 'Hi Jeremy! Nice to meet you. How can I help you today?', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 10, 'output_tokens': 18, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nWe can pass more than just text messages to Claude. As we’ll see later we can also pass images, SDK objects, etc. To handle these different data types we need to pass the type along with our content to Claude.\nHere”s an example of a multimodal message containing text and images.\n{\n    \"role\": \"user\", \n    \"content\": [\n        {\"type\":\"text\", \"text\":\"What is in the image?\"},\n        {\n            \"type\":\"image\", \n            \"source\": {\n                \"type\":\"base64\", \"media_type\":\"media_type\", \"data\": \"data\"\n            }\n        }\n    ]\n}\nmk_msg infers the type automatically and creates the appropriate data structure.\nLLMs, don’t actually have state, but instead dialogs are created by passing back all previous prompts and responses every time. With Claude, they always alternate user and assistant. We’ll use mk_msgs from msglm to make it easier to build up these dialog lists.\n\nmsgs = mk_msgs([prompt, r, \"I forgot my name. Can you remind me please?\"]) \nmsgs\n\n[{'role': 'user', 'content': \"I'm Jeremy\"},\n {'role': 'assistant',\n  'content': [TextBlock(citations=None, text='Hi Jeremy! Nice to meet you. How can I help you today?', type='text')]},\n {'role': 'user', 'content': 'I forgot my name. Can you remind me please?'}]\n\n\n\ncli.messages.create(messages=msgs, model=model, max_tokens=200)\n\nYour name is Jeremy! You told me that at the start of our conversation. 😊\n\n\nid: msg_01QTvdUwQAyKRQT3H73STdU3\ncontainer: None\ncontent: [{'citations': None, 'text': 'Your name is Jeremy! You told me that at the start of our conversation. 😊', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 42, 'output_tokens': 22, 'server_tool_use': None, 'service_tier': 'standard'}",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#client",
    "href": "core.html#client",
    "title": "Claudette’s source",
    "section": "Client",
    "text": "Client\n\nsource\n\nClient\n\ndef Client(\n    model, cli:NoneType=None, log:bool=False, cache:bool=False\n):\n\nBasic Anthropic messages client.\n\n\nExported source\nclass Client:\n    def __init__(self, model, cli=None, log=False, cache=False):\n        \"Basic Anthropic messages client.\"\n        self.model,self.use = model,usage()\n        self.text_only = model in text_only_models\n        self.log = [] if log else None\n        self.c = (cli or Anthropic(default_headers={'anthropic-beta': 'prompt-caching-2024-07-31'}))\n        self.cache = cache\n\n\nWe’ll create a simple Client for Anthropic which tracks usage stores the model to use. We don’t add any methods right away – instead we’ll use patch for that so we can add and document them incrementally.\n\nc = Client(model)\nc.use\n\nIn: 0; Out: 0; Cache create: 0; Cache read: 0; Total Tokens: 0; Search: 0; Fetch: 0\n\n\n\n\nExported source\n@patch\ndef _r(self:Client, r:Message, prefill=''):\n    \"Store the result of the message and accrue total usage.\"\n    if prefill:\n        blk = find_block(r)\n        if blk: blk.text = prefill + (blk.text or '')\n    self.result = r\n    self.use += r.usage\n    self.stop_reason = r.stop_reason\n    self.stop_sequence = r.stop_sequence\n    return r\n\n\nWe use a _ prefix on private methods, but we document them here in the interests of literate source code.\n_r will be used each time we get a new result, to track usage and also to keep the result available for later.\n\nc._r(r)\nc.use\n\nIn: 10; Out: 18; Cache create: 0; Cache read: 0; Total Tokens: 28; Search: 0; Fetch: 0\n\n\nWhereas OpenAI’s models use a stream parameter for streaming, Anthropic’s use a separate method. We implement Anthropic’s approach in a private method, and then use a stream parameter in __call__ for consistency:\n\n\nExported source\n@patch\ndef _log(self:Client, final, prefill, msgs, **kwargs):\n    self._r(final, prefill)\n    if self.log is not None: self.log.append({\n        \"msgs\": msgs, **kwargs,\n        \"result\": self.result, \"use\": self.use, \"stop_reason\": self.stop_reason, \"stop_sequence\": self.stop_sequence\n    })\n    return self.result\n\n\nOnce streaming is complete, we need to store the final message and call any completion callback that’s needed.\n\nsource\n\n\nget_types\n\ndef get_types(\n    msgs\n):\n\n\n\nExported source\n@save_iter\ndef _stream(o, cm, prefill, cb):\n    with cm as s:\n        yield prefill\n        yield from s.text_stream\n        o.value = s.get_final_message()\n        cb(o.value)\n\n\n\nget_types(msgs)\n\n['text', 'text', 'text']\n\n\n\nsource\n\n\nmk_tool_choice\n\ndef mk_tool_choice(\n    choose:Union\n)-&gt;dict:\n\nCreate a tool_choice dict that’s ‘auto’ if choose is None, ‘any’ if it is True, or ‘tool’ otherwise\n\nprint(mk_tool_choice('sums'))\nprint(mk_tool_choice(True))\nprint(mk_tool_choice(None))\n\n{'type': 'tool', 'name': 'sums'}\n{'type': 'any'}\n{'type': 'auto'}\n\n\nClaude can be forced to use a particular tool, or select from a specific list of tools, or decide for itself when to use a tool. If you want to force a tool (or force choosing from a list), include a tool_choice param with a dict from mk_tool_choice.\nClaude supports adding an extra assistant message at the end, which contains the prefill – i.e. the text we want Claude to assume the response starts with. However Claude doesn’t actually repeat that in the response, so for convenience we add it.\n\nsource\n\n\nClient.__call__\n\ndef __call__(\n    msgs:list, # List of messages in the dialog\n    sp:str='', # The system prompt\n    temp:int=0, # Temperature\n    maxtok:int=4096, # Maximum tokens\n    maxthinktok:int=0, # Maximum thinking tokens\n    prefill:str='', # Optional prefill to pass to Claude as start of its response\n    stream:bool=False, # Stream response?\n    stop:NoneType=None, # Stop sequence\n    tools:Optional=None, # List of tools to make available to Claude\n    tool_choice:Optional=None, # Optionally force use of some tool\n    cb:NoneType=None, # Callback to pass result to when complete\n    cache_control:Optional[CacheControlEphemeralParam] | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    container:Optional[str] | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    inference_geo:Optional[str] | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    metadata:MetadataParam | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    output_config:OutputConfigParam | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    service_tier:Literal['auto', 'standard_only'] | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    stop_sequences:SequenceNotStr[str] | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    system:Union[str, Iterable[TextBlockParam]] | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    temperature:float | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    thinking:ThinkingConfigParam | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    top_k:int | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    top_p:float | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    extra_headers:Headers | None=None, # Use the following arguments if you need to pass additional parameters to the API that aren't available via kwargs.\nThe extra values given here take precedence over values defined on the client or passed to this method.\n    extra_query:Query | None=None, extra_body:Body | None=None,\n    timeout:float | httpx.Timeout | None | NotGiven=NOT_GIVEN\n):\n\nMake a call to Claude.\n\n\nExported source\n@patch\ndef _precall(self:Client, msgs, prefill, sp, temp, maxtok, maxthinktok, stream,\n             stop, tools, tool_choice, kwargs):\n    if tools: kwargs['tools'] = [get_schema(o) if callable(o) else o for o in listify(tools)]\n    if tool_choice: kwargs['tool_choice'] = mk_tool_choice(tool_choice)\n    if maxthinktok: \n        kwargs['thinking'] = {'type':'enabled', 'budget_tokens':maxthinktok} \n        temp,prefill = 1,''\n    pref = [prefill.strip()] if prefill else []\n    if not isinstance(msgs,list): msgs = [msgs]\n    if stop is not None:\n        if not isinstance(stop, (list)): stop = [stop]\n        kwargs[\"stop_sequences\"] = stop\n    msgs = mk_msgs(msgs+pref, cache=self.cache, cache_last_ckpt_only=self.cache)\n    assert not ('image' in get_types(msgs) and self.text_only), f\"Images not supported by: {self.model}\"\n    kwargs |= dict(max_tokens=maxtok, system=sp, temperature=temp)\n    return msgs, kwargs\n\n\n\n\nExported source\n@patch\n@delegates(messages.Messages.create)\ndef __call__(self:Client,\n             msgs:list, # List of messages in the dialog\n             sp='', # The system prompt\n             temp=0, # Temperature\n             maxtok=4096, # Maximum tokens\n             maxthinktok=0, # Maximum thinking tokens\n             prefill='', # Optional prefill to pass to Claude as start of its response\n             stream:bool=False, # Stream response?\n             stop=None, # Stop sequence\n             tools:Optional[list]=None, # List of tools to make available to Claude\n             tool_choice:Optional[dict]=None, # Optionally force use of some tool\n             cb=None, # Callback to pass result to when complete\n             **kwargs):\n    \"Make a call to Claude.\"\n    msgs,kwargs = self._precall(msgs, prefill, sp, temp, maxtok, maxthinktok, stream,\n                                stop, tools, tool_choice, kwargs)\n    m = self.c.messages\n    f = m.stream if stream else m.create\n    res = f(model=self.model, messages=msgs, **kwargs)\n    def _cb(v):\n        self._log(v, prefill=prefill, msgs=msgs, **kwargs)\n        if cb: cb(v)\n    if stream: return _stream(res, prefill, _cb)\n    try: return res\n    finally: _cb(res)\n\n\nDefining __call__ let’s us use an object like a function (i.e it’s callable). We use it as a small wrapper over messages.create.\n\nc = Client(model, log=True)\nc.use\n\nIn: 0; Out: 0; Cache create: 0; Cache read: 0; Total Tokens: 0; Search: 0; Fetch: 0\n\n\n\nc('Hi')\n\nHi there! How are you doing? Is there something I can help you with today? 😊\n\n\nid: msg_01NSbD7ZmQJKeY16gJ6apjAH\ncontainer: None\ncontent: [{'citations': None, 'text': 'Hi there! How are you doing? Is there something I can help you with today? 😊', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 8, 'output_tokens': 24, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nUsage details are automatically updated after each call:\n\nc.use\n\nIn: 8; Out: 24; Cache create: 0; Cache read: 0; Total Tokens: 32; Search: 0; Fetch: 0\n\n\nA log of all messages is kept if log=True is passed:\n\npprint(c.log)\n\n[{'max_tokens': 4096,\n  'msgs': [{'content': 'Hi', 'role': 'user'}],\n  'result': Message(id='msg_01NSbD7ZmQJKeY16gJ6apjAH', container=None, content=[TextBlock(citations=None, text='Hi there! How are you doing? Is there something I can help you with today? 😊', type='text')], model='claude-sonnet-4-6', role='assistant', stop_reason='end_turn', stop_sequence=None, type='message', usage=In: 8; Out: 24; Cache create: 0; Cache read: 0; Total Tokens: 32; Search: 0; Fetch: 0),\n  'stop_reason': 'end_turn',\n  'stop_sequence': None,\n  'system': '',\n  'temperature': 0,\n  'use': In: 8; Out: 24; Cache create: 0; Cache read: 0; Total Tokens: 32; Search: 0; Fetch: 0}]\n\n\n\nc.use\n\nIn: 8; Out: 24; Cache create: 0; Cache read: 0; Total Tokens: 32; Search: 0; Fetch: 0\n\n\nWe can pass stream=True to stream the response back incrementally:\n\nr = c('Hi', stream=True)\nfor o in r: print(o, end='')\n\nHi there! How are you doing? Is there something I can help you with today? 😊\n\n\n\nc.use\n\nIn: 16; Out: 48; Cache create: 0; Cache read: 0; Total Tokens: 64; Search: 0; Fetch: 0\n\n\nThe full final message after completion of streaming is in the value attr of the response:\n\nr.value\n\nHi there! How are you doing? Is there something I can help you with today? 😊\n\n\nid: msg_01Nu7hy5Yi1KdQXg48jpFVCS\ncontainer: None\ncontent: [{'citations': None, 'text': 'Hi there! How are you doing? Is there something I can help you with today? 😊', 'type': 'text', 'parsed_output': None}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 8, 'output_tokens': 24, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nPass a stop sequence if you want claude to stop generating text when it encounters it.\n\nc(\"Count from 1 to 10\", stop=\"5\")\n\nHere are the numbers from 1 to 10:\n1, 2, 3, 4,\n\n\nid: msg_01UNUPpjNHteRG8DTrSUw4Hm\ncontainer: None\ncontent: [{'citations': None, 'text': 'Here are the numbers from 1 to 10:\\n\\n1, 2, 3, 4, ', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: stop_sequence\nstop_sequence: 5\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 15, 'output_tokens': 26, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nThis also works with streaming, and you can pass more than one stop sequence:\n\nfor o in c(\"Count from 1 to 10\", stop=[\"3\", \"yellow\"], stream=True): print(o, end='')\nprint()\nprint(c.stop_reason, c.stop_sequence)\n\nHere is counting from 1 to 10:\n\n1, 2, \nstop_sequence 3\n\n\nWe’ve shown the token usage but we really care about is pricing. Let’s extract the latest pricing from Anthropic into a pricing dict.\n\nsource\n\n\nget_pricing\n\ndef get_pricing(\n    m, u\n):\n\n\n\nExported source\ndef get_pricing(m, u):\n    return pricing[m][:3] if u.prompt_token_count &lt; 128_000 else pricing[m][3:]\n\n\nSimilarly, let’s get the pricing for the latest server tools:\nWe’ll patch Usage to enable it compute the cost given pricing.\n\nsource\n\n\nUsage.cost\n\ndef cost(\n    costs:tuple\n)-&gt;float:\n\n\n\nExported source\n@patch\ndef cost(self:Usage, costs:tuple) -&gt; float:\n    cache_w, cache_r = _dgetattr(self, \"cache_creation_input_tokens\",0), _dgetattr(self, \"cache_read_input_tokens\",0)\n    tok_cost = sum([self.input_tokens * costs[0] +  self.output_tokens * costs[1] +  cache_w * costs[2] + cache_r * costs[3]]) / 1e6\n    server_tool_use = _dgetattr(self, \"server_tool_use\",server_tool_usage())\n    server_tool_cost = server_tool_use.web_search_requests * server_tool_pricing['web_search_requests'] / 1e3\n    return tok_cost + server_tool_cost\n\n\n\nsource\n\n\nClient.cost\n\ndef cost(\n    \n)-&gt;float:\n\n\n\nExported source\n@patch(as_prop=True)\ndef cost(self: Client) -&gt; float: return self.use.cost(pricing[model_types[self.model]])\n\n\n\nsource\n\n\nget_costs\n\ndef get_costs(\n    c\n):\n\n\n\nExported source\ndef get_costs(c):\n    costs = pricing[model_types[c.model]]\n    \n    inp_cost = c.use.input_tokens * costs[0] / 1e6\n    out_cost = c.use.output_tokens * costs[1] / 1e6\n\n    cache_w = c.use.cache_creation_input_tokens   \n    cache_r = c.use.cache_read_input_tokens\n    cache_cost = (cache_w * costs[2] + cache_r * costs[3]) / 1e6\n\n    server_tool_use = c.use.server_tool_use\n    server_tool_cost = server_tool_use.web_search_requests * server_tool_pricing['web_search_requests'] / 1e3\n    return inp_cost, out_cost, cache_cost, cache_w + cache_r, server_tool_cost\n\n\nThe markdown repr of the client itself will show the latest result, along with the usage so far.\n\n\nExported source\n@patch\ndef _repr_markdown_(self:Client):\n    if not hasattr(self,'result'): return 'No results yet'\n    msg = contents(self.result)\n    inp_cost, out_cost, cache_cost, cached_toks, server_tool_cost = get_costs(self)\n    return f\"\"\"{msg}\n\n| Metric | Count | Cost (USD) |\n|--------|------:|-----:|\n| Input tokens | {self.use.input_tokens:,} | {inp_cost:.6f} |\n| Output tokens | {self.use.output_tokens:,} | {out_cost:.6f} |\n| Cache tokens | {cached_toks:,} | {cache_cost:.6f} |\n| Server tool use | {self.use.server_tool_use.web_search_requests:,} | {server_tool_cost:.6f} |\n| **Total** | **{self.use.total:,}** | **${self.cost:.6f}** |\"\"\"\n\n\n\nc\n\nHere is counting from 1 to 10:\n1, 2,\n\n\n\nMetric\nCount\nCost (USD)\n\n\n\n\nInput tokens\n46\n0.000138\n\n\nOutput tokens\n93\n0.001395\n\n\nCache tokens\n0\n0.000000\n\n\nServer tool use\n0\n0.000000\n\n\nTotal\n139\n$0.001533\n\n\n\n\n\nPass a list of alternating user/assistant messages to give Claude a “dialog”.\n\nc([\"My name is Jeremy\", \"Hi Jeremy!\", \"Can you remind me what my name is?\"])\n\nYour name is Jeremy! You told me that at the start of our conversation.\n\n\nid: msg_01UF9i1HRnHDXaMHvNdWJJwf\ncontainer: None\ncontent: [{'citations': None, 'text': 'Your name is Jeremy! You told me that at the start of our conversation.', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 29, 'output_tokens': 19, 'server_tool_use': None, 'service_tier': 'standard'}",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#tool-use",
    "href": "core.html#tool-use",
    "title": "Claudette’s source",
    "section": "Tool use",
    "text": "Tool use\nLet’s now look more at tool use (aka function calling).\nFor testing, we need a function that Claude can call; we’ll write a simple function that adds numbers together, and will tell us when it’s being called:\n\n@dataclass\nclass MySum: val:int\n\ndef sums(\n    a:int,  # First thing to sum\n    b:int=1 # Second thing to sum\n) -&gt; int: # The sum of the inputs\n    \"Adds a + b.\"\n    print(f\"Finding the sum of {a} and {b}\")\n    return MySum(a + b)\n\n\na,b = 604542,6458932\npr = f\"What is {a}+{b}?\"\nsp = \"Always use tools when calculations are required.\"\n\nClaudette can autogenerate a schema thanks to the toolslm library. We’ll force the use of the tool using the function we created earlier.\n\ntools=[get_schema(sums)]\nchoice = mk_tool_choice('sums')\n\nWe’ll start a dialog with Claude now. We’ll store the messages of our dialog in msgs. The first message will be our prompt pr, and we’ll pass our tools schema.\n\nmsgs = mk_msgs(pr)\nr = c(msgs, sp=sp, tools=tools, tool_choice=choice)\nr\n\nToolUseBlock(id=‘toolu_01Rk1eL2Zkx92c4c3FJJAjFu’, caller=DirectCaller(type=‘direct’), input={‘a’: 604542, ‘b’: 6458932}, name=‘sums’, type=‘tool_use’)\n\n\nid: msg_01KK6wvRhJM93T4ZMo5XtYqZ\ncontainer: None\ncontent: [{'id': 'toolu_01Rk1eL2Zkx92c4c3FJJAjFu', 'caller': {'type': 'direct'}, 'input': {'a': 604542, 'b': 6458932}, 'name': 'sums', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 720, 'output_tokens': 57, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nWhen Claude decides that it should use a tool, it passes back a ToolUseBlock with the name of the tool to call, and the params to use.\nWe don’t want to allow it to call just any possible function (that would be a security disaster!) so we create a namespace – that is, a dictionary of allowable function names to call.\n\nns = mk_ns(sums)\nns\n\n{'sums': &lt;function __main__.sums(a: int, b: int = 1) -&gt; int&gt;}\n\n\nToolResult is used for two special cases:\n\nWhen tool calls are RPCs with claudette running on an application server and code execution happening elsewhere, wrapping with a result_type field is used as a type descriptor for the claudette client.\nDifferent types are handled in message history with specific format, so mk_funcres branches the Anthropic representation (see depending on the result_type.\n\nCurrently images are the only supported tool result type - see https://docs.anthropic.com/en/docs/agents-and-tools/tool-use/implement-tool-use#example-of-tool-result-with-images for the format implemented in mk_funcres.\n\nsource\n\nToolResult\n\ndef ToolResult(\n    result_type:str, data\n):\n\nBase class for objects needing a basic __repr__\n\nsource\n\n\nmk_funcres\n\ndef mk_funcres(\n    fc, ns\n):\n\nGiven tool use block ‘fc’, get tool result, and create a tool_result response.\nWe can now use the function requested by Claude. We look it up in ns, and pass in the provided parameters.\n\nfcs = [o for o in r.content if isinstance(o,ToolUseBlock)]\nfcs\n\n[ToolUseBlock(id='toolu_01Rk1eL2Zkx92c4c3FJJAjFu', caller=DirectCaller(type='direct'), input={'a': 604542, 'b': 6458932}, name='sums', type='tool_use')]\n\n\n\nres = [mk_funcres(fc, ns=ns) for fc in fcs]\nres\n\nFinding the sum of 604542 and 6458932\n\n\n[{'type': 'tool_result',\n  'tool_use_id': 'toolu_01Rk1eL2Zkx92c4c3FJJAjFu',\n  'content': 'MySum(val=7063474)'}]\n\n\n\nres = [mk_funcres(fc, ns={}) for fc in fcs]\nres\n\n[{'type': 'tool_result',\n  'tool_use_id': 'toolu_01Rk1eL2Zkx92c4c3FJJAjFu',\n  'content': 'Error - tool not defined in the tool_schemas: sums'}]\n\n\n\n\nLimit tool access\n\n@dataclass\nclass MyProd: val:int\n\ndef mults(a:int,b:int):\n    \"Multiplies two integers\"\n    return MyProd(a*b)\n\n\ntools = [get_schema(sums), get_schema(mults)]\nchoice = mk_tool_choice('sums')\n\n\ntools\n\n[{'name': 'sums',\n  'description': 'Adds a + b.\\n\\nReturns:\\n- The sum of the inputs (type: integer)',\n  'input_schema': {'type': 'object',\n   'properties': {'a': {'type': 'integer',\n     'description': 'First thing to sum'},\n    'b': {'type': 'integer',\n     'description': 'Second thing to sum',\n     'default': 1}},\n   'required': ['a']}},\n {'name': 'mults',\n  'description': 'Multiplies two integers',\n  'input_schema': {'type': 'object',\n   'properties': {'a': {'type': 'integer', 'description': ''},\n    'b': {'type': 'integer', 'description': ''}},\n   'required': ['a', 'b']}}]\n\n\n\nsource\n\n\nallowed_tools\n\ndef allowed_tools(\n    specs:Optional, choice:Union=None\n):\n\n\n\nExported source\ndef allowed_tools(specs: Optional[list[Union[str,abc.Callable]]], choice: Optional[Union[dict,str]]=None):\n    if not isinstance(choice, dict): choice=mk_tool_choice(choice)\n    if choice['type'] == 'tool': return {choice['name']}\n    if choice['type'] == 'none': return set()\n    return {v['name'] if isinstance(v, dict) else v.__name__ for v in specs or []}\n\n\n\nallowed_tools(tools, choice)\n\n{'sums'}\n\n\n\nallowed_tools([sums, mults], 'mults')\n\n{'mults'}\n\n\n\nallowed_tools(tools, None)\n\n{'mults', 'sums'}\n\n\n\nallowed_tools(tools, 'sums')\n\n{'sums'}\n\n\n\nallowed_tools(tools, True)\n\n{'mults', 'sums'}\n\n\n\nsource\n\n\nlimit_ns\n\ndef limit_ns(\n    ns:Optional=None, # Namespace to search for tools\n    specs:Optional=None, # List of the tools that are allowed for llm to call\n    choice:Union=None, # Tool choice as defined by Anthropic API\n):\n\nFilter namespace ns to only include tools allowed by specs and choice\n\n\nExported source\ndef limit_ns(\n    ns:Optional[abc.Mapping]=None, # Namespace to search for tools\n    specs:Optional[list[Union[str,abc.Callable]]]=None, # List of the tools that are allowed for llm to call\n    choice:Optional[Union[dict,str]]=None # Tool choice as defined by Anthropic API\n    ):\n    \"Filter namespace `ns` to only include tools allowed by `specs` and `choice`\"\n    if ns is None: ns=globals()\n    if not isinstance(ns, abc.Mapping): ns = mk_ns(ns)\n    ns = {k:ns[k] for k in allowed_tools(specs, choice) if k in ns}\n    return ns\n\n\n\nsource\n\n\nmk_toolres\n\ndef mk_toolres(\n    r:Mapping, # Tool use request response from Claude\n    ns:Optional=None, # Namespace to search for tools\n):\n\nCreate a tool_result message from response r.\n\n\nExported source\ndef mk_toolres(\n    r:abc.Mapping, # Tool use request response from Claude\n    ns:Optional[abc.Mapping]=None, # Namespace to search for tools\n    ):\n    \"Create a `tool_result` message from response `r`.\"\n    cts = getattr(r, 'content', [])\n    res = [mk_msg(r.model_dump(exclude_none=True), role='assistant')]\n    if ns is None: ns=globals()\n    tcs = [mk_funcres(o, ns) for o in cts if isinstance(o,ToolUseBlock)]\n    if tcs: res.append(mk_msg(tcs))\n    return res\n\n\n\nfoo = []\nfoo.append({})\nfoo.append({})\nfoo\n\n[{}, {}]\n\n\nIn order to tell Claude the result of the tool call, we pass back the tool use assistant request and the tool_result response.\n\ntr = mk_toolres(r, ns=ns)\ntr\n\nFinding the sum of 604542 and 6458932\n\n\n[{'role': 'assistant',\n  'content': [{'id': 'toolu_01Rk1eL2Zkx92c4c3FJJAjFu',\n    'caller': {'type': 'direct'},\n    'input': {'a': 604542, 'b': 6458932},\n    'name': 'sums',\n    'type': 'tool_use'}]},\n {'role': 'user',\n  'content': [{'type': 'tool_result',\n    'tool_use_id': 'toolu_01Rk1eL2Zkx92c4c3FJJAjFu',\n    'content': 'MySum(val=7063474)'}]}]\n\n\n\nmsgs\n\n[{'role': 'user', 'content': 'What is 604542+6458932?'}]\n\n\nWe add this to our dialog, and now Claude has all the information it needs to answer our question.\n\nmsgs += tr\ncontents(c(msgs, sp=sp, tools=tools))\n\n'The sum of 604,542 + 6,458,932 = **7,063,474**.'\n\n\n\ncontents(msgs[-1])\n\n'MySum(val=7063474)'\n\n\n\nmsgs\n\n[{'role': 'user', 'content': 'What is 604542+6458932?'},\n {'role': 'assistant',\n  'content': [{'id': 'toolu_01Rk1eL2Zkx92c4c3FJJAjFu',\n    'caller': {'type': 'direct'},\n    'input': {'a': 604542, 'b': 6458932},\n    'name': 'sums',\n    'type': 'tool_use'}]},\n {'role': 'user',\n  'content': [{'type': 'tool_result',\n    'tool_use_id': 'toolu_01Rk1eL2Zkx92c4c3FJJAjFu',\n    'content': 'MySum(val=7063474)'}]}]\n\n\nThe tools calls are limited to what is present in tool_spec.\n\ntr = mk_toolres(r, ns=limit_ns(None, tools, 'mults'))\ntr\n\n[{'role': 'assistant',\n  'content': [{'id': 'toolu_01Rk1eL2Zkx92c4c3FJJAjFu',\n    'caller': {'type': 'direct'},\n    'input': {'a': 604542, 'b': 6458932},\n    'name': 'sums',\n    'type': 'tool_use'}]},\n {'role': 'user',\n  'content': [{'type': 'tool_result',\n    'tool_use_id': 'toolu_01Rk1eL2Zkx92c4c3FJJAjFu',\n    'content': 'Error - tool not defined in the tool_schemas: sums'}]}]\n\n\n\n\nText editing\nAnthropic also has a special tool type specific to text editing.\n\ntools = [text_editor_conf['sonnet']]\ntools\n\n[{'type': 'text_editor_20250728', 'name': 'str_replace_based_edit_tool'}]\n\n\n\npr = 'Could you please very briefly explain my _quarto.yml file?'\nmsgs = [mk_msg(pr)]\nr = c(msgs, sp=sp, tools=tools)\nfind_block(r, ToolUseBlock)\n\nToolUseBlock(id='toolu_01VuDPR85jDHdSrnCmK52WgL', caller=DirectCaller(type='direct'), input={'command': 'view', 'path': '/_quarto.yml'}, name='str_replace_based_edit_tool', type='tool_use')\n\n\nWe’ve gone ahead and create a reference implementation that you can directly use from our text_editor module. Or use as reference for creating your own.\n\nns = mk_ns(str_replace_based_edit_tool)\ntr = mk_toolres(r, ns=ns)\nmsgs += tr\nprint(contents(c(msgs, sp=sp, tools=tools))[:128])\n\nIt seems the file wasn't found at the root path. Could you provide the exact location of your `_quarto.yml` file so I can take a",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#structured-data",
    "href": "core.html#structured-data",
    "title": "Claudette’s source",
    "section": "Structured data",
    "text": "Structured data\n\na,b = 604542,6458932\npr = f\"What is {a}+{b}?\"\nsp = \"Always use your tools for calculations.\"\n\n\nfor tools in [sums, [get_schema(sums)]]:\n    r = c(pr, tools=tools, tool_choice='sums')\n    print(r)\n\nMessage(id='msg_01LD3r7hwAkYtWg4XW6A1UaB', container=None, content=[ToolUseBlock(id='toolu_014XCGyV6twGuQxkv8dWGbSc', caller=DirectCaller(type='direct'), input={'a': 604542, 'b': 6458932}, name='sums', type='tool_use')], model='claude-sonnet-4-6', role='assistant', stop_reason='tool_use', stop_sequence=None, type='message', usage=In: 715; Out: 53; Cache create: 0; Cache read: 0; Total Tokens: 768; Search: 0; Fetch: 0)\nMessage(id='msg_01LD3r7hwAkYtWg4XW6A1UaB', container=None, content=[ToolUseBlock(id='toolu_014XCGyV6twGuQxkv8dWGbSc', caller=DirectCaller(type='direct'), input={'a': 604542, 'b': 6458932}, name='sums', type='tool_use')], model='claude-sonnet-4-6', role='assistant', stop_reason='tool_use', stop_sequence=None, type='message', usage=In: 715; Out: 53; Cache create: 0; Cache read: 0; Total Tokens: 768; Search: 0; Fetch: 0)\n\n\n\nns = mk_ns(sums)\ntr = mk_toolres(r, ns=ns)\n\nFinding the sum of 604542 and 6458932\n\n\n\nsource\n\nClient.structured\n\ndef structured(\n    msgs:list, # List of messages in the dialog\n    tools:list=None, # List of tools to make available to Claude\n    ns:Optional=None, # Namespace to search for tools\n    sp:str='', # The system prompt\n    temp:int=0, # Temperature\n    maxtok:int=4096, # Maximum tokens\n    maxthinktok:int=0, # Maximum thinking tokens\n    prefill:str='', # Optional prefill to pass to Claude as start of its response\n    stream:bool=False, # Stream response?\n    stop:NoneType=None, # Stop sequence\n    tool_choice:Optional=None, # Optionally force use of some tool\n    cb:NoneType=None, # Callback to pass result to when complete\n    cache_control:Optional[CacheControlEphemeralParam] | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    container:Optional[str] | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    inference_geo:Optional[str] | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    metadata:MetadataParam | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    output_config:OutputConfigParam | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    service_tier:Literal['auto', 'standard_only'] | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    stop_sequences:SequenceNotStr[str] | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    system:Union[str, Iterable[TextBlockParam]] | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    temperature:float | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    thinking:ThinkingConfigParam | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    top_k:int | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    top_p:float | Omit=&lt;anthropic.Omit object at 0x7fcd6121e210&gt;,\n    extra_headers:Headers | None=None, # Use the following arguments if you need to pass additional parameters to the API that aren't available via kwargs.\nThe extra values given here take precedence over values defined on the client or passed to this method.\n    extra_query:Query | None=None, extra_body:Body | None=None,\n    timeout:float | httpx.Timeout | None | NotGiven=NOT_GIVEN\n):\n\nReturn the value of all tool calls (generally used for structured outputs)\n\n\nExported source\n@patch\n@delegates(Client.__call__)\ndef structured(self:Client,\n               msgs:list, # List of messages in the dialog\n               tools:list[abc.Callable]=None, # List of tools to make available to Claude\n               ns:Optional[abc.Mapping]=None, # Namespace to search for tools\n               **kwargs):\n    \"Return the value of all tool calls (generally used for structured outputs)\"\n    tools = listify(tools)\n    res = self(msgs, tools=tools, tool_choice=tools, **kwargs)\n    if ns is None: ns=mk_ns(*tools)\n    cts = getattr(res, 'content', [])\n    tcs = [call_func(o.name, o.input, ns=ns) for o in cts if isinstance(o,ToolUseBlock)]\n    return tcs\n\n\nAnthropic’s API does not support response formats directly, so instead we provide a structured method to use tool calling to achieve the same result. The result of the tool is not passed back to Claude in this case, but instead is returned directly to the user.\n\nc.structured(pr, tools=[sums])\n\nFinding the sum of 604542 and 6458932\n\n\n[MySum(val=7063474)]\n\n\n\nc\n\nToolUseBlock(id=‘toolu_01ENhz5EnfqZFT8PeizJ3gKr’, caller=DirectCaller(type=‘direct’), input={‘a’: 604542, ‘b’: 6458932}, name=‘sums’, type=‘tool_use’)\n\n\n\nMetric\nCount\nCost (USD)\n\n\n\n\nInput tokens\n6,400\n0.019200\n\n\nOutput tokens\n499\n0.007485\n\n\nCache tokens\n0\n0.000000\n\n\nServer tool use\n0\n0.000000\n\n\nTotal\n6,899\n$0.026685",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#custom-types-with-tools-use",
    "href": "core.html#custom-types-with-tools-use",
    "title": "Claudette’s source",
    "section": "Custom Types with Tools Use",
    "text": "Custom Types with Tools Use\nWe need to add tool support for custom types too. Let’s test out custom types using a minimal example.\n\nclass Book(BasicRepr):\n    def __init__(self, title: str, pages: int): store_attr()\n    def __repr__(self):\n        return f\"Book Title : {self.title}\\nNumber of Pages : {self.pages}\"\n\n\nBook(\"War and Peace\", 950)\n\nBook Title : War and Peace\nNumber of Pages : 950\n\n\n\ndef find_page(book: Book, # The book to find the halfway point of\n              percent: int, # Percent of a book to read to, e.g. halfway == 50, \n) -&gt; int:\n    \"The page number corresponding to `percent` completion of a book\"\n    return round(book.pages * (percent / 100.0))\n\n\nget_schema(find_page)\n\n{'name': 'find_page',\n 'description': 'The page number corresponding to `percent` completion of a book\\n\\nReturns:\\n- type: integer',\n 'input_schema': {'type': 'object',\n  'properties': {'book': {'type': 'object',\n    'description': 'The book to find the halfway point of',\n    '$ref': '#/$defs/Book'},\n   'percent': {'type': 'integer',\n    'description': 'Percent of a book to read to, e.g. halfway == 50,'}},\n  'required': ['book', 'percent'],\n  '$defs': {'Book': {'type': 'object',\n    'properties': {'title': {'type': 'string', 'description': ''},\n     'pages': {'type': 'integer', 'description': ''}},\n    'title': 'Book',\n    'required': ['title', 'pages']}}}}\n\n\n\nchoice = mk_tool_choice('find_page')\nchoice\n\n{'type': 'tool', 'name': 'find_page'}\n\n\nClaudette will pack objects as dict, so we’ll transform tool functions with user-defined types into tool functions that accept a dict in lieu of the user-defined type.\nFirst let’s convert a single argument:\n_is_builtin decides whether to pass an argument through as-is. Let’s check the argument conversion:\n\n(_is_builtin(int), _is_builtin(Book), _is_builtin(List))\n\n(True, False, True)\n\n\n\n(_convert(555, int),\n _convert({\"title\": \"War and Peace\", \"pages\": 923}, Book),\n _convert([1, 2, 3, 4], List))\n\n(555,\n Book Title : War and Peace\n Number of Pages : 923,\n [1, 2, 3, 4])\n\n\nTo apply tool() to a function is to return a new function where the user-defined types are replaced with dictionary inputs.\n\nsource\n\ntool\n\ndef tool(\n    func\n):\n\nA function is transformed into a function with dict arguments substituted for user-defined types. Built-in types such as percent here are left untouched.\n\nfind_page(book=Book(\"War and Peace\", 950), percent=50)\n\n475\n\n\n\ntool(find_page)({\"title\": \"War and Peace\", \"pages\": 950}, percent=50)\n\n475\n\n\nBy passing tools wrapped by tool(), user-defined types now work completes without failing in tool calls.\n\npr = \"How many pages do I have to read to get halfway through my 950 page copy of War and Peace\"\ntools = tool(find_page)\ntools\n\n&lt;function __main__.find_page(book: __main__.Book, percent: int) -&gt; int&gt;\n\n\n\nr = c(pr, tools=[tools])\nfind_block(r, ToolUseBlock)\n\nToolUseBlock(id='toolu_01DpqxJGneGatm3JyYr3aNie', caller=DirectCaller(type='direct'), input={'book': {'title': 'War and Peace', 'pages': 950}, 'percent': 50}, name='find_page', type='tool_use')\n\n\n\ntr = mk_toolres(r, ns=[tools])\ntr\n\n[{'role': 'assistant',\n  'content': [{'text': 'Let me find the halfway point of your book right away!',\n    'type': 'text'},\n   {'id': 'toolu_01DpqxJGneGatm3JyYr3aNie',\n    'caller': {'type': 'direct'},\n    'input': {'book': {'title': 'War and Peace', 'pages': 950}, 'percent': 50},\n    'name': 'find_page',\n    'type': 'tool_use'}]},\n {'role': 'user',\n  'content': [{'type': 'tool_result',\n    'tool_use_id': 'toolu_01DpqxJGneGatm3JyYr3aNie',\n    'content': '475'}]}]\n\n\n\nmsgs = [pr]+tr\ncontents(c(msgs, sp=sp, tools=[tools]))\n\n\"You'll need to read **475 pages** to get halfway through your 950-page copy of *War and Peace*. You've got quite the reading adventure ahead of you — happy reading! 📖\"",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#chat",
    "href": "core.html#chat",
    "title": "Claudette’s source",
    "section": "Chat",
    "text": "Chat\nRather than manually adding the responses to a dialog, we’ll create a simple Chat class to do that for us, each time we make a request. We’ll also store the system prompt and tools here, to avoid passing them every time.\n\nsource\n\nChat\n\ndef Chat(\n    model:Optional=None, # Model to use (leave empty if passing `cli`)\n    cli:Optional=None, # Client to use (leave empty if passing `model`)\n    sp:str='', # Optional system prompt\n    tools:Optional=None, # List of tools to make available to Claude\n    temp:int=0, # Temperature\n    cont_pr:Optional=None, # User prompt to continue an assistant response\n    cache:bool=False, # Use Claude cache?\n    hist:list=None, # Initialize history\n    ns:Optional=None, # Namespace to search for tools\n):\n\nAnthropic chat client.\nThe class stores the Client that will provide the responses in c, and a history of messages in h.\n\nsp = \"Never mention what tools you use.\"\nchat = Chat(model, sp=sp)\nchat.c.use, chat.h\n\n(In: 0; Out: 0; Cache create: 0; Cache read: 0; Total Tokens: 0; Search: 0; Fetch: 0,\n [])\n\n\n\nchat.c.use.cost(pricing[model_types[chat.c.model]])\n\n0.0\n\n\nThis is clunky. Let’s add cost as a property for the Chat class. It will pass in the appropriate prices for the current model to the usage cost calculator.\n\nsource\n\n\nChat.cost\n\ndef cost(\n    \n)-&gt;float:\n\n\n\nExported source\n@patch(as_prop=True)\ndef cost(self: Chat) -&gt; float: return self.c.cost\n\n\n\nchat.cost\n\n0.0\n\n\n\nsource\n\n\nChat.__call__\n\ndef __call__(\n    pr:NoneType=None, # Prompt / message\n    temp:NoneType=None, # Temperature\n    maxtok:int=4096, # Maximum tokens\n    maxthinktok:int=0, # Maximum thinking tokens\n    stream:bool=False, # Stream response?\n    prefill:str='', # Optional prefill to pass to Claude as start of its response\n    tool_choice:Optional=None, # Optionally force use of some tool\n    kw:VAR_KEYWORD\n):\n\nCall self as a function.\n\n\nExported source\n@patch\ndef _post_pr(self:Chat, pr, prev_role):\n    if pr is None and prev_role == 'assistant':\n        if self.cont_pr is None:\n            raise ValueError(\"Prompt must be given after completion, or use `self.cont_pr`.\")\n        pr = self.cont_pr # No user prompt, keep the chain\n    if pr: self.h.append(mk_msg(pr, cache=self.cache))\n\n\n\n\nExported source\n@patch\ndef _append_pr(self:Chat, pr=None):\n    prev_role = nested_idx(self.h, -1, 'role') if self.h else 'assistant' # First message should be 'user'\n    if pr and prev_role == 'user': self() # already user request pending\n    self._post_pr(pr, prev_role)\n\n\n\n\nExported source\n@patch\ndef __call__(self:Chat,\n             pr=None,  # Prompt / message\n             temp=None, # Temperature\n             maxtok=4096, # Maximum tokens\n             maxthinktok=0, # Maximum thinking tokens\n             stream=False, # Stream response?\n             prefill='', # Optional prefill to pass to Claude as start of its response\n             tool_choice:Optional[dict]=None, # Optionally force use of some tool\n             **kw):\n    if temp is None: temp=self.temp\n    self._append_pr(pr)\n    def _cb(v):\n        self.last = mk_toolres(v, ns=limit_ns(self.ns, self.tools, tool_choice))\n        self.h += self.last\n    return self.c(self.h, stream=stream, prefill=prefill, sp=self.sp, temp=temp, maxtok=maxtok, maxthinktok=maxthinktok,\n                 tools=self.tools, tool_choice=tool_choice, cb=_cb, **kw)\n\n\nThe __call__ method just passes the request along to the Client, but rather than just passing in this one prompt, it appends it to the history and passes it all along. As a result, we now have state!\n\nchat = Chat(model, sp=sp)\n\n\nchat(\"I'm Jeremy\")\nchat(\"What's my name?\")\n\nYour name is Jeremy! You told me that at the start of our conversation.\n\n\nid: msg_01P1dvBtCrRx33Z6FSzcoaYT\ncontainer: None\ncontent: [{'citations': None, 'text': 'Your name is Jeremy! You told me that at the start of our conversation.', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 44, 'output_tokens': 19, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat.use, chat.cost\n\n(In: 62; Out: 37; Cache create: 0; Cache read: 0; Total Tokens: 99; Search: 0; Fetch: 0,\n 0.000741)\n\n\nBy default messages must be in user, assistant, user format. If this isn’t followed (aka calling chat() without a user message) it will error out:\n\ntry: chat()\nexcept ValueError as e: print(\"Error:\", e)\n\nError: Prompt must be given after completion, or use `self.cont_pr`.\n\n\nSetting cont_pr allows a “default prompt” to be specified when a prompt isn’t specified. Usually used to prompt the model to continue.\n\nchat.cont_pr = \"Tell me a little more...\"\nchat()\n\nThat’s actually all I know about you! You just told me your name is Jeremy, but beyond that, I don’t have any other information about you. I only know what you share with me in our conversation.\nIs there something you’d like to tell me about yourself, or is there something I can help you with? 😊\n\n\nid: msg_014GNbvuJySM2FNydyTvHnZ6\ncontainer: None\ncontent: [{'citations': None, 'text': \"That's actually all I know about you! You just told me your name is Jeremy, but beyond that, I don't have any other information about you. I only know what you share with me in our conversation.\\n\\nIs there something you'd like to tell me about yourself, or is there something I can help you with? 😊\", 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 72, 'output_tokens': 73, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nWe can also use streaming:\n\nchat = Chat(model, sp=sp)\nfor o in chat(\"I'm Jeremy\", stream=True): print(o, end='')\n\nHi Jeremy! Nice to meet you. How can I help you today?\n\n\nYou can provide a history of messages to initialise Chat with:\n\nchat = Chat(model, sp=sp, hist=[\"Can you guess my name?\", \"Hmmm I really don't know. Is it 'Merlin G. Penfolds'?\"])\nchat('Wow how did you know?')\n\nI have to be honest with you - I didn’t actually know! That was just a random guess, and it was quite a coincidence that it matched your name! I have no way of knowing personal information about you unless you share it with me. I should have been upfront about that from the start rather than making a random guess. I’m sorry for any confusion!\n\n\nid: msg_01RmtMSvQpWsDNdTgZdRpKXb\ncontainer: None\ncontent: [{'citations': None, 'text': \"I have to be honest with you - I didn't actually know! That was just a random guess, and it was quite a coincidence that it matched your name! I have no way of knowing personal information about you unless you share it with me. I should have been upfront about that from the start rather than making a random guess. I'm sorry for any confusion!\", 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 59, 'output_tokens': 79, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\n\nChat tool use\nWe automagically get streamlined tool use as well:\n\npr = f\"What is {a}+{b}?\"\npr\n\n'What is 604542+6458932?'\n\n\n\nchat = Chat(model, sp=sp, tools=[sums])\nr = chat(pr)\nr\n\nFinding the sum of 604542 and 6458932\n\n\nLet me calculate that for you!\n\n\nid: msg_01J64NLNAmMicFA6nhmuT6pM\ncontainer: None\ncontent: [{'citations': None, 'text': 'Let me calculate that for you!', 'type': 'text'}, {'id': 'toolu_017rP1c4tyoBaMyDT2pjRMcH', 'caller': {'type': 'direct'}, 'input': {'a': 604542, 'b': 6458932}, 'name': 'sums', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 627, 'output_tokens': 80, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nNow we need to send this result to Claude—calling the object with no parameters tells it to return the tool result to Claude:\n\nchat()\n\nThe result of 604,542 + 6,458,932 = 7,063,474!\n\n\nid: msg_013HLnrJxLLM165PKGnnHBmJ\ncontainer: None\ncontent: [{'citations': None, 'text': 'The result of **604,542 + 6,458,932 = 7,063,474**!', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 727, 'output_tokens': 28, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nIt should be correct, because it actually used our Python function to do the addition. Let’s check:\n\na+b\n\n7063474\n\n\nLet’s try the same thing with streaming:\n\nchat = Chat(model, sp=sp, tools=[sums])\nr = chat(pr, stream=True)\nfor o in r: print(o, end='')\n\nLet me calculate that for you!Finding the sum of 604542 and 6458932\n\n\nThe full message, including tool call details, are in value:\n\nr.value\n\nLet me calculate that for you!\n\n\nid: msg_01CthQaWS7F2MTeQjHPtKwVS\ncontainer: None\ncontent: [{'citations': None, 'text': 'Let me calculate that for you!', 'type': 'text', 'parsed_output': None}, {'id': 'toolu_01E9JqVMwnUSrEGwfYsegP63', 'caller': {'type': 'direct'}, 'input': {'a': 604542, 'b': 6458932}, 'name': 'sums', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 627, 'output_tokens': 80, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nr = chat(stream=True)\nfor o in r: print(o, end='')\n\nThe result of **604,542 + 6,458,932 = 7,063,474**!\n\n\n\nr.value\n\nThe result of 604,542 + 6,458,932 = 7,063,474!\n\n\nid: msg_01KDCwZXa6fbqy9WLXwYq9gY\ncontainer: None\ncontent: [{'citations': None, 'text': 'The result of **604,542 + 6,458,932 = 7,063,474**!', 'type': 'text', 'parsed_output': None}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 727, 'output_tokens': 28, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nThe history shows both the tool_use and tool_result messages:\n\nchat.h\n\n[{'role': 'user', 'content': 'What is 604542+6458932?'},\n {'role': 'assistant',\n  'content': [{'text': 'Let me calculate that for you!', 'type': 'text'},\n   {'id': 'toolu_01E9JqVMwnUSrEGwfYsegP63',\n    'caller': {'type': 'direct'},\n    'input': {'a': 604542, 'b': 6458932},\n    'name': 'sums',\n    'type': 'tool_use'}]},\n {'role': 'user',\n  'content': [{'type': 'tool_result',\n    'tool_use_id': 'toolu_01E9JqVMwnUSrEGwfYsegP63',\n    'content': 'MySum(val=7063474)'}]},\n {'role': 'assistant',\n  'content': [{'text': 'The result of **604,542 + 6,458,932 = 7,063,474**!',\n    'type': 'text'}]}]\n\n\nThe Chat class automatically validates tool calls against the provided tools list. If the model attempts to call a tool that isn’t in the allowed set (whether due to hallucination or a mismatch between tools and ns), the tool call will fail with an error message rather than executing arbitrary code.\nThis provides an important safety mechanism - even if the model invents a function name or tries to call a tool that shouldn’t be available, Chat ensures only explicitly allowed tools can be executed.\n\ndef _force_sums(*args, cb=None, **kwargs): \n    def cb_(r): \n        for block in r.content:\n            if isinstance(block, ToolUseBlock): block.name = f'sums' # Forces tool name to 'sums'\n        return cb(r) if cb else r\n    return Client(model)(*args, cb=cb_, **kwargs)\n\n\nchat = Chat(cli=_force_sums, sp=sp, tools=[mults]) # Only 'mults' is allowed\nchat.ns = [mults, sums] # Both function exist in namespace\nr = chat(\"Calc 604542 * 33392837120239382\")\nr\n\nI need to multiply these two large numbers. Let me break this down into smaller multiplications and combine the results.\nI’ll express 33392837120239382 in parts: - 33392837120239382 = 3339283712 * 10⁷ + 239382 * 10⁰ (wait, let me be more precise) - 33392837120239382 = 33392837120 * 10⁶ + 239382\nAnd I’ll compute: - 604542 * 33392837120 and 604542 * 239382 separately.\nFurther breaking down: - 33392837120 = 3339283 * 10⁴ + 7120 - So: 604542 * 33392837120 = (604542 * 3339283) * 10⁴ + (604542 * 7120)\nAnd 3339283 = 3339 * 10³ + 283 - So: 604542 * 3339283 = (604542 * 3339) * 10³ + (604542 * 283)\nLet me fire all the independent multiplications simultaneously!\n\n\nid: msg_01MGBGG5gTd6y1NbvS3fu5SU\ncontainer: None\ncontent: [{'citations': None, 'text': \"I need to multiply these two large numbers. Let me break this down into smaller multiplications and combine the results.\\n\\nI'll express **33392837120239382** in parts:\\n- 33392837120239382 = 3339283712 * 10⁷ + 239382 * 10⁰ (wait, let me be more precise)\\n- 33392837120239382 = **33392837120** * 10⁶ + **239382**\\n\\nAnd I'll compute:\\n- **604542 * 33392837120** and **604542 * 239382** separately.\\n\\nFurther breaking down:\\n- 33392837120 = **3339283** * 10⁴ + **7120**\\n- So: 604542 * 33392837120 = (604542 * 3339283) * 10⁴ + (604542 * 7120)\\n\\nAnd 3339283 = **3339** * 10³ + **283**\\n- So: 604542 * 3339283 = (604542 * 3339) * 10³ + (604542 * 283)\\n\\nLet me fire all the independent multiplications simultaneously!\", 'type': 'text'}, {'id': 'toolu_01PTTnLJSNpmoYTC9EADnJC9', 'caller': {'type': 'direct'}, 'input': {'a': 604542, 'b': 3339}, 'name': 'sums', 'type': 'tool_use'}, {'id': 'toolu_011gQv4XAQcpCnQahMccsR15', 'caller': {'type': 'direct'}, 'input': {'a': 604542, 'b': 283}, 'name': 'sums', 'type': 'tool_use'}, {'id': 'toolu_01Fx8aFaN99yDMxhFJ8RuCFW', 'caller': {'type': 'direct'}, 'input': {'a': 604542, 'b': 7120}, 'name': 'sums', 'type': 'tool_use'}, {'id': 'toolu_01HRnSCYyrz8Kdwz4YJ1aAuN', 'caller': {'type': 'direct'}, 'input': {'a': 604542, 'b': 239382}, 'name': 'sums', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 599, 'output_tokens': 520, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat.h\n\n[{'role': 'user', 'content': 'Calc 604542 * 33392837120239382'},\n {'role': 'assistant',\n  'content': [{'text': \"I need to multiply these two large numbers. Let me break this down into smaller multiplications and combine the results.\\n\\nI'll express **33392837120239382** in parts:\\n- 33392837120239382 = 3339283712 * 10⁷ + 239382 * 10⁰ (wait, let me be more precise)\\n- 33392837120239382 = **33392837120** * 10⁶ + **239382**\\n\\nAnd I'll compute:\\n- **604542 * 33392837120** and **604542 * 239382** separately.\\n\\nFurther breaking down:\\n- 33392837120 = **3339283** * 10⁴ + **7120**\\n- So: 604542 * 33392837120 = (604542 * 3339283) * 10⁴ + (604542 * 7120)\\n\\nAnd 3339283 = **3339** * 10³ + **283**\\n- So: 604542 * 3339283 = (604542 * 3339) * 10³ + (604542 * 283)\\n\\nLet me fire all the independent multiplications simultaneously!\",\n    'type': 'text'},\n   {'id': 'toolu_01PTTnLJSNpmoYTC9EADnJC9',\n    'caller': {'type': 'direct'},\n    'input': {'a': 604542, 'b': 3339},\n    'name': 'sums',\n    'type': 'tool_use'},\n   {'id': 'toolu_011gQv4XAQcpCnQahMccsR15',\n    'caller': {'type': 'direct'},\n    'input': {'a': 604542, 'b': 283},\n    'name': 'sums',\n    'type': 'tool_use'},\n   {'id': 'toolu_01Fx8aFaN99yDMxhFJ8RuCFW',\n    'caller': {'type': 'direct'},\n    'input': {'a': 604542, 'b': 7120},\n    'name': 'sums',\n    'type': 'tool_use'},\n   {'id': 'toolu_01HRnSCYyrz8Kdwz4YJ1aAuN',\n    'caller': {'type': 'direct'},\n    'input': {'a': 604542, 'b': 239382},\n    'name': 'sums',\n    'type': 'tool_use'}]},\n {'role': 'user',\n  'content': [{'type': 'tool_result',\n    'tool_use_id': 'toolu_01PTTnLJSNpmoYTC9EADnJC9',\n    'content': 'Error - tool not defined in the tool_schemas: sums'},\n   {'type': 'tool_result',\n    'tool_use_id': 'toolu_011gQv4XAQcpCnQahMccsR15',\n    'content': 'Error - tool not defined in the tool_schemas: sums'},\n   {'type': 'tool_result',\n    'tool_use_id': 'toolu_01Fx8aFaN99yDMxhFJ8RuCFW',\n    'content': 'Error - tool not defined in the tool_schemas: sums'},\n   {'type': 'tool_result',\n    'tool_use_id': 'toolu_01HRnSCYyrz8Kdwz4YJ1aAuN',\n    'content': 'Error - tool not defined in the tool_schemas: sums'}]}]\n\n\nLet’s test a function with user defined types.\n\nchat = Chat(model, sp=sp, tools=[find_page])\nr = chat(\"How many pages is three quarters of the way through my 80 page edition of Tao Te Ching?\")\nr\n\nToolUseBlock(id=‘toolu_01G77V2RMBcxVDKqsCYmZ9Au’, caller=DirectCaller(type=‘direct’), input={‘book’: {‘title’: ‘Tao Te Ching’, ‘pages’: 80}, ‘percent’: 75}, name=‘find_page’, type=‘tool_use’)\n\n\nid: msg_01Uzs8htuGbvrC1Nq1skRD8t\ncontainer: None\ncontent: [{'id': 'toolu_01G77V2RMBcxVDKqsCYmZ9Au', 'caller': {'type': 'direct'}, 'input': {'book': {'title': 'Tao Te Ching', 'pages': 80}, 'percent': 75}, 'name': 'find_page', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 731, 'output_tokens': 87, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat()\n\nThree quarters of the way through your 80-page edition of the Tao Te Ching is page 60!\n\n\nid: msg_017zd57Uf73R262oY6F1T9ia\ncontainer: None\ncontent: [{'citations': None, 'text': 'Three quarters of the way through your 80-page edition of the Tao Te Ching is **page 60**!', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 831, 'output_tokens': 31, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\n\nExported source\n@patch\ndef _repr_markdown_(self:Chat):\n    if not hasattr(self.c, 'result'): return 'No results yet'\n    last_msg = contents(self.c.result)\n    \n    def fmt_msg(m):\n        t = contents(m)\n        if isinstance(t, dict): return t['content']\n        return t\n        \n    history = '\\n\\n'.join(f\"**{m['role']}**: {fmt_msg(m)}\" \n                         for m in self.h)\n    det = self.c._repr_markdown_().split('\\n\\n')[-1]\n    if history: history = f\"\"\"\n&lt;details&gt;\n&lt;summary&gt;► History&lt;/summary&gt;\n\n{history}\n\n&lt;/details&gt;\n\"\"\"\n\n    return f\"\"\"{last_msg}\n{history}\n{det}\"\"\"\n\n\n\nchat\n\nThree quarters of the way through your 80-page edition of the Tao Te Ching is page 60!\n\n\n► History\n\nuser: H\nassistant: {‘id’: ‘toolu_01G77V2RMBcxVDKqsCYmZ9Au’, ‘caller’: {‘type’: ‘direct’}, ‘input’: {‘book’: {‘title’: ‘Tao Te Ching’, ‘pages’: 80}, ‘percent’: 75}, ‘name’: ‘find_page’, ‘type’: ‘tool_use’}\nuser: 60\nassistant: Three quarters of the way through your 80-page edition of the Tao Te Ching is page 60!\n\n\n\n\nMetric\nCount\nCost (USD)\n\n\n\n\nInput tokens\n1,562\n0.004686\n\n\nOutput tokens\n118\n0.001770\n\n\nCache tokens\n0\n0.000000\n\n\nServer tool use\n0\n0.000000\n\n\nTotal\n1,680\n$0.006456\n\n\n\n\n\n\nchat = Chat(model, tools=[text_editor_conf['sonnet']], ns=mk_ns(str_replace_based_edit_tool))\n\nWhen not providing tools directly as Python functions (like sum), you must create and pass a namespace dictionary (mapping the tool name string to the function object) using the ns parameter to methods like mk_toolres or toolloop. toolslm cannot automatically generate the namespace in this case. For schema-based tools (i.e., Python functions), claudette handles namespace creation automatically.\n\nr = chat('Please explain very concisely what my _quarto.yml does. It is in the current path. Use your tools')\nfind_block(r, ToolUseBlock)\n\nToolUseBlock(id='toolu_01SGFXBDAd9ykwQ8fnpVApWu', caller=DirectCaller(type='direct'), input={'command': 'view', 'path': '/_quarto.yml'}, name='str_replace_based_edit_tool', type='tool_use')\n\n\n\nchat()\n\nToolUseBlock(id=‘toolu_01VJcCojtvzkaSjENnFACwn5’, caller=DirectCaller(type=‘direct’), input={‘command’: ‘view’, ‘path’: ‘.’}, name=‘str_replace_based_edit_tool’, type=‘tool_use’)\n\n\nid: msg_01LED9Xieob4miFXjXouNTue\ncontainer: None\ncontent: [{'id': 'toolu_01VJcCojtvzkaSjENnFACwn5', 'caller': {'type': 'direct'}, 'input': {'command': 'view', 'path': '.'}, 'name': 'str_replace_based_edit_tool', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 1379, 'output_tokens': 75, 'server_tool_use': None, 'service_tier': 'standard'}",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#images",
    "href": "core.html#images",
    "title": "Claudette’s source",
    "section": "Images",
    "text": "Images\nClaude can handle image data as well. As everyone knows, when testing image APIs you have to use a cute puppy.\n\n# Image is Cute_dog.jpg from Wikimedia\nfn = Path('samples/puppy.jpg')\nImage(filename=fn, width=200)\n\n\n\n\n\n\n\n\n\nimg = fn.read_bytes()\n\nClaude expects an image message to have the following structure\n{\n    'role': 'user', \n    'content': [\n        {'type':'text', 'text':'What is in the image?'},\n        {\n            'type':'image', \n            'source': {\n                'type':'base64', 'media_type':'media_type', 'data': 'data'\n            }\n        }\n    ]\n}\nmsglm automatically detects if a message is an image, encodes it, and generates the data structure above. All we need to do is a create a list containing our image and a query and then pass it to mk_msg.\nLet’s try it out…\n\nq = \"In brief, what color flowers are in this image?\"\nmsg = mk_msg([img, q])\n\n\nc([msg])\n\nThe flowers in the image are purple/lavender (blue-purple). They appear to be asters.\n\n\nid: msg_01DUds87tAj47fozgFfbEPrQ\ncontainer: None\ncontent: [{'citations': None, 'text': 'The flowers in the image are **purple/lavender** (blue-purple). They appear to be **asters**.', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 110, 'output_tokens': 28, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nYou don’t need to call mk_msg on each individual message before passing them to the Chat class. Instead you can pass your messages in a list and the Chat class will automatically call mk_msgs in the background.\nc([\"How are you?\", r])\nFor messages that contain multiple content types (like an image with a question), you’ll need to enclose the message contents in a list as shown below:\nc([\"How are you?\", r, [img, q]])\n\nc = Chat(model)\nc([img, q])\n\nThe flowers in the image are purple/lavender (blue-purple). They appear to be asters.\n\n\nid: msg_01DUds87tAj47fozgFfbEPrQ\ncontainer: None\ncontent: [{'citations': None, 'text': 'The flowers in the image are **purple/lavender** (blue-purple). They appear to be **asters**.', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 110, 'output_tokens': 28, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\ncontents(c.h[0])\n\n'*Media Type - image*'\n\n\n\nc\n\nThe flowers in the image are purple/lavender (blue-purple). They appear to be asters.\n\n\n► History\n\nuser: Media Type - image\nassistant: The flowers in the image are purple/lavender (blue-purple). They appear to be asters.\n\n\n\n\nMetric\nCount\nCost (USD)\n\n\n\n\nInput tokens\n110\n0.000330\n\n\nOutput tokens\n28\n0.000420\n\n\nCache tokens\n0\n0.000000\n\n\nServer tool use\n0\n0.000000\n\n\nTotal\n138\n$0.000750\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nUnfortunately, not all Claude models support images 😞. This table summarizes the capabilities of each Claude model and the different modalities they support.",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#caching",
    "href": "core.html#caching",
    "title": "Claudette’s source",
    "section": "Caching",
    "text": "Caching\nClaude supports context caching by adding a cache_control header to the message content.\n{\n    \"role\": \"user\",\n    \"content\": [\n        {\n            \"type\": \"text\", \n            \"text\": \"Please cache my message\", \n            \"cache_control\": {\"type\": \"ephemeral\"}\n        }\n    ]\n}\nTo cache a message, we simply set cache=True when calling mk_msg.\n\nmk_msg(['hi', 'there'], cache=True)\n\n{ 'content': [ {'text': 'hi', 'type': 'text'},\n               { 'cache_control': {'type': 'ephemeral'},\n                 'text': 'there',\n                 'type': 'text'}],\n  'role': 'user'}\n\n\nClaude also now supports smart cache look-ups, so it’s very simple to keep an entire conversation in cache by constantly telling it to update the cache with the latest message. To do this, we just need to set cache=True when creating a Chat.\n\nchat = Chat(model, sp=sp, cache=True)\n\nCaching has a minimum token limit of 1024 tokens for Sonnet and Opus, and 2048 for Haiku. If your conversation is below this limit, it will not be cached.\n\nchat(\"Hi, I'm Jeremy.\")\n\nHi Jeremy! Nice to meet you. How are you doing today? Is there something I can help you with?\n\n\nid: msg_01WQUgAZDsjnFgUd4tzxLJHN\ncontainer: None\ncontent: [{'citations': None, 'text': 'Hi Jeremy! Nice to meet you. How are you doing today? Is there something I can help you with?', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 21, 'output_tokens': 26, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat.use\n\nIn: 21; Out: 26; Cache create: 0; Cache read: 0; Total Tokens: 47; Search: 0; Fetch: 0\n\n\nNote the usage: no cache is created, nor used. Now, let’s send a long enough message to trigger caching.\n\nchat(\"\"\"Lorem ipsum dolor sit amet\"\"\" * 150)\n\nIt looks like you’ve sent a large block of repeated “Lorem ipsum dolor sit amet” placeholder text. This is commonly used in design and publishing as dummy text.\nWas this sent by accident, or is there something specific you’d like help with, Jeremy? 😊\n\n\nid: msg_0164VgWyvwHC2HAGrzFJUbDB\ncontainer: None\ncontent: [{'citations': None, 'text': 'It looks like you\\'ve sent a large block of repeated \"Lorem ipsum dolor sit amet\" placeholder text. This is commonly used in design and publishing as dummy text.\\n\\nWas this sent by accident, or is there something specific you\\'d like help with, Jeremy? 😊', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 1098, 'output_tokens': 59, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat.use\n\nIn: 1119; Out: 85; Cache create: 0; Cache read: 0; Total Tokens: 1204; Search: 0; Fetch: 0\n\n\nThe context is now long enough for cache to be used. All the conversation history has now been written to the temporary cache. Any subsequent message will read from it rather than re-processing the entire conversation history.\n\nchat(\"Oh thank you! Sorry, my lorem ipsum generator got out of control!\")\n\nHa, no worries at all, Jeremy! Those lorem ipsum generators can definitely get a little wild sometimes! 😄 It happens to the best of us. Is there something I can actually help you with today?\n\n\nid: msg_01FeLGZ2T49tUHaWKaQAJAhn\ncontainer: None\ncontent: [{'citations': None, 'text': 'Ha, no worries at all, Jeremy! Those lorem ipsum generators can definitely get a little wild sometimes! 😄 It happens to the best of us. Is there something I can actually help you with today?', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 1175, 'output_tokens': 48, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat.use\n\nIn: 2294; Out: 133; Cache create: 0; Cache read: 0; Total Tokens: 2427; Search: 0; Fetch: 0",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#extended-thinking",
    "href": "core.html#extended-thinking",
    "title": "Claudette’s source",
    "section": "Extended Thinking",
    "text": "Extended Thinking\nClaude &gt;=3.7 have enhanced reasoning capabilities for complex tasks. See docs for more info.\nWe can enable extended thinking by passing a thinking param with the following structure.\nthinking={ \"type\": \"enabled\", \"budget_tokens\": 16000 }\nWhen extended thinking is enabled a thinking block is included in the response as shown below.\n{\n  \"content\": [\n    {\n      \"type\": \"thinking\",\n      \"thinking\": \"To approach this, let's think about...\",\n      \"signature\": \"Imtakcjsu38219c0.eyJoYXNoIjoiYWJjM0NTY3fQ....\"\n    },\n    {\n      \"type\": \"text\",\n      \"text\": \"Yes, there are infinitely many prime numbers such that...\"\n    }\n  ]\n}\nNote: When thinking is enabled prefill must be empty and the temp must be 1.\n\nsource\n\nthink_md\n\ndef think_md(\n    txt, thk\n):\n\n\ndef contents(r, show_thk=True):\n    \"Helper to get the contents from Claude response `r`.\"\n    blk = find_block(r)\n    if show_thk:\n        tk_blk = find_block(r, blk_type=ThinkingBlock)\n        if tk_blk: return think_md(blk.text.strip(), tk_blk.thinking.strip())\n    if not blk and r.content: blk = r.content[0]\n    if hasattr(blk,'text'): return blk.text.strip()\n    elif hasattr(blk,'content'): return blk.content.strip()\n    elif hasattr(blk,'source'): return f'*Media Type - {blk.type}*'\n    return str(blk)\n\nLet’s call the model without extended thinking enabled.\n\nchat = Chat(model)\n\n\nchat(\"Write a sentence about Python!\")\n\nHere’s a sentence about Python:\nPython is a versatile, beginner-friendly programming language known for its clean, readable syntax and wide range of applications, from web development and data science to artificial intelligence and automation.\nWould you like to know more about Python? 🐍\n\n\nid: msg_0133ueaeXR2KvELPiPDnpFAC\ncontainer: None\ncontent: [{'citations': None, 'text': \"Here's a sentence about Python:\\n\\n**Python is a versatile, beginner-friendly programming language known for its clean, readable syntax and wide range of applications, from web development and data science to artificial intelligence and automation.**\\n\\nWould you like to know more about Python? 🐍\", 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 13, 'output_tokens': 63, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nNow, let’s call the model with extended thinking enabled.\n\nchat(\"Write a sentence about Python!\", maxthinktok=1024)\n\nHere’s a sentence about Python:\nPython is one of the most popular programming languages in the world, loved by developers for its simplicity, powerful libraries, and ability to handle complex tasks with just a few lines of code.\nFun fact: Python was named after the British comedy group Monty Python, not the snake! 🐍😄\nWould you like to learn more about Python?\n\n\nThinking\n\nThe user wants another sentence about Python. Let me write a different one this time.\n\n\n\nid: msg_01Vuqd8xUwuB2tTnmcexcfFp\ncontainer: None\ncontent: [{'signature': 'Ev0BCkYICxgCKkAmUcWkc6z1j9s2pIRVL/EIaNbJYCaXR1stNeEAhQoCylzrssuUy2ZTq4vGWUl7WbH2AbV30H8aRazSNGwgnQp+Egzq7GmzjPUY/hkdH1oaDKbN8/A53z7nu/TenyIwIAhQomWRMzdCY7ueYlSChv7bcBIpnPT6Pf1gboh/KOlgAQIV0DRGX3r28/rVxj0KKmXdM/z1lMTxHXSMLE5PQkpDsNEavF0XqqGZlFXgd1Sg4mZSiaV3/9h9FTb2VWNtbpsvtztVbdvt4BbTnrO6YtNv5ehK0/7kaArbOwi61aQtZson8/+gmZgnox2vDieBHhpCc6t3ThgB', 'thinking': 'The user wants another sentence about Python. Let me write a different one this time.', 'type': 'thinking'}, {'citations': None, 'text': \"Here's a sentence about Python:\\n\\n**Python is one of the most popular programming languages in the world, loved by developers for its simplicity, powerful libraries, and ability to handle complex tasks with just a few lines of code.**\\n\\nFun fact: Python was named after the British comedy group **Monty Python**, not the snake! 🐍😄\\n\\nWould you like to learn more about Python?\", 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 114, 'output_tokens': 113, 'server_tool_use': None, 'service_tier': 'standard'}",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#server-tools-and-web-search",
    "href": "core.html#server-tools-and-web-search",
    "title": "Claudette’s source",
    "section": "Server Tools and Web Search",
    "text": "Server Tools and Web Search\nThe str_replace special tool type is a client side tool, i.e., one where we provide the implementation. However, Anthropic also supports server side tools. The current one available is their search tool, which you can find the documentation for here. When provided as a tool to claude, claude can decide to search the web in order to answer or solve the task at hand.\n\nsource\n\nsearch_conf\n\ndef search_conf(\n    max_uses:int=None, allowed_domains:list=None, blocked_domains:list=None, user_location:dict=None\n):\n\nLittle helper to create a search tool config\nSimilar to client side tools, you provide to the tools argument in the anthropic api a non-schema dictionary with the tool’s name, type, and any additional metadata specific to that tool. Here’s a function to make that process easier for the web search tool.\n\nsearch_conf()\n\n{'type': 'web_search_20250305', 'name': 'web_search'}\n\n\nThe web search tool returns a list of TextBlocks comprised of response text from the model, ServerToolUseBlock and server tool results block such as WebSearchToolResultBlock. Some of these TextBlocks will contain citations with references to the results of the web search tool. Here is what all this looks like:\n{\n  \"content\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"I'll check the current weather in...\",\n    },\n    {\n      \"type\": \"server_tool_use\",\n      \"name\": \"web_search\",\n      \"input\": {\"query\": \"San Diego weather forecast today May 12 2025\"},\n      \"id\":\"srvtoolu_014t7fS449voTHRCVzi5jQGC\"\n    },\n    {\n      \"type\": \"web_search_tool_result\",\n      \"tool_use_id\": \"srvtoolu_014t7fS449voTHRCVzi5jQGC\",\n      \"content\": [\n        \"type\": \"web_search_result\",\n        \"title\": \"Heat Advisory issued May 9...\",\n        \"url\": \"https://kesq.com/weather/...\",\n        ...\n      ]\n    }\n    {\n      \"type\": \"text\",\n      \"citations\": [\n        {\n            \"cited_text\": 'The average temperature during this month...',\n            \"title\": \"Weather San Diego in May 2025:...\",\n            \"url\": \"https://en.climate-data.org/...\",\n            \"encrypted_index\": \"EpMBCioIAxgCIiQ4ODk4YTF...\"\n        }\n      ],\n      \"text\": \"The average temperature in San Diego during May is...\"\n    },\n    ...\n  ]\n}\nLet’s update our contents function to handle these cases. For handling citations, we will use the excellent reference syntax in markdown to make clickable citation links.\n\nsource\n\n\nfind_blocks\n\ndef find_blocks(\n    r, blk_type:ModelMetaclass=TextBlock, type:str='text'\n):\n\nHelper to find all blocks of type blk_type in response r.\n\nsource\n\n\nblks2cited_txt\n\ndef blks2cited_txt(\n    txt_blks\n):\n\nHelper to get the contents from a list of TextBlocks, with citations.\n\nsource\n\n\ncontents\n\ndef contents(\n    r, show_thk:bool=True\n):\n\nHelper to get the contents from Claude response r.\n\nchat = Chat(model, sp='Be concise in your responses.', tools=[search_conf()], cache=True)\npr = 'What is the weather in San Diego?'\nr = chat(pr)\nr\n\nHere’s the current weather for San Diego, CA today, Sunday, February 22:\n\nCondition: Mainly sunny to start, then a few afternoon clouds. 1\nHigh: 69°F 2\nLow: 48°F 3\nWind: NNW at 10 to 15 mph 4\nHumidity: 73% 5\n\nTonight: Mostly clear with a low of 48°F and light, variable winds. 6\nLooking ahead: High temperatures are expected to increase throughout the week, reaching 10 to 20 degrees above average by Friday, with highs in the mid-70s at the coast and mid-80s inland. 7\n\n\nid: msg_01CiY6bqkVHro5CXX1jVNjMG\ncontainer: None\ncontent: [{'id': 'srvtoolu_01EmFt11mrox1xAAjpz8f5QF', 'caller': {'type': 'direct'}, 'input': {'query': 'weather in San Diego today'}, 'name': 'web_search', 'type': 'server_tool_use'}, {'caller': {'type': 'direct'}, 'content': [{'encrypted_content': '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', 'page_age': '11 hours ago', 'title': 'San Diego, CA Weather Forecast | AccuWeather', 'type': 'web_search_result', 'url': 'https://www.accuweather.com/en/us/san-diego/92101/weather-forecast/347628'}, {'encrypted_content': 'EpoCCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDPmW+VGbGo5aPjqG4xoMfkBfdsdLoG2LM8wqIjAI94rS2DM8ak8JsDELXHQTXh429Z7xwTwZoTIOlQfh98VydUJkywIBIWgCXpOJVxkqnQFplIe+px4BQIADOma4Ifs+KlzYIWvXuUSBRMU1i/Rt7YPg1Z9ibw6ClQ1TA41tzl9ozicI1DcXWFyvftsnf6ei6wosLF/08ef3uKeIBl0JAjRW2VEVFz+1dYW3oUprmVq5BKF4K7jUSolq3YOxlOYjBnbqS7QJ4k4nGg19TFQTeFo2umdB3spC2Qkdq+8cIpBJ3CC/k1Pf3Ql7LJOdGAM=', 'page_age': '6 days ago', 'title': 'San Diego weather forecast – NBC 7 San Diego', 'type': 'web_search_result', 'url': 'https://www.nbcsandiego.com/weather/'}, {'encrypted_content': 'ErkDCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDLOH6/BHtC+UtVZ10RoMdYZ1dAG25M4Z0uf4IjABr8pN+SRe0h6KZJq8DqBjuZDvInCWkWuX05Rjt2KlYKzXnZ+JJwxnA/Nj61P6qVcqvAKHdVVJF1FGOyhxqm9GE9k0adScSC/RFNqwl9y4IM+xlhfwReqnou4RCCxQQglmE+7OA6vNAAnptB9TU1yqEWuUvk+fgIrXZ5jsIMtZWjy7KuneSeaHDDToX9pTPTPc5cF+rV2cTF6AbeC5H8Qi/WW0f2wv8CmAcyGSnJdkXTw6EEA7R8//lYwqPMEIkq6iyeL5R9by8ktrFKnmoQg6wEfH1WV3V80CRloeQWfF/XpIZc+rxKc+mkP55WcsvKiE9mc2uGQmFRpbNJFM7GUmHUyD6G+26ZU9a8B1kWq0Y7fZi86wgdExlrvCzZaPEyVnpArsz1r+4BDE9YULIVQbMBcjBdyr0OA4yTjA2xr0I2DarWp2O2ETG/2mtZ0FaLS5QSD9mELy+YxvaTYVHiRPUwoBtfFYd8hSN/j3LekjGAM=', 'page_age': '19 hours ago', 'title': 'San Diego, CA', 'type': 'web_search_result', 'url': 'https://www.weather.gov/sgx'}, {'encrypted_content': 'EoUNCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDLYoLkv9ACdnC87KJBoM5RlCXaY/15x/8309IjChtuk/BjwnlWWW137uVFMbjadIbuBUZMcPa0Dnna34KCsv/+5jyVs5Op/MjsF2NAQqiAwUHkvfHxBQEeTXanHxcW0rx60vzLgbZ2yE1Gj/e2fvfvwKDe6/lr3uInHPYu4EP6bI+ZlxLdYbtmVVrKubsOV7/cXgozBvP/hpWJphCgeB3Kvk7kEBSOuS9utPef1/zqULUbV8jM5OAnQmSEx01tIJHGn1rVj2Li3Ip+Mw1l0ej5Lfbyg9jvokRMQriZPoF9XL+U1g/X2+me0lC0CJiFg3jjlLV0aNL+ycpXnixndfQdaOoXuIdCG2jvWEujnbVYe4XdwIifkhN+WhB+1MkyMb1AbQkgSRFWUPkDa5m4al7mE2Ba0sp8PQlUNFQYXSkswyha2gvMPlafWbKFzRHujC/exCOAn2iFq87QKYSo7+cfSLACbW+ELOcuEfCOsYCQPI2xnZQ9fUfwsLoyHvjR9PLeurx7ntjgNr5NcG0vuJ6JpmYvVsvJ/pREb0XtJPmznoJmn27YTu39v4qiAsCW4E1YQ93CiI/TDCDaLFKNulwlT219ExUyBkkVXy27Vb1jwkhbz8UmuwvQj+8RzbnW63WT0xN96O7Xuxt4kHbKDP6UeUnGGlP3PcXSeBSi8GTf0aOizSqjS1Vy8Ud0BuhHUvYrpgeT9Dlye+bFusK833HN1K1BXe1Vw2CintUNC2Ax6VFCswpiZpBHpsppmsmkfSdVrdQrBVMs8JxjSSMhX9R02AFH+fe6Jo7SWQf0OdjbvkDusBC4J/xYdjNXwhXDU7QgCA9gis8zC84+EnF2sbeO6mddN2PhvGIHeZS0cHtTRhnDl6XGp3vJyudHokA/M5l0nZeVLsI1oRB/hVPkb88HxcYTeSjqlMQKZqLBagogbHwQpAg2pAal7KVr/BHgJMKfJQxBD87JwG9MozP6NUDjfLd8iT7d/PaFpaW3AFlvPBLmyL0pGw6Xm49JX77hJRzbAYqZr6N0jXoDwoex64uu7dooTGE13F9gOEd7TTmp+2UcvW+5yb8f+qC2NaIvNAry0QrF8oRdLel4u/buqLgCiO683iqgkM37yUDGch4VqBzSnLW8tdM+hpnZwFPhjghtkMwbihm8GrMtw1CxsuWiI/6z2IWwfmLT693eKM5qu6WgMj8+2kJJUDfzZWnG/IoJrrKZcfvykw39J/b5kwa0A9JY1sJ5+zX8ygv1Bqv4ZC+a8zUAtq3dh0H3CINcD/N/ceYCB5vvMHa06VjGsuRwElpiuX0FDZshUlVBxfP7aweHyNtjAAJNbVq22jY3wpldZqJqHRp3TrONABowXwyiIG/lbGiPckpYkFIHa0fKGk2QaRzTkWkPZVfNTWsOka2GFqHVmXYE/r3OcWkkn9BBYnkhMVFe6AJvQc8bufuQhx/Ml0c0Bdi8yVwA1xsIEcAQaci0eEAAnQbt4DEb0IFBuepdR2eHjVzi311hAboovNgjq72HmmxMpulQg+O7Zh6Wczv3S7YXMrTlERa7aDvbUgedbRAki9QtsflBRjTaVrwmI8S6zwRoHTzL1Xb8qT8UsR4eJCjI4EMjxKeA2bLRzzaJcWmJkDg01gFazULmbXMX0UM+XcGKf9HlRw0cE3ozTwLOKOESKvHhSq8gMmOIBnF4/pShfb9I59yu6k71ozHB5xyN1zYerxB32oZXzYtxrMFi7A+wxcTsnvYBOP9YKWa33Od/8tTaMdERZcm/zO4uYxJjKmWvXNj1f8gglN6jcf01Zc5D8BUqVWwqKR6gOQk6giVXV0RDtXUl1eJ3/X9LOR3hzfZXp1VIdmNIJ5SXQ+Pe5EPYxp8nv2O9cTcon//n/EuQ4yDjMJe0NR2/sHD6LaNi0tnMQsdgIRz6B0JAuonchcPOHwyaDEVGaLwojSoYSWhgh2/r0CcVveM8SPZqiNL43x1b6sAIzu4a+qJDa9suoTK9VqAE5cjmpYssSgsqmnq3/Mat9bN0/3bYfRG9TZCkmEXVlVCSISIIPd8sANhs9e6jZAYujOlWgQPAEb6ELq6Qk2I0OifVTqn0BXfL5v2GvEylgiq/FYk5ihCRr74cmFQ7FodYaoB3j+PLAhDyNK8SFHtz1F69BlaBlwkSt5Jn6jJRgD', 'page_age': None, 'title': 'San Diego, CA Hourly Weather Forecast | Weather Underground', 'type': 'web_search_result', 'url': 'https://www.wunderground.com/hourly/us/ca/san-diego'}, {'encrypted_content': 'EuYJCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDD8E5j6RXUvlgDH2phoMgK2iuOIWQPU4+KrxIjDb0BhChdLD8DyV2iwVtQ8MIMxqkj7ZVCdCpvf/O6VFVsVd+7K3OJC4mlxfmBEebnoq6QjR/iMPSPN34WurujQfR9lBUsYLbxHlFBKxfmtfVQL4d9+F013XGXz4e6LwcRgfDvAyALfhoR3wzSMldIAaRFMiqo0fm6MKortjmcC9k9x8dClnpzpOpyTALDN+CyH+s6iRvs0myEr0VDpD6cUeNTdJMwYdPFUSjUfSX1DYG5SizA9dNKNgAcIZ2UsGlUD//ACls2PcStmjQSajg3t+0wmS7f99SZ4KAAtnTsrrfwVJeTRWfjZAl3J+OzqOWuVDNYHYwUZoyPaSDQ3iMArVdvEt6FJKAORAaeXjyQDySeMkyglz5fjBG7f7dkL9od3MItobvdgUvols7j49wLCB6aJBMdyKngFMSKJxKy7NK0rQocNPg28jypoTFKREZqQEzqtQVo460KloaFukoI7tODNAPbZ0iJbjWEbfy/s9z54dLTaOISYmAmWwEmHBptJ8o/4/BDYDMGDVFUZecIwBcS0LqsbkE1Qlo7PCDOYf6uzjOJkmTLHhOq8frS7M3lhwZqmJ3DJ/bmmifEb+gF+jKaIuh1hMKLxK3oGeiHbEVGvNX0/VQbUZmiOT1v28LLrkeFHHy3doyhfjgZEQirkVBntwpEZz7Kj2chq2+K+R8K5YgSN+v+fqhde+cabHGkOtaPQ4QKQUggWYB/1tx4RztmZFU6nO++/niZxCpuBndcoyVe5U01+23ArS36OirydAZ5qRc2b1Z0jb9McqEhv1/Tk9mjCwYl/EcX4QDy8cHpolufMjhC591Xv9y6WQNz1bJk2oDXkf82sA3lbS/osrcT5p/b81/nSvuR8lbiHyILjFYLK4E3D9EF8FHi68SPpxEbM+NlShwJiSnlVmPfuJ7od3HPxtxcLTdFCbYBLpi8DAHHyLQ6UOE825URoq/dhw+u+S3cflvfLdNdH1eI8qPetrHhiRyju3BjMbqraotzQuv3IleyybgqTl2guUtie77SSP7YY/cLya27iYzY5g9kRNSRE/GxNM4dsNKTjaDEkcv9AxNSykhHq+f4xqE0+nD0n1IRMV9wqxwiqh+SUvMsBj/t1WzDnE7nqch/Zd0NaY0B40fMuFOR+PyHJECEsIoxMvprFrADTemM0xZVzFwHlbY3cCBWN+JsJfBcn4nKbunLd2H/9UsUGhHjO4fM0huv5QlzMOPOd8bJz0scOfM/zmPxINr5FN2E655pYgxZ7j3V/zk8CA9v976Jy8pQc1s64yqbhAQo2V6ZMmWTDaA2tIkwHKMi3S6QuEdq/1IiuqibCzw0mvhvcx7VXVIQeMcIDva2u4yr4PGv2vBhHgexUkmX7VZMEIgw6WFK0warFnpSx3LjigyH45MdA1I6jnHm8YFevAj5E+THssSVu+YpRe2YVw02UGFrClaJkd8VGz/eSgS4OO85fymEPKH3n/ny3soTDLy4RJ5UDPRLDfLrkAmkx5oF/t+zL7AG4z12K41y4iKJWr4CtiAnuwDgFOPl1gbPqR9zydJ6RuMm64lPgTbzw98e5/m1jUGAM=', 'page_age': None, 'title': 'San Diego, CA Weather Forecast | KGTV | kgtv.com', 'type': 'web_search_result', 'url': 'https://www.10news.com/weather'}, {'encrypted_content': 'EpsJCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDMCCjZJJjOuTE7338hoMkvEw85j6yFkTAJTbIjDeiWnqVdocqrSsrXLXDsgrhtOjAroFBneXL6kkSjTAZaC2a/WTFfYNPGXCG+SUP7QqnghJN4dtmMtq3IEDhmxy/9T+jWoYnWQtmQQvogQIdmRPxRWFIa6oUmXHnFgh1bK6aSRdeAQlVweJ3O08zkUxpL5bZLLBPT+260iIEb3O5z46hflTmVkZ8TnPK1WXXF9jq7vwdJKfPSRDD1l5q4SGlnK3NPhK2Xwb7alpIfjjS3H5S5j/29nWeZZX3K9DxQQysky1w/aKTgSIDEgXhuD8UlLcmix9NIwiHw5ypZEDIFqLZLKPEWf1/cgiqo+OBh5XJ5xD7VyfyyZFQuWD4nbk5O9YqOBN3Decm8DupB54rvG1jA2MYa68dvYXTqNNiVd2oP4nYi2fUDleVlx2Mcb5VIz3LSsaEJMHCW6ud389UErbgvu4VRzJc3zUTDkm0y2LWMmmVbJ9/HRt6DOqMjTjo5mdpOJ77E7Hxr7UiLQUTDv1vKToj0bRMBjLqJqEguds4RBF6fJ+kd8IeExi33Cv4icldiQtcYmh0Sj7AiFSQ+94y6tNx11E+GHZWBLyv0kwPrH2RjucBnS5gvY5M8B/GZSzn5S/ztEJnbUM9Hqxl8npAcrV+ZhD2A+/v0KUXkX+yWOL6DTOanx99NGbtq1K9xYXNbdbsQbiDOyaOxYAXYl1hB0HqIiy1p4sqciNDlpWTZ9igGZHegbtpG4M0ZToCUKv4htPNeB8UHssXm08fbNciCGSjO7MDcypce+TtEp7KqByuYAPg+2nWyryH47CoRQrG3GMf7GBT1EWxMKE3UbP17EuK5/3w3iD00ZsrvZhqIYgb0ytmA+HgmdB7T3vNCOmznqVGl49MT4lAzJcn6t8fP+nELT8ZRwwkpOho0WLT6wpxfHJ/zRdBmgGZvoozVl22w8Sd94ZZ8t9KCS1i9mwNhyJShHHoLbpWEUmn51UIcywJ7jXiJMcMN2z4xl2RSPsFY7ghheItIX8ItcVQNe3XIPQIaxw8t4P5VXTk2zwoUzNdLnus7Y1vKZ+7WhjQGTT2pVTs4/x95cF4f9RbDkZMvJ76Tc6520HtC7PnL8vtWu4UOPPBZBzg0ci5OsZotIYxRe79ELBOwg1nIyiNVU++xNWjC+AAJg/F7dttoT1t2WxIN5K/8ODgN9095CKpyFWckPiHrcDdyvHuxDzcN5o22mQH3NR5Gg2C1vDxPG9zImp22Z8lVz7yeW4Fb00dioulSInYcfio+Vavb4m9ncOrogtyNGEA1/EruyOWEHKcWnkGGnzceMA4QMABkWkBZ5rQmDwYdkOBJPK56lZPLQLy5P/gqHBA2toAEMMpzaf4qTMkM8WgCt8byGynjNg2FRJjdc3YZMt+IDd3e/ZiykKTkxj+BbNomht903Gtlkh5PjUIRT3CFI/u17JqPoHTg3tno3KMo8hfcBJ/CJzenSignK3yoCLg4VAXFg4B4BvGAM=', 'page_age': 'October 29, 2025', 'title': 'San Diego Weather & 7-Day Forecast | FOX 5 San Diego', 'type': 'web_search_result', 'url': 'https://fox5sandiego.com/weather/'}, {'encrypted_content': 'Et0BCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDNzCV/HulREWIE7UGxoMavEi+rhChl6gS/pDIjAuGc3UixskBcE3fArDmyrQCMC7cgicHqhm0nwbxIHzTFYmZfdZzAfB5agKDVPlbXoqYUVYf0qPZKu+9kFo+Bg/kgIRIHzvImfqlhcYjw+v5pRPCJPWmiyE5ld0a3gA7WKqXYpcuR/epEKlSqo4ht793d4XCTlY3aueqd5dm1rZKhZHlGtgV3gzPe6EFIl89XfjyW4YAw==', 'page_age': None, 'title': 'Weather for San Diego, California, USA', 'type': 'web_search_result', 'url': 'https://www.timeanddate.com/weather/usa/san-diego'}, {'encrypted_content': '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', 'page_age': 'February 14, 2012', 'title': 'NWS San Diego (@NWSSanDiego) / X', 'type': 'web_search_result', 'url': 'https://x.com/nwssandiego'}, {'encrypted_content': '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', 'page_age': None, 'title': 'San Diego, CA Current Weather | AccuWeather', 'type': 'web_search_result', 'url': 'https://www.accuweather.com/en/us/san-diego/92101/current-weather/347628'}, {'encrypted_content': 'Eu0ECioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDC+eBMbh0beNMTdcjBoMPVDl1mNgtMDF/i7dIjCL3csRo3DyvtCpYVZ0TTHHv5QpXvXtEtZucEyNAYBUuUGkH6Uwkvw845Cjes6Ss9sq8AMHwmRl1bzgKcjTkQJaGL6mOYBEAaOOTbSzoKRsC/og9sbJYZahLQsytqSRB5SgrXRxQgahjOc/aL6YjNShu8lw0KjOXePKR61KbTogOrKNrcsfYESVJpR+pRORnMXmPe8IdnCsxZ1d8l3Eqbqu+wzi67Y7JcXvycg3Ee++F+2NdSv/c345BbcbLtMk1zS3uaatEPSPErphiMzJjMaz983gd6U17C+nl02DKRkT/nU6hAsVe25wEvrXsYu1+I6i3SpXgefcLxxV3LIqqclZmd3nQPj+UzSrP3q3wXj4uB5/isnCl4bK8rfnPSartxrhVjntIDvZGmkaIBgMB/nl2CINdcBka+xJkw982idZ0ifmFEzDaJk5gFud6E8vB16/rLJYy5J5Qf655wJ2V2Ry7Fow3cDOlNd8ZKl+SqxmKtC1iHVhmyXqxMHpZmttGyHSQJOlIDDK2y5azjTj25+lddmNbtaLuH9zp3NLZsxXB8a5gZFKIvPgegQnsW1sMUKkygXBb0HeAw2FmJC5jKFzXNHvri7bggzfu6L+V0cE0dvnv4aVjPiyKph8E/dJ1jd/xsLBkONkBr1i6DkYX3xgAEFvnEluKrFucEIEcoIzzB15TlZYnLBYrQDRVARg9KDnDESe6kc/McEzK55PH9WInOGkGAM=', 'page_age': '1 month ago', 'title': 'San Diego, CA Weather Conditions | Weather Underground', 'type': 'web_search_result', 'url': 'https://www.wunderground.com/weather/us/ca/san-diego'}], 'tool_use_id': 'srvtoolu_01EmFt11mrox1xAAjpz8f5QF', 'type': 'web_search_tool_result'}, {'citations': None, 'text': \"Here's the current weather for **San Diego, CA** today, Sunday, February 22:\\n\\n- **Condition:** \", 'type': 'text'}, {'citations': [{'cited_text': 'zoom out · Showing Stations · Hourly Forecast for Today, Sunday 02/22Hourly for Today, Sun 02/22 · Today 02/22 · 2% / 0 in · Mainly sunny to start, th...', 'encrypted_index': 'Eo8BCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDKPnjrs9hI81UdheSBoMjOEBwau6ksWBtHPSIjBSGb5wiRTDaDToTYzb06X7vpO/NAk1SOD79RwkX8u1xbcqVUpcQJOWtNXPXdKGc6kqE+T7ttYmZQIDTaXTSG7TR/6PGtsYBA==', 'title': 'San Diego, CA Hourly Weather Forecast | Weather Underground', 'type': 'web_search_result_location', 'url': 'https://www.wunderground.com/hourly/us/ca/san-diego'}], 'text': 'Mainly sunny to start, then a few afternoon clouds.', 'type': 'text'}, {'citations': None, 'text': '\\n- **High:** ', 'type': 'text'}, {'citations': [{'cited_text': 'High 69F. ', 'encrypted_index': 'Eo8BCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDBxCY+HYFWzXa/eQ5BoMPJFKGEz/4bLKgNYSIjD3IvzFy8S+Ur6X07t4RyeIR0/ZLGLTr1/650UZ93tw81lHOko8MJ7w83lZGKLMHo4qE4hnkd/a/SnrpjD2xx/D8bof2C0YBA==', 'title': 'San Diego, CA Hourly Weather Forecast | Weather Underground', 'type': 'web_search_result_location', 'url': 'https://www.wunderground.com/hourly/us/ca/san-diego'}], 'text': '69°F', 'type': 'text'}, {'citations': None, 'text': '\\n- **Low:** ', 'type': 'text'}, {'citations': [{'cited_text': 'Low 48F. ', 'encrypted_index': 'Eo8BCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDCfRLDkRQlN9Ru2j0RoMNrMvsZ2P6dpavhJmIjClJV+JLmfYoC6q1mVtUpfADT+usthNfmaOqv+7Fm2OHUDezfL7XNCvm+k2eb81kqoqEwQO0t5Pkl9chxw4zxRTA0+RxXEYBA==', 'title': 'San Diego, CA Hourly Weather Forecast | Weather Underground', 'type': 'web_search_result_location', 'url': 'https://www.wunderground.com/hourly/us/ca/san-diego'}], 'text': '48°F', 'type': 'text'}, {'citations': None, 'text': '\\n- **Wind:** ', 'type': 'text'}, {'citations': [{'cited_text': 'Winds NNW at 10 to 15 mph. ', 'encrypted_index': 'Eo8BCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDCUBdvhnZQj2+zDAshoMaWIbNAYyQ0Isx7qhIjBLGGiVXWEd9aIvyDbbRrqeg/Vv2C59yDUSOHIXhhCgCOcOWg0BXYDQuZHox/I7x3UqE3X8jaHlFlx5i8fCxZYsvLefEJQYBA==', 'title': 'San Diego, CA Hourly Weather Forecast | Weather Underground', 'type': 'web_search_result_location', 'url': 'https://www.wunderground.com/hourly/us/ca/san-diego'}], 'text': 'NNW at 10 to 15 mph', 'type': 'text'}, {'citations': None, 'text': '\\n- **Humidity:** ', 'type': 'text'}, {'citations': [{'cited_text': 'Weather Alerts · , Enter zip code to change location · AK · AL · AR · AZ · CA · CO · CT · DC · DE · FL · GA · HI · IA · ID · IL · IN · KS · KY · LA · ...', 'encrypted_index': 'Eo8BCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDCTjv+m/hjq8As8IwxoMGQlayvWmSb9+A8hKIjDY+8aotwhJ05D3rn4qP4u3MgUvTL2dnvmdIpYybmCaGQrwOCjpuKVwVq40ozuEbbwqE3kYV+eQLCNQKXRE2S/nyZMqM6oYBA==', 'title': 'San Diego, CA Weather Forecast | KGTV | kgtv.com', 'type': 'web_search_result_location', 'url': 'https://www.10news.com/weather'}], 'text': '73%', 'type': 'text'}, {'citations': None, 'text': '\\n\\n**Tonight:** ', 'type': 'text'}, {'citations': [{'cited_text': 'Tonight 02/22 · 14 % / 0 in · Mostly clear. Low 48F. Winds light and variable. ', 'encrypted_index': 'EpIBCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDHOFAnCo7mjGSRui9hoMS8ribfl6H67/LfWMIjDJ21oTZ/NUzd4mIHe0bf+CvA8WJY4O57xQoKsuj2Y3RvA5V49z1WJ4kcohYt9/RMIqFuZDjilpgTI9AhMVUfC8H5YGzvMY1dIYBA==', 'title': 'San Diego, CA Hourly Weather Forecast | Weather Underground', 'type': 'web_search_result_location', 'url': 'https://www.wunderground.com/hourly/us/ca/san-diego'}], 'text': 'Mostly clear with a low of 48°F and light, variable winds.', 'type': 'text'}, {'citations': None, 'text': '\\n\\n**Looking ahead:** ', 'type': 'text'}, {'citations': [{'cited_text': 'High temperatures continue to increase throughout the week, reaching up to 10 to 20 degrees above average by Friday. Highs reach into the mid-70s at t...', 'encrypted_index': 'EpEBCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDP2q0p/VI0gCB2a1KhoM0pPJHMZHqghhpS0yIjCf0Mv7lKMuxsBEUBUPcXBlN9Lz7hXdXgePFC6xTr7G747EanbklIjVjTCcbGLWDNUqFQwGIjUA0WzAMV6otmRq7amSKNqOGBgE', 'title': 'San Diego, CA', 'type': 'web_search_result_location', 'url': 'https://www.weather.gov/sgx'}], 'text': 'High temperatures are expected to increase throughout the week, reaching 10 to 20 degrees above average by Friday, with highs in the mid-70s at the coast and mid-80s inland.', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 2227}, 'cache_creation_input_tokens': 8771, 'cache_read_input_tokens': 2227, 'inference_geo': 'global', 'input_tokens': 4, 'output_tokens': 337, 'server_tool_use': {'web_fetch_requests': 0, 'web_search_requests': 1}, 'service_tier': 'standard'}\n\n\n\n\nWe can cite custom documents too.\n\nfrom msglm import mk_ant_doc\n\n\ndoc = mk_ant_doc(\"The capital of France is Paris. It has a population of about 2.2 million.\", title=\"France Facts\")\nchat = Chat(model=models[1])\nr = chat([doc, \"What is the capital of France and what is its population?\"])\nr\n\nThe capital of France is Paris. 8 It has a population of about 2.2 million. 9\n\n\nid: msg_01JrDTZVtNzSi1MyjPvPF2xS\ncontainer: None\ncontent: [{'citations': [{'cited_text': 'The capital of France is Paris. ', 'document_index': 0, 'document_title': 'France Facts', 'end_char_index': 32, 'file_id': None, 'start_char_index': 0, 'type': 'char_location'}], 'text': 'The capital of France is Paris.', 'type': 'text'}, {'citations': None, 'text': ' ', 'type': 'text'}, {'citations': [{'cited_text': 'It has a population of about 2.2 million.', 'document_index': 0, 'document_title': 'France Facts', 'end_char_index': 73, 'file_id': None, 'start_char_index': 32, 'type': 'char_location'}], 'text': 'It has a population of about 2.2 million.', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 604, 'output_tokens': 55, 'server_tool_use': None, 'service_tier': 'standard'}",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#third-party-providers",
    "href": "core.html#third-party-providers",
    "title": "Claudette’s source",
    "section": "Third party providers",
    "text": "Third party providers\nNB: The 3rd party model list is currently out of date–PRs to fix that would be welcome!\n\nAmazon Bedrock\nThese are Amazon’s current Claude models:\n\nmodels_aws\n\n['anthropic.claude-opus-4-1-20250805-v1:0',\n 'anthropic.claude-sonnet-4-20250514-v1:0',\n 'claude-3-5-haiku-20241022',\n 'claude-3-7-sonnet-20250219',\n 'anthropic.claude-3-opus-20240229-v1:0',\n 'anthropic.claude-3-5-sonnet-20241022-v2:0']\n\n\nProvided boto3 is installed, we otherwise don’t need any extra code to support Amazon Bedrock – we just have to set up the approach client:\n\nab = AnthropicBedrock(\n    aws_access_key=os.environ['AWS_ACCESS_KEY'],\n    aws_secret_key=os.environ['AWS_SECRET_KEY'],\n)\nclient = Client(models_aws[0], ab)\n\nchat = Chat(cli=client)\nchat(\"I'm Jeremy\")\n\n\n\nGoogle Vertex\n\nmodels_goog\n\n['claude-opus-4-1@20250805',\n 'anthropic.claude-3-sonnet-20240229-v1:0',\n 'anthropic.claude-3-haiku-20240307-v1:0',\n 'claude-3-opus@20240229',\n 'claude-3-5-sonnet-v2@20241022',\n 'claude-3-sonnet@20240229',\n 'claude-3-haiku@20240307']\n\n\n\nfrom anthropic import AnthropicVertex\nimport google.auth\n\n\nproject_id = google.auth.default()[1]\nregion = \"us-east5\"\ngv = AnthropicVertex(project_id=project_id, region=region)\nclient = Client(models_goog[-1], gv)\n\nchat = Chat(cli=client)\nchat(\"I'm Jeremy\")",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "core.html#footnotes",
    "href": "core.html#footnotes",
    "title": "Claudette’s source",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nFrance Facts “The capital of France is Paris.”↩︎\nFrance Facts “It has a population of about 2.2 million.”↩︎\nhttps://www.wunderground.com/hourly/us/ca/san-diego “Low 48F.”↩︎\nhttps://www.wunderground.com/hourly/us/ca/san-diego “Winds NNW at 10 to 15 mph.”↩︎\nhttps://www.10news.com/weather “Weather Alerts · , Enter zip code to change location · AK · AL · AR · AZ · CA · CO · CT · DC · DE · FL · GA · HI · IA · ID · IL · IN · KS · KY · LA · …”↩︎\nhttps://www.wunderground.com/hourly/us/ca/san-diego “Tonight 02/22 · 14 % / 0 in · Mostly clear. Low 48F. Winds light and variable.”↩︎\nhttps://www.weather.gov/sgx “High temperatures continue to increase throughout the week, reaching up to 10 to 20 degrees above average by Friday. Highs reach into the mid-70s at t…”↩︎\nFrance Facts “The capital of France is Paris.”↩︎\nFrance Facts “It has a population of about 2.2 million.”↩︎",
    "crumbs": [
      "Claudette's source"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "claudette",
    "section": "",
    "text": "NB: If you are reading this in GitHub’s readme, we recommend you instead read the much more nicely formatted documentation format of this tutorial.\nClaudette is a wrapper for Anthropic’s Python SDK.\nThe SDK works well, but it is quite low level – it leaves the developer to do a lot of stuff manually. That’s a lot of extra work and boilerplate! Claudette automates pretty much everything that can be automated, whilst providing full control. Amongst the features provided:\nYou’ll need to set the ANTHROPIC_API_KEY environment variable to the key provided to you by Anthropic in order to use this library.\nNote that this library is the first ever “literate nbdev” project. That means that the actual source code for the library is a rendered Jupyter Notebook which includes callout notes and tips, HTML tables and images, detailed explanations, and teaches how and why the code is written the way it is. Even if you’ve never used the Anthropic Python SDK or Claude API before, you should be able to read the source code. Click Claudette’s Source to read it, or clone the git repo and execute the notebook yourself to see every step of the creation process in action. The tutorial below includes links to API details which will take you to relevant parts of the source. The reason this project is a new kind of literal program is because we take seriously Knuth’s call to action, that we have a “moral commitment” to never write an “illiterate program” – and so we have a commitment to making literate programming an easy and pleasant experience. (For more on this, see this talk from Hamel Husain.)",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#install",
    "href": "index.html#install",
    "title": "claudette",
    "section": "Install",
    "text": "Install\npip install claudette",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#getting-started",
    "href": "index.html#getting-started",
    "title": "claudette",
    "section": "Getting started",
    "text": "Getting started\nAnthropic’s Python SDK will automatically be installed with Claudette, if you don’t already have it.\n\nimport os\n# os.environ['ANTHROPIC_LOG'] = 'debug'\n\nTo print every HTTP request and response in full, uncomment the above line.\n\nfrom claudette import *\n\nClaudette only exports the symbols that are needed to use the library, so you can use import * to import them. Alternatively, just use:\nimport claudette\n…and then add the prefix claudette. to any usages of the module.\nClaudette provides models, which is a list of models currently available from the SDK.\n\nmodels\n\n['claude-opus-4-6',\n 'claude-sonnet-4-6',\n 'claude-haiku-4-5',\n 'claude-opus-4-5',\n 'claude-sonnet-4-5',\n 'claude-opus-4-1-20250805',\n 'claude-opus-4-20250514',\n 'claude-3-opus-20240229',\n 'claude-sonnet-4-20250514',\n 'claude-3-7-sonnet-20250219']\n\n\nFor these examples, we’ll use the latest Sonnet, since it’s awesome!\n\nmodel = models[1]\nmodel\n\n'claude-sonnet-4-6'",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#chat",
    "href": "index.html#chat",
    "title": "claudette",
    "section": "Chat",
    "text": "Chat\nThe main interface to Claudette is the Chat class, which provides a stateful interface to Claude:\n\nchat = Chat(model, sp=\"\"\"You are a helpful and concise assistant.\"\"\")\nchat(\"I'm Jeremy\")\n\nHi Jeremy! Nice to meet you. How can I help you today?\n\n\nid: msg_013Rva2xWKUGj5uWmMT2FgpD\ncontainer: None\ncontent: [{'citations': None, 'text': 'Hi Jeremy! Nice to meet you. How can I help you today?', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 20, 'output_tokens': 18, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nr = chat(\"What's my name?\")\nr\n\nYour name is Jeremy! You told me at the start of our conversation.\n\n\nid: msg_01Ga3WLVuuSimKWFaay51Mfn\ncontainer: None\ncontent: [{'citations': None, 'text': 'Your name is Jeremy! You told me at the start of our conversation.', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 46, 'output_tokens': 18, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nr = chat(\"What's my name?\")\nr\n\nYour name is Jeremy! You mentioned it at the beginning of our chat.\n\n\nid: msg_01VDXgMU8PdjD4oeuR2Xo6KJ\ncontainer: None\ncontent: [{'citations': None, 'text': 'Your name is Jeremy! You mentioned it at the beginning of our chat.', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 72, 'output_tokens': 18, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nAs you see above, displaying the results of a call in a notebook shows just the message contents, with the other details hidden behind a collapsible section. Alternatively you can print the details:\n\nprint(r)\n\nMessage(id='msg_01VDXgMU8PdjD4oeuR2Xo6KJ', container=None, content=[TextBlock(citations=None, text='Your name is Jeremy! You mentioned it at the beginning of our chat.', type='text')], model='claude-sonnet-4-6', role='assistant', stop_reason='end_turn', stop_sequence=None, type='message', usage=In: 72; Out: 18; Cache create: 0; Cache read: 0; Total Tokens: 90; Search: 0; Fetch: 0)\n\n\nYou can add stream=True to stream the results as soon as they arrive (although you will only see the gradual generation if you execute the notebook yourself, of course!)\n\nAsync\nAlternatively, you can use AsyncChat (or AsyncClient) for the async versions, e.g:\n\nchat = AsyncChat(model)\nawait chat(\"I'm Jeremy\")\n\nHi Jeremy! Nice to meet you. How can I help you today?\n\n\nid: msg_01M4N4EGidKKDQ4KzLhWmfxb\ncontainer: None\ncontent: [{'citations': None, 'text': 'Hi Jeremy! Nice to meet you. How can I help you today?', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 10, 'output_tokens': 18, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nRemember to use async for when streaming in this case:\n\nasync for o in await chat(\"Concisely, what is the meaning of life?\", stream=True):\n    print(o, end='')\n\nA classic question! Here are a few perspectives:\n\n- **Philosophical**: To seek happiness, virtue, or purpose (Aristotle, Stoics)\n- **Religious**: To serve/know God or achieve enlightenment\n- **Existential**: Life has no inherent meaning — you create your own\n- **Scientific**: Biologically, to survive and reproduce\n- **Simple**: To love, connect, and find joy\n\nThe honest answer is **there's no single universal answer** — it's one of humanity's most personal questions.\n\nWhat do *you* think, Jeremy?",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#prompt-caching",
    "href": "index.html#prompt-caching",
    "title": "claudette",
    "section": "Prompt caching",
    "text": "Prompt caching\nClaude supports prompt caching, which can significantly reduce token usage costs when working with large contexts or repetitive elements. When you use mk_msg(msg, cache=True), Claudette adds the necessary cache control headers to make that message cacheable.\nPrompt caching works by marking segments of your prompt for efficient reuse. When a cached segment is encountered again, Claude reads it from the cache rather than processing the full content, resulting in a 90% reduction in token costs for those segments.\nSome key points about prompt caching: - Cache writes cost 25% more than normal input tokens - Cache reads cost 90% less than normal input tokens - Minimum cacheable length is model-dependent (1024-2048 tokens) - Cached segments must be completely identical to be reused - Works well for system prompts, tool definitions, and large context blocks\nFor instance, here we use caching when asking about Claudette’s readme file:\n\nchat = Chat(model, sp=\"\"\"You are a helpful and concise assistant.\"\"\")\n\n\nnbtxt = Path('README.txt').read_text()\nmsg = f'''&lt;README&gt;\n{nbtxt}\n&lt;/README&gt;\nIn brief, what is the purpose of this project based on the readme?'''\nr = chat(mk_msg(msg, cache=True))\nr\n\nClaudette is a high-level Python wrapper around Anthropic’s Claude API SDK that simplifies common tasks. Its key purposes are:\n\nReduce boilerplate – automates repetitive low-level SDK work\nStateful chat – provides a Chat class for multi-turn conversations\nTool use – makes it easy to give Claude access to Python functions\nStructured output – extract typed/structured data from Claude’s responses\nExtra conveniences – prefill support, image handling, prompt caching, streaming, and async support\nMulti-provider support – works with Anthropic directly, AWS Bedrock, and Google Vertex\n\nIn short: it makes working with Claude easier and more ergonomic while retaining full control.\n\n\nid: msg_01Eeco89ejrtQCnoU1DY8XWJ\ncontainer: None\ncontent: [{'citations': None, 'text': \"Claudette is a high-level Python wrapper around Anthropic's Claude API SDK that simplifies common tasks. Its key purposes are:\\n\\n1. **Reduce boilerplate** – automates repetitive low-level SDK work\\n2. **Stateful chat** – provides a [Chat](https://claudette.answer.ai/core.html#chat) class for multi-turn conversations\\n3. **Tool use** – makes it easy to give Claude access to Python functions\\n4. **Structured output** – extract typed/structured data from Claude's responses\\n5. **Extra conveniences** – prefill support, image handling, prompt caching, streaming, and async support\\n6. **Multi-provider support** – works with Anthropic directly, AWS Bedrock, and Google Vertex\\n\\nIn short: it makes working with Claude easier and more ergonomic while retaining full control.\", 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 9289}, 'cache_creation_input_tokens': 9289, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 3, 'output_tokens': 181, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nThe response records the a cache has been created using these input tokens:\n\nprint(r.usage)\n\nUsage(cache_creation=CacheCreation(ephemeral_1h_input_tokens=0, ephemeral_5m_input_tokens=9289), cache_creation_input_tokens=9289, cache_read_input_tokens=0, inference_geo='global', input_tokens=3, output_tokens=181, server_tool_use=None, service_tier='standard')\n\n\nWe can now ask a followup question in this chat:\n\nr = chat('How does it make tool use more ergonomic?')\nr\n\nBased on the README, Claudette makes tool use more ergonomic in several ways:\n\nDocments-based function definitions – You define tools as plain Python functions using type annotations and inline comments to describe parameters, rather than writing verbose JSON schemas manually:\ndef sums(\n    a:int,  # First thing to sum\n    b:int=1 # Second thing to sum\n) -&gt; int: # The sum of the inputs\n    \"Adds a + b.\"\n    return a + b\nAutomatic tool call handling – When Claude returns a tool_use message, Claudette automatically calls the function with the provided arguments. You just call chat() again and it handles everything behind the scenes.\ntoolloop method – A single call to chat.toolloop() can handle multi-step problems requiring multiple sequential tool calls (e.g. first calling sums, then mults), without you needing to manually manage the back-and-forth.\nstructured method – For simple cases where you just want the result of a single tool call, Client.structured() handles everything in one step and returns the result directly.\ntool_choice option – You can force Claude to always use a specific tool by passing its name to tool_choice, giving you control over when tools are invoked.\n\nIn summary, it removes the manual boilerplate of schema definition, response parsing, and tool dispatch loops.\n\n\nid: msg_017w4Fhy4g2Th8nwskbwnfRi\ncontainer: None\ncontent: [{'citations': None, 'text': 'Based on the README, Claudette makes tool use more ergonomic in several ways:\\n\\n1. **Docments-based function definitions** – You define tools as plain Python functions using type annotations and inline comments to describe parameters, rather than writing verbose JSON schemas manually:\\n   ```python\\n   def sums(\\n       a:int,  # First thing to sum\\n       b:int=1 # Second thing to sum\\n   ) -&gt; int: # The sum of the inputs\\n       \"Adds a + b.\"\\n       return a + b\\n   ```\\n\\n2. **Automatic tool call handling** – When Claude returns atool_usemessage, Claudette automatically calls the function with the provided arguments. You just callchat()again and it handles everything behind the scenes.\\n\\n3. **toolloopmethod** – A single call tochat.toolloop()can handle multi-step problems requiring multiple sequential tool calls (e.g. first callingsums, thenmults), without you needing to manually manage the back-and-forth.\\n\\n4. **structuredmethod** – For simple cases where you just want the result of a single tool call, [Client.structured()](https://claudette.answer.ai/core.html#client.structured) handles everything in one step and returns the result directly.\\n\\n5. **tool_choiceoption** – You can force Claude to always use a specific tool by passing its name totool_choice, giving you control over when tools are invoked.\\n\\nIn summary, it removes the manual boilerplate of schema definition, response parsing, and tool dispatch loops.', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 9289, 'inference_geo': 'global', 'input_tokens': 198, 'output_tokens': 346, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nWe can see that this only used ~200 regular input tokens – the 7000+ context tokens have been read from cache.\n\nprint(r.usage)\n\nUsage(cache_creation=CacheCreation(ephemeral_1h_input_tokens=0, ephemeral_5m_input_tokens=0), cache_creation_input_tokens=0, cache_read_input_tokens=9289, inference_geo='global', input_tokens=198, output_tokens=346, server_tool_use=None, service_tier='standard')\n\n\n\nchat.use\n\nIn: 201; Out: 527; Cache create: 9289; Cache read: 9289; Total Tokens: 19306; Search: 0; Fetch: 0",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#tool-use",
    "href": "index.html#tool-use",
    "title": "claudette",
    "section": "Tool use",
    "text": "Tool use\nTool use lets Claude use external tools.\nWe use docments to make defining Python functions as ergonomic as possible. Each parameter (and the return value) should have a type, and a docments comment with the description of what it is. As an example we’ll write a simple function that adds numbers together, and will tell us when it’s being called:\n\ndef sums(\n    a:int,  # First thing to sum\n    b:int=1 # Second thing to sum\n) -&gt; int: # The sum of the inputs\n    \"Adds a + b.\"\n    print(f\"Finding the sum of {a} and {b}\")\n    return a + b\n\nSometimes Claude will try to add stuff up “in its head”, so we’ll use a system prompt to ask it not to.\n\nsp = \"Always use tools if math ops are needed.\"\n\nWe’ll get Claude to add up some long numbers:\n\na,b = 604542,6458932\npr = f\"What is {a}+{b}?\"\npr\n\n'What is 604542+6458932?'\n\n\nTo use tools, pass a list of them to Chat:\n\nchat = Chat(model, sp=sp, tools=[sums])\n\nTo force Claude to always answer using a tool, set tool_choice to that function name. When Claude needs to use a tool, it doesn’t return the answer, but instead returns a tool_use message, which means we have to call the named tool with the provided parameters.\n\nr = chat(pr, tool_choice='sums')\nr\n\nFinding the sum of 604542 and 6458932\n\n\n[ToolUseBlock(id=‘toolu_01Me4y668vh5CbRCYDm9GTmd’, caller=DirectCaller(type=‘direct’), input={‘a’: 604542, ‘b’: 6458932}, name=‘sums’, type=‘tool_use’)]\n\n\nid: msg_01XymeBh9aPp5HJJjm6zwxja\ncontainer: None\ncontent: [{'id': 'toolu_01Me4y668vh5CbRCYDm9GTmd', 'caller': {'type': 'direct'}, 'input': {'a': 604542, 'b': 6458932}, 'name': 'sums', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 725, 'output_tokens': 53, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nClaudette handles all that for us – we just call it again, and it all happens automatically:\n\nchat()\n\nThe sum of 604,542 + 6,458,932 is 7,063,474!\n\n\nid: msg_01WAdAsXseRvPmEAyg63bpCk\ncontainer: None\ncontent: [{'citations': None, 'text': 'The sum of 604,542 + 6,458,932 is **7,063,474**!', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 717, 'output_tokens': 28, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nYou can see how many tokens have been used at any time by checking the use property. Note that (as of May 2024) tool use in Claude uses a lot of tokens, since it automatically adds a large system prompt.\n\nchat.use\n\nIn: 1442; Out: 81; Cache create: 0; Cache read: 0; Total Tokens: 1523; Search: 0; Fetch: 0\n\n\nWe can do everything needed to use tools in a single step, by using Chat.toolloop. This can even call multiple tools as needed solve a problem. For example, let’s define a tool to handle multiplication:\n\ndef mults(\n    a:int,  # First thing to multiply\n    b:int=1 # Second thing to multiply\n) -&gt; int: # The product of the inputs\n    \"Multiplies a * b.\"\n    print(f\"Finding the product of {a} and {b}\")\n    return a * b\n\nNow with a single call we can calculate (a+b)*2 – by passing show_trace we can see each response from Claude in the process:\n\nchat = Chat(model, sp=sp, tools=[sums,mults])\npr = f'Calculate ({a}+{b})*2'\npr\n\n'Calculate (604542+6458932)*2'\n\n\n\nfor o in chat.toolloop(pr): display(o)\n\nFinding the sum of 604542 and 6458932\n\n\nI need to calculate (604542 + 6458932) * 2. Let me start by computing the sum first.\n\n\nid: msg_016D9YoZZnhn6FBwuTaA2xtV\ncontainer: None\ncontent: [{'citations': None, 'text': 'I need to calculate (604542 + 6458932) * 2. Let me start by computing the sum first.', 'type': 'text'}, {'id': 'toolu_01S4a9Qz4eVGvp8YsYuPGWty', 'caller': {'type': 'direct'}, 'input': {'a': 604542, 'b': 6458932}, 'name': 'sums', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 735, 'output_tokens': 100, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{ 'content': [ { 'content': '7063474',\n                 'tool_use_id': 'toolu_01S4a9Qz4eVGvp8YsYuPGWty',\n                 'type': 'tool_result'}],\n  'role': 'user'}\n\n\nFinding the product of 7063474 and 2\n\n\nNow let me multiply the result by 2.\n\n\nid: msg_01PHLZzu8mX7dSaRhBQcAgJi\ncontainer: None\ncontent: [{'citations': None, 'text': 'Now let me multiply the result by 2.', 'type': 'text'}, {'id': 'toolu_01Bvt9ZmBX7YpStiTBzceemY', 'caller': {'type': 'direct'}, 'input': {'a': 7063474, 'b': 2}, 'name': 'mults', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 850, 'output_tokens': 82, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n{ 'content': [ { 'content': '14126948',\n                 'tool_use_id': 'toolu_01Bvt9ZmBX7YpStiTBzceemY',\n                 'type': 'tool_result'}],\n  'role': 'user'}\n\n\nHere’s the breakdown of the calculation:\n\n604542 + 6458932 = 7,063,474\n7,063,474 × 2 = 14,126,948\n\nTherefore, (604542 + 6458932) × 2 = 14,126,948\n\n\nid: msg_01LWmJoTjBJsKgnroMXPSxD9\ncontainer: None\ncontent: [{'citations': None, 'text': \"Here's the breakdown of the calculation:\\n\\n1. **604542 + 6458932 = 7,063,474**\\n2. **7,063,474 × 2 = 14,126,948**\\n\\nTherefore, **(604542 + 6458932) × 2 = 14,126,948**\", 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 947, 'output_tokens': 80, 'server_tool_use': None, 'service_tier': 'standard'}",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#structured-data",
    "href": "index.html#structured-data",
    "title": "claudette",
    "section": "Structured data",
    "text": "Structured data\nIf you just want the immediate result from a single tool, use Client.structured.\n\ncli = Client(model)\n\n\ndef sums(\n    a:int,  # First thing to sum\n    b:int=1 # Second thing to sum\n) -&gt; int: # The sum of the inputs\n    \"Adds a + b.\"\n    print(f\"Finding the sum of {a} and {b}\")\n    return a + b\n\n\ncli.structured(\"What is 604542+6458932\", sums)\n\nFinding the sum of 604542 and 6458932\n\n\n[7063474]\n\n\nThis is particularly useful for getting back structured information, e.g:\n\nclass President:\n    \"Information about a president of the United States\"\n    def __init__(self, \n                first:str, # first name\n                last:str, # last name\n                spouse:str, # name of spouse\n                years_in_office:str, # format: \"{start_year}-{end_year}\"\n                birthplace:str, # name of city\n                birth_year:int # year of birth, `0` if unknown\n        ):\n        assert re.match(r'\\d{4}-\\d{4}', years_in_office), \"Invalid format: `years_in_office`\"\n        store_attr()\n\n    __repr__ = basic_repr('first, last, spouse, years_in_office, birthplace, birth_year')\n\n\ncli.structured(\"Provide key information about the 3rd President of the United States\", President)\n\n[President(first='Thomas', last='Jefferson', spouse='Martha Jefferson', years_in_office='1801-1809', birthplace='Shadwell', birth_year=1743)]",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#images",
    "href": "index.html#images",
    "title": "claudette",
    "section": "Images",
    "text": "Images\nClaude can handle image data as well. As everyone knows, when testing image APIs you have to use a cute puppy.\n\nfn = Path('samples/puppy.jpg')\nImage(filename=fn, width=200)\n\n\n\n\n\n\n\n\nWe create a Chat object as before:\n\nchat = Chat(model)\n\nClaudette expects images as a list of bytes, so we read in the file:\n\nimg = fn.read_bytes()\n\nPrompts to Claudette can be lists, containing text, images, or both, eg:\n\nchat([img, \"In brief, what color flowers are in this image?\"])\n\nThe flowers in the image are purple/lavender (blue-purple). They appear to be asters.\n\n\nid: msg_01DUds87tAj47fozgFfbEPrQ\ncontainer: None\ncontent: [{'citations': None, 'text': 'The flowers in the image are **purple/lavender** (blue-purple). They appear to be **asters**.', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 110, 'output_tokens': 28, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nThe image is included as input tokens.\n\nchat.use\n\nIn: 110; Out: 28; Cache create: 0; Cache read: 0; Total Tokens: 138; Search: 0; Fetch: 0\n\n\nAlternatively, Claudette supports creating a multi-stage chat with separate image and text prompts. For instance, you can pass just the image as the initial prompt (in which case Claude will make some general comments about what it sees), and then follow up with questions in additional prompts:\n\nchat = Chat(model)\nchat(img)\n\nAdorable Cavalier King Charles Spaniel Puppy 🐾\nWhat a precious photo! This appears to be a Cavalier King Charles Spaniel puppy, characterized by:\n\nChestnut/ruby and white coloring (called “Blenheim” pattern)\nLarge, round dark eyes\nLong, floppy ears\nSoft, silky coat\n\nThe puppy is resting in green grass next to beautiful purple aster flowers, making for a perfect portrait shot! 🌸\nCavalier King Charles Spaniels are known for being: - 💕 Affectionate and gentle - 🏠 Great family dogs - 🐕 Eager to please - 😊 Friendly with everyone\nThis little one looks to be just a few months old — absolutely adorable! 🥰\n\n\nid: msg_01AnF9pQ6LZd4hPyVvFridhD\ncontainer: None\ncontent: [{'citations': None, 'text': '# Adorable Cavalier King Charles Spaniel Puppy 🐾\\n\\nWhat a precious photo! This appears to be a **Cavalier King Charles Spaniel** puppy, characterized by:\\n\\n- **Chestnut/ruby and white** coloring (called \"Blenheim\" pattern)\\n- Large, **round dark eyes**\\n- Long, **floppy ears**\\n- Soft, silky coat\\n\\nThe puppy is resting in **green grass** next to beautiful **purple aster flowers**, making for a perfect portrait shot! 🌸\\n\\nCavalier King Charles Spaniels are known for being:\\n- 💕 Affectionate and gentle\\n- 🏠 Great family dogs\\n- 🐕 Eager to please\\n- 😊 Friendly with everyone\\n\\nThis little one looks to be just a **few months old** — absolutely adorable! 🥰', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 98, 'output_tokens': 213, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat('What direction is the puppy facing?')\n\nDirection the Puppy is Facing\nThe puppy is facing toward the camera (forward), looking directly at the viewer.\nIts head is slightly angled/tilted, giving it that classic adorable puppy look! 🐾\nThe puppy appears to be lying down in the grass with its front paws extended, with the purple flowers to its left side (our right).\n\n\nid: msg_012tHpJy12tRC6hB4THWfhiZ\ncontainer: None\ncontent: [{'citations': None, 'text': '## Direction the Puppy is Facing\\n\\nThe puppy is facing **toward the camera** (forward), looking directly at the viewer.\\n\\nIts head is slightly **angled/tilted**, giving it that classic adorable puppy look! 🐾\\n\\nThe puppy appears to be **lying down** in the grass with its front paws extended, with the purple flowers to its **left side** (our right).', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 322, 'output_tokens': 93, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat('What color is it?')\n\nThe Puppy’s Colors 🎨\nThe puppy has a two-toned coat known as the “Blenheim” pattern:\n\nChestnut/Reddish-Brown - on its ears and patches on its face/head\nWhite - on its muzzle, chest, and body\n\n\nOther Color Details:\n\nDark brown/black nose\nDark brown eyes\nThe colors have a soft, silky appearance typical of Cavalier King Charles Spaniels\n\nThis Blenheim coloring is one of the most classic and recognizable patterns for this breed! 🐕\n\n\nid: msg_01W6p3tEiJxPPE3yXqQ3RHMD\ncontainer: None\ncontent: [{'citations': None, 'text': '## The Puppy\\'s Colors 🎨\\n\\nThe puppy has a **two-toned coat** known as the **\"Blenheim\"** pattern:\\n\\n- **Chestnut/Reddish-Brown** - on its ears and patches on its face/head\\n- **White** - on its muzzle, chest, and body\\n\\n### Other Color Details:\\n- **Dark brown/black** nose\\n- **Dark brown** eyes\\n- The colors have a **soft, silky** appearance typical of Cavalier King Charles Spaniels\\n\\nThis Blenheim coloring is one of the most **classic and recognizable** patterns for this breed! 🐕', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 423, 'output_tokens': 156, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nNote that the image is passed in again for every input in the dialog, so that number of input tokens increases quickly with this kind of chat. (For large images, using prompt caching might be a good idea.)\n\nchat.use\n\nIn: 843; Out: 462; Cache create: 0; Cache read: 0; Total Tokens: 1305; Search: 0; Fetch: 0",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#direction-the-puppy-is-facing",
    "href": "index.html#direction-the-puppy-is-facing",
    "title": "claudette",
    "section": "Direction the Puppy is Facing",
    "text": "Direction the Puppy is Facing\nThe puppy is facing toward the camera (forward), looking directly at the viewer.\nIts head is slightly angled/tilted, giving it that classic adorable puppy look! 🐾\nThe puppy appears to be lying down in the grass with its front paws extended, with the purple flowers to its left side (our right).\n\n\nid: msg_012tHpJy12tRC6hB4THWfhiZ\ncontainer: None\ncontent: [{'citations': None, 'text': '## Direction the Puppy is Facing\\n\\nThe puppy is facing **toward the camera** (forward), looking directly at the viewer.\\n\\nIts head is slightly **angled/tilted**, giving it that classic adorable puppy look! 🐾\\n\\nThe puppy appears to be **lying down** in the grass with its front paws extended, with the purple flowers to its **left side** (our right).', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 322, 'output_tokens': 93, 'server_tool_use': None, 'service_tier': 'standard'}",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#the-puppys-colors",
    "href": "index.html#the-puppys-colors",
    "title": "claudette",
    "section": "The Puppy’s Colors 🎨",
    "text": "The Puppy’s Colors 🎨\nThe puppy has a two-toned coat known as the “Blenheim” pattern:\n\nChestnut/Reddish-Brown - on its ears and patches on its face/head\nWhite - on its muzzle, chest, and body\n\n\nOther Color Details:\n\nDark brown/black nose\nDark brown eyes\nThe colors have a soft, silky appearance typical of Cavalier King Charles Spaniels\n\nThis Blenheim coloring is one of the most classic and recognizable patterns for this breed! 🐕\n\n\nid: msg_01W6p3tEiJxPPE3yXqQ3RHMD\ncontainer: None\ncontent: [{'citations': None, 'text': '## The Puppy\\'s Colors 🎨\\n\\nThe puppy has a **two-toned coat** known as the **\"Blenheim\"** pattern:\\n\\n- **Chestnut/Reddish-Brown** - on its ears and patches on its face/head\\n- **White** - on its muzzle, chest, and body\\n\\n### Other Color Details:\\n- **Dark brown/black** nose\\n- **Dark brown** eyes\\n- The colors have a **soft, silky** appearance typical of Cavalier King Charles Spaniels\\n\\nThis Blenheim coloring is one of the most **classic and recognizable** patterns for this breed! 🐕', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 423, 'output_tokens': 156, 'server_tool_use': None, 'service_tier': 'standard'}",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#extended-thinking",
    "href": "index.html#extended-thinking",
    "title": "claudette",
    "section": "Extended Thinking",
    "text": "Extended Thinking\nClaude &gt;=3.7 Sonnet and Opus have enhanced reasoning capabilities through extended thinking. This feature allows Claude to think through complex problems step-by-step, making its reasoning process transparent and its final answers more reliable.\nTo enable extended thinking, simply specify the number of thinking tokens using the maxthinktok parameter when making a call to Chat. The thinking process will appear in a collapsible section in the response.\nSome important notes about extended thinking:\n\nOnly available with select models\nAutomatically sets temperature=1 when enabled (required for thinking to work)\nCannot be used with prefill (these features are incompatible)\nThinking is presented in a separate collapsible block in the response\nThe thinking tokens count toward your usage but help with complex reasoning\n\nTo access models that support extended thinking, you can use has_extended_thinking_models.\n\nhas_extended_thinking_models\n\n{'claude-3-7-sonnet-20250219',\n 'claude-haiku-4-5',\n 'claude-opus-4-1-20250805',\n 'claude-opus-4-20250514',\n 'claude-opus-4-5',\n 'claude-opus-4-6',\n 'claude-sonnet-4-20250514',\n 'claude-sonnet-4-5',\n 'claude-sonnet-4-6'}\n\n\n\nchat = Chat(model)\n\n\nchat('Write a sentence about Python!', maxthinktok=1024)\n\nHere’s a sentence about Python:\nPython is a versatile, beginner-friendly programming language known for its clean, readable syntax and wide range of applications, from web development and data science to artificial intelligence and automation.\nWould you like to know more about Python? 🐍\n\n\nThinking\n\nThe user wants a sentence about Python. I can write about either the programming language or the snake.\n\n\n\nid: msg_01JskDndrbaWnSQgv6qCdAqS\ncontainer: None\ncontent: [{'signature': 'Eo8CCkYICxgCKkCBEKnKVDpDoGHOpgbeicO3HN7C5IAEV4gKKcy5K5P1sK0OSwqddH86GNSttMnCuRVR/8xQ+PB2IDnIwEQnJu1JEgzaa51QCorORWmhxJkaDOTIO6MdGx0eiWVelCIwakucJThWzglRgVQhli6gpNZEZCN0glxGhFKbIXXIsN5dyKp0J6MAaUKaIJHTKwTwKneqlOSxU2yBi5cR/gWtnXS4HWEd7eMdqz5lmwt9CW04ExUcCiEz/1wTkIL88ImthnBq3JwhDvSSAqkeneLpI35foO4fio6+C3aLF971rgx9T7Y9dV69yii56gtPjeQT3Rwg1y6xyWlh3ITdoSuJP38Lh7kCzkDkGxgB', 'thinking': 'The user wants a sentence about Python. I can write about either the programming language or the snake.', 'type': 'thinking'}, {'citations': None, 'text': \"Here's a sentence about Python:\\n\\n**Python is a versatile, beginner-friendly programming language known for its clean, readable syntax and wide range of applications, from web development and data science to artificial intelligence and automation.**\\n\\nWould you like to know more about Python? 🐍\", 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 42, 'output_tokens': 91, 'server_tool_use': None, 'service_tier': 'standard'}",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#web-search-and-server-tools",
    "href": "index.html#web-search-and-server-tools",
    "title": "claudette",
    "section": "Web Search and Server Tools",
    "text": "Web Search and Server Tools\nClaude supports server-side tools that run on Anthropic’s infrastructure. The flagship example is the web search tool, which allows Claude to search the web for up-to-date information to answer questions.\nUnlike client-side tools (where you provide functionality), server-side tools are managed by Anthropic. Claudette makes these easy to use with helper functions like search_conf().\n\nchat = Chat(model, sp='Be concise in your responses.', tools=[search_conf()])\npr = 'What is the current weather in San Diego?'\nr = chat(pr)\nr\n\nHere’s the current weather in San Diego, CA:\n\n🌤️ Conditions: Mostly Sunny with a high of 68°F and a low of 46°F. 1\n💨 Wind: NW at 5 to 10 mph. 2\n💧 Humidity: 50%, with a dew point of 44°F. 3\n👁️ Visibility: 10 miles. 4\n🌡️ Temperature Trend: Temperatures are increasing through late week, with highs reaching into the mid-70s for inland areas — a few degrees warmer than yesterday. 5\n\nOverall, it’s a pleasant late-February day in San Diego!\n\n\nid: msg_0138hW3upJaBxnQfvox4M2wj\ncontainer: None\ncontent: [{'id': 'srvtoolu_014w2tib6HtQ1d761AGDBfq1', 'caller': {'type': 'direct'}, 'input': {'query': 'current weather San Diego today'}, 'name': 'web_search', 'type': 'server_tool_use'}, {'caller': {'type': 'direct'}, 'content': [{'encrypted_content': 'EoILCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDODQd7fu7Irx8AG56xoM7BomdKj473jPvPTNIjD6+67CwvQC1SmH9ITN6DCGAdQt8pocj64Q+78c3mps9rOD37zIo8DY9WEpV1iT7YwqhQpJYUgVw/y7x6orFZZ4DznF0afyyMia7BSPOMtxYbEHgrdF2sfyqYWvbG2BSszz6+UXY0IExzDDA9T8Co5p1B6h5qft1nVI0WgK5Q+NeRJic9sDB4cMVpSdwZ0hh8WvEIwlke6QugHmyWW10oThzClSFaj9yHfDSGecLnVgovEoNWJMD0TC9v2v8M5C1Z14aGjzft4CP3dZFkGyA/T9iTedcjmb9hqVKtimIVCFJbp57MsaVKeDEmbdv3LV1DYqSM4ER447BHoccF9KDSOqJJPO8bNCp/GMxzC21lcoHBx+lHZ0uBq1q8+1hiF9/ilPG/D+6kjpp+gxnCCiSlfAnaWQyb8rs5I9Mw+q586VfLVhl9XpD9joYCo3si2v4crhY5g9UrsEKDXCJS/pTgPL92xV5tmu5e+YADzZ4Gcn/1gQ/b6hH78Un6KliuQT/QZYPUNvLbuL3wFNzz8NMH63Qdl1DDNzBFGIKYtqy1e3VoIk5Yv15ntuDjWhEux8xNozQJabE9OwgM+l8/ZpSPp3K9ur9Da7RoR//lmh57kzW53SS3LtDWJLS3tHkatnun/rDsQYJnkTDLQeSivVa9NQtY7STUiJEV4U7r9eAxHOCxDfIxj3ZDQ/DFnL76SsopvwnH/YZsa/ktjpNtNTYKEvqxT7r7OESpR1ptY/vFsxZMvxYnke78pkEZnWeb3PQSfBc927gGMbQWix3ZfJq1M06wqyw0mvAUKS5VJK/t+3ZQu8TjQ/1uALzuuctcz7WTcOgvohE4hld3dHCiA+c2un+ks5K/8+hdL02Gv/7kOyZFmgWOft7UJ0EhhnAMDapc0cg0hmEEHFXuiNNdf2tF9iP4zQpOEspmJvDDpZmJWr1gWUCli5c+TLaAlSTadnjIk58WscRwz2lPYuQHE2+j10HKMD/DJXQWhOdm/yScmAleEQqOZ0vTWaSToAkLrzIptS57LbLTjuAVj1pBW4uxSUt8glH0VER9Hne3M8vbwYiv5Z1EKGGBEzCz7UEC7Sp+IIJZRMtyi0RV46yVXdZ3UgD8M9d0RztcnSY98v+qZQVbizJu+SVDevgX22BFsPKWpeeiMOqrHipIbD98919wsapeahY450sQu/sGYaioonT1ce86FVFMabsAGPIPiFpIKlzWSIV4unh4uySyD3mvtOBfa5dBA9xU9kln7Byp/qiy4FRH/Vzof2MxWHbFW2FfmNYeNCxCTiFmB3JMCKfrxZVjAKsyMU0IOAqkCO2yGGo5VPVH/bjQ699L4SNHGMmpTiFe4+i+3Q8ahNKPmDd0TegLlPR0OBDbyK6t8ml1fDPJZ59HspDI5j/q916gdK3YvjYL9FuLMx7PFkjFisAhY3t2BtNctERs6cWq1Pl717Ii+OGa2sCGKSMHdhVX2Gn1xiSPlOt27y6/a2JLHQvX082aShXfVyGqCBhlwiSnSTVNp6SJOzYmZfRrTNxOL+eC82Mx1V9rPfJ1KDcxvFzrApNoXHLDvEeGHhlG63Cvtco1uWGBXclcGWfWyEwK60p3JIVT0fTKc9lJC03WHM6WvSt6+HxXz2A9oYbCuocCAn3gmp2w7BLYvAc7syFQHcGfXIXXbBVUgmY6L7RGYsXxxGlRCL7Fe9RYOSNsGVeAaPKU0UjKDFbmcq9cV+Z6DjG8YvRbKCKgKFXzd53ybTRhji/HADmBZPYD7vXyNyWJES20TPNTLbAzeDGAM=', 'page_age': None, 'title': 'San Diego, CA', 'type': 'web_search_result', 'url': 'https://www.weather.gov/sgx'}, {'encrypted_content': 'EqIHCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDEfDZzUsrA69W+nWihoMvt7q7fXTL4Gv0VIbIjCYFnLJAnmtn5DJ8vUdDU4YbiK/8h0o8R1JN+dP5jBlOWxU3P1LX9kRawfv/tYcvswqpQZqpKLgGVPZoVC7c1qbf3oAPqa56cp9XeoWE8DjUDgJLimUWfiXc/uXI/6FVDVgqQTBeNWlAkAAnQmnUcITcRdZ2w1p4pQdq2GbQENhs5MDbrgsftoV3oUOcUTwnrfP55yw8WXqKc2CWcXqr2vEqAGy1H5HSOFP+zXkcHEzzz0z+VlVSeNU7ZcIEQ8NgkMxAcddZRb4UkVBj9mfro5vwcnqqo7ur4ilPE66oIvtKLN74MtXCbiIWMbNZ0e2bAA2QWbSYhc0KDpOmRR96bQ5sJV6GPeR74CUav5oZF2nTwob/g5EQKbalZKLe/yqrNCzf9uuRdPDSoPcT8G90cpT7SnROib1Kk/r4JAhDCwEaDy53Mp+JxiAPUszHGGLPuCjX1M4EOoICRRwzVHXLbffx7lRg42qt+Cd4ekNToBUHo757sN3Qa9GmAdH3HKUVaCntCy2OQiln0GVgTLJG/qaH8kiHghUbIZ4H13k33gpqCOybRLp7C3B9zFfFhq1uxsMBcjrwk4k5HhyKRdm3vtFCfoagsSH/ol83O9GqLPmH9hhlabo6U9yAUamrX2GjZwi2JSj51Jr16UswE0SJpVqyBqf+zXgeruaMq1yM1Kdo5V1fG/dbQ6BnaNvZq8DyyjM9oTxMpMKi+7VpGq8R37QrpZFKH1Cg7sTZetyjVEI2PF7t4j9lyqa5vWX4Ciks5Yib26jGPukmPX5OuV/UvdTAFvRsRqpbKfgljYcu6cqHoLEhpZjhMv0xc16ea3zLXiX87pWZt7w/jbhaKQT558Jl0lBhB1bsSacvvirAyh3PNNfjzp4TnPwcDX9RwhCTrbybCBVFf3kIW6TV3QOT75Qw0A6fv3wCm260VIRkkUJOEUzSm/gcYhtx43BFvpRjNBrVHVUs4GO7pdljkWEDPLwMnNmGt7tODB9NbT3jcZZOmkZHEpo6UX9i3PxTcaU5nEV6Asc5HZJZ4mAx5Pgu+GyfYMqwiByTxh0Hcv6LNCJyQ/ddgz77xhNJVGaPL+LrxR/3oZD8lCH1hpWldiugs3G4hN5+2WMPLk8Grlv9EszapiZCCUizo3oGAM=', 'page_age': None, 'title': 'San Diego, CA Weather Forecast, Conditions, and Maps – Yahoo Weather', 'type': 'web_search_result', 'url': 'https://weather.yahoo.com/us/ca/san-diego/'}, {'encrypted_content': 'Eu0ECioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDGVS5NZvUKcyCqlG8RoMhgD0kq5uLNm9/2yJIjB17qvf2ps9kZaNwlzP6SS0z/+2Q9uLurLGM8Zpqx6BPJQo1b03XlFM93PGGPB+qZsq8AN8W3pOkYAA4HTNdkiAn33RtiOnBNMvNAFqG3tO5Q6ycAjbsj8Tje9vf9O5kHFVUUG4VcY3RluBJXMJj2X8y7DGWsNxHYiFhD/AsrDlY8LKUOiQZ2g7qpEftXIQH90rcN80aTTYB5oSK0a1sUAqehMBNgYDITs92QRpnQP0HxU5gtMd7knPMh8OrGq2wSNkLw3HOstx1Ptsl5agHj+Amcmkl3jn5f5l53xBd2d4PVancpYU4gSuGpNiGmiPKQfAacBvJ3a2PVWtkKfzLLNw6iydbSzcmXPuDliNDZOkQ1TuqQwd44kNh1+8wFzI+mL0pAiDvmCoO2tUzWGUbwKZ4I4Cw9sClEwLc/jwVREeVsCR15qyXHJcNKWsj+35rFkuuZnfO8L52pScSRpRfX7h5KuflFddwVx+mNM59H5qRRR3cok/WDrogNBT+2UtiyGWQthL8GtTs7maPNbuH7g1JmSpgZzJUbMQ+HSKFwrNBaFwtSL5bCQh2k47tI6R44l30Tql1+mfc6End8mMWl5w4Mih96LjNDNCzgEp0IN9O1RNQz7coTqmxjzzUlMdAnpfCKyMeoUh/8d4MjDAlQV01ptp6XMhLw8pQDJnKBCgZYr9Gc3C4PwHg53CvDAbVQenJSsHDLISco7Dvk0+LHmlRwcrGAM=', 'page_age': None, 'title': 'San Diego, CA Weather Conditions | Weather Underground', 'type': 'web_search_result', 'url': 'https://www.wunderground.com/weather/us/ca/san-diego'}, {'encrypted_content': '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', 'page_age': None, 'title': 'San Diego, CA Current Weather | AccuWeather', 'type': 'web_search_result', 'url': 'https://www.accuweather.com/en/us/san-diego/92101/current-weather/347628'}, {'encrypted_content': 'EvMHCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDDt2A5ewdhwNdL2h0RoMp/0JTDaXkG6TBy8GIjA9DSR1RcMsRmPuoHuiFwobRMHd8UB6x4qc/dxsT5xn4ydP0yqHNwLrltX0EumBPRwq9gaqTCcoavlgVNJwdlu0LLlpK/RgxLW/LcisYgGkdck7MmGgBqwOlgfIbQvLp41rzJtpfR9poy81jLDjG1P72svzGjG93D9zKeCQEsOZ+p2z+dFldfZcGj5OyKeMFyVfwviEl5grcfn+D8B5q1tt41RjwFZTiCs3RUCOc10ULLHBKjIR82HjeAI4uk+aQIeBYiw2G3wIJ6QVItTkhu8njQ+EUWBp79MdX/Ls5i3ZzqBTJOiXFUATrWaVufebTfoDVedPOy/voUT99110f7ed3Zl08mbMsltht/6Tbpn8MH8+JTvOrmdvh9mGdJ5C5KSfxlSS5/DXFBdA/OGo85yu1HPishfPi6S3LepMH4KpA8mmLTZrECNNdApUohF5Nq7wDy49Y2ciw+g2GyiV9XbZBCAF5ZvPrDxRzqU383RjuQlcJIZV7Og1i+DUbtBD8wp0g4cdwEmvpX1a2iL6cdzRRBdCk+WFV4VdNFaNw5i/PAfFiG8E0gzv14ipbMmc5j4A39br6XG8/rwsQNBmkAkU/lq2bTRYJM9IV1JsWvfrJ5JhmmFZJa9wIrtorkcfFjg70/h3eA2g66NDb/QvgvWezwJkUguMZuD/thoyvMkfIJ0AOdIIcsWdH6w5PWvQWWm6R1Rgm/otgk42l8hXuhVlx9jhkmuttty5fI3sScxYLgIqAjC7pv6bQghFWrhZ7fDhOzF1Iqe30oGeiWkywvvVQQoY75bWhOhMY//JK8QgsS62RR5Oj3Xit99m0rbaC2vZja6+GwJ/84L7+lGoLmbJ7yLpZWMZA8HlVCj9pqZvu6W8QIEV3Cmooq1vCT1DwoBE/+pGLhd1+lJBThW2XiKo34r8G+klMMlWjQfjX2hJccG3kwVpbee1RC+tIRhrkHFKdRsUYj0ZyxKtunMrglCnfFh7xd/qS7gP7EUC+gjCXS6aDC1MaXYJa77+M0jP0gr5cSXiJUX18gLGl8+r7MlL5/w5Yt3gJ2j15Ode9oeRbKlubE6sJvMNFH2RO7xUxTNoZlfStJ/hA4XmIiAz8YarOhEW1gAjLbB2OkifueWrwBz1wM4CzuHHHQazFlCMfv+alV2j79cGx7QqPS/pK9p6fllX6aqtwPH7opZNVvCxomIpfgk5bumNaiX61f8AYt2/uHnEXPtqQnmtyROxVmn59bGiUYFx+zzZGAM=', 'page_age': None, 'title': 'San Diego, CA Current Weather - The Weather Network', 'type': 'web_search_result', 'url': 'https://www.theweathernetwork.com/en/city/us/california/san-diego/current'}, {'encrypted_content': 'Er0ECioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDFzjcggpxnt9AXQdWBoMSlt/4skpdfjITAsYIjCG3m58L+QQ4lPaSndcnAbcW+5Ykfk1xpZOJU57C5VHG1S207QgRJ4dcLkwEjnpndUqwANuKmyhPM37rEwgn2DB9WhYzvuq4zzoex3tvhf7Je6f5n7yLLBEPUrciK61s81SZQEf5v8d3nJ+c9rKuxbgDRWzqQukBiLPLYxde4I5sBJH2v9dft2UAn6FVqreS7IWWwXZIB8mwTsjYBz7ELNU2c4LUsMl2l3TNJ/4kA+iRal9LK4lcrCvw4JoOBNVWqcMwjMczMec4xH97XSawNqkL/1u1m1W0HMLlzbzgaMxe80Ue6A88wQqb+68AfqL4QS3c/Ejq9XO92CSS2aHylY5EUS4v8bJTORnYz6nY1C6l2wB1JfwmQ+mhd5FPDgHVZMUAqIe3ZoJjXkNw1bEaoXHgAuiydSrdWTqHaLbHBD/LwsrN2JC+iB5asNnvxJlvJlj0o9ZJ0oGezQXwvnxhZWp2eYbJrQkj2WF6JDJOiGNCewvJIVF6OtBofKoe2Yjh7ym2MEM5BpXbutIjQQeYx+UGMWmB+GbNZObZ7scmoFRZSCTze1BAZ4M82Q+CO4h2asPLiXsw1ifn9OD5ScrctJuxmXogps9QuKy3cqFw1Uwzq19g+BsEXPwa+BtbAZHEhiDg+23uCJ/eTIECwA4hbrC9qZzGAM=', 'page_age': None, 'title': 'San Diego weather forecast – NBC 7 San Diego', 'type': 'web_search_result', 'url': 'https://www.nbcsandiego.com/weather/'}, {'encrypted_content': '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', 'page_age': None, 'title': 'San Diego, CA Weather Forecast | AccuWeather', 'type': 'web_search_result', 'url': 'https://www.accuweather.com/en/us/san-diego/92101/weather-forecast/347628'}, {'encrypted_content': 'Et0BCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDE2ikBXCRuRYsLmPwxoM5pZqhgt0Mncy3UtoIjAMrwYPb/NDmM7yWplKTjwKyPV40E7jf78FQU7K8k0H/HigHgkN9dbXo+c0Qadh190qYStZ+5nq1gHBH6iJjuHUpl7npb/xlb8OIs9PZycRPm/aeK3bUbB3dk0dWO9RwC22EIrIEOpGLf+3Ii06Fl72tzj6CeVW4REx5f8Pro4tAXnY+0RE+ne0Xjcqfwv4igCvH8AYAw==', 'page_age': None, 'title': 'Weather for San Diego, California, USA', 'type': 'web_search_result', 'url': 'https://www.timeanddate.com/weather/usa/san-diego'}, {'encrypted_content': 'EvADCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDAZgTr8PTtP8brVUBRoMnW3bwhJEk5q6Y9TJIjBDdU6FKOHvZzMpJIT7MBuEr7oF9tma7lsbdyR7cJZxTWZdAxoDKu7BPAmGloKZ7xsq8wLlh6d9Qbgb+ZY+zNMO5vMY4TGNQgWCKGvLPGfSZUHWTjUgkaw8ZWU2z3F+4JXBrZJexw4E25U+dPFBsJEAPTDHDvELH6YfnYUg2tezf4sh+UDwqAvPyhSDXIJKb072ApeLy9eo5vl04TosusUTMnq0nDlhk124Ck9ftd1SLmA9IwZu0BYkz1+n+DOpCQ9C2OmfuFadnxRDyztpWSJUI+TSU6TnM+1CDiRhFHBiGN6ap6Qwx+jhysJC8nFaXE+8zFlVtFZ41dRBQ/kg3h+9Vd88zOdHzQUY9GmBFpxrUEsf0JGH5+WfVRWqrmSah6Td8nfimB4Bc1suvBBOMn7d8xCqXuKVfkRfecv6ycO/cdte5d/cm2/VSmYt0/2DUmgucQAutRB0PlaSzx/3W4oFmvh7xaDb2FzWiyPKNbqLEwIW8RSVtZDwrp3McjuGWymA74X+UKWZcD+hNT9w/FcSf2a7frPUcXQQatGvIMf6gkS1wSl2bRgD', 'page_age': None, 'title': 'San Diego, CA Weather Today & Tomorrow - Local Forecast & Live Weather Radar | WeatherBug', 'type': 'web_search_result', 'url': 'https://www.weatherbug.com/weather-forecast/now/san-diego-ca-92123'}, {'encrypted_content': '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', 'page_age': None, 'title': 'San Diego, CA 10-Day Weather Forecast | Weather Underground', 'type': 'web_search_result', 'url': 'https://www.wunderground.com/forecast/us/ca/san-diego'}], 'tool_use_id': 'srvtoolu_014w2tib6HtQ1d761AGDBfq1', 'type': 'web_search_tool_result'}, {'citations': None, 'text': \"Here's the current weather in **San Diego, CA**:\\n\\n- 🌤️ **Conditions:** \", 'type': 'text'}, {'citations': [{'cited_text': 'Mostly Sunny today with a high of 68°F and a low of 46°F.', 'encrypted_index': 'Eo8BCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDNiEmb9gd9/xTRlTWhoM9muGyPUHv9j2UwZ1IjDIqSu5x8pSmbTmkjp4xYqUHHdTEJv7aRFzwwNmdb3LxJoE07yy9iJ6BvR/UNnL1aUqE0WwCvypXUyqsxjMQwiTzWNaokEYBA==', 'title': 'San Diego, CA Weather Forecast, Conditions, and Maps – Yahoo Weather', 'type': 'web_search_result_location', 'url': 'https://weather.yahoo.com/us/ca/san-diego/'}], 'text': 'Mostly Sunny with a high of **68°F** and a low of **46°F**.', 'type': 'text'}, {'citations': None, 'text': '\\n- 💨 **Wind:** ', 'type': 'text'}, {'citations': [{'cited_text': 'Winds NW at 5 to 10 mph. ', 'encrypted_index': 'Eo8BCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDJT3KAwtk2NZbIlYphoMeH0IVHhFpaImOxMPIjCeAuYeWrgKNNI+QB0J42aBmo6mjhNVgguB0rBdvXLZNfLQkfhRL8cP7cB7WHKJpncqE/qNrzKwhb6RTg5fz0912/5C4joYBA==', 'title': 'San Diego, CA Weather Conditions | Weather Underground', 'type': 'web_search_result_location', 'url': 'https://www.wunderground.com/weather/us/ca/san-diego'}], 'text': 'NW at 5 to 10 mph.', 'type': 'text'}, {'citations': None, 'text': '\\n- 💧 **Humidity:** ', 'type': 'text'}, {'citations': [{'cited_text': 'Current Station · Personal Weather ... Top Video Stories · Additional Conditions · Pressure · 30.14 °in · Visibility · 10 °miles · Clouds · Partly Clo...', 'encrypted_index': 'EpABCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDApQTVRkddtiZrtbkBoMhLGl8RAiKuiISz5PIjD+7E3sapaCAbF4bwFfSDPCdIRoFzw2oQaaxPUiCvVDJ9hiDBJUx3drEcX7udXjQ9sqFIH+Xdii6HiHXYU56RN7QqnjipDZGAQ=', 'title': 'San Diego, CA 10-Day Weather Forecast | Weather Underground', 'type': 'web_search_result_location', 'url': 'https://www.wunderground.com/forecast/us/ca/san-diego'}], 'text': '50%, with a dew point of 44°F.', 'type': 'text'}, {'citations': None, 'text': '\\n- 👁️ **Visibility:** ', 'type': 'text'}, {'citations': [{'cited_text': 'Current Station · Personal Weather ... Top Video Stories · Additional Conditions · Pressure · 30.14 °in · Visibility · 10 °miles · Clouds · Partly Clo...', 'encrypted_index': 'EpABCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDCYl3fFFsFUxbekW/RoM6x4ZCOjM/3JvszIeIjDBaOi8wcwaHwpcJdU/ieWVSVq38gS9Lgszop1xPDtPp8fpk29xJ6E2EU3Tw7WdO2YqFHQ78WFpuami9fhalJ9g00QPID/WGAQ=', 'title': 'San Diego, CA 10-Day Weather Forecast | Weather Underground', 'type': 'web_search_result_location', 'url': 'https://www.wunderground.com/forecast/us/ca/san-diego'}], 'text': '10 miles.', 'type': 'text'}, {'citations': None, 'text': '\\n- 🌡️ **Temperature Trend:** ', 'type': 'text'}, {'citations': [{'cited_text': 'High Temperatures Today · Increasing temperatures through late week · High temperatures this afternoon will reach into the mid-70s for inland areas, a...', 'encrypted_index': 'EpEBCioIDRgCIiQ4ODk4YTFkYy0yMTNkLTRhNmYtOTljYi03ZTBlNTUzZDc0NWISDIbuCU2l8X4t8am9QRoMEf99GPK5Tmfm872XIjBGKpSBhJIrNs+LmtXKEuwBl+0HCjWSYTyGwKhD7nO1RCS/uLW7olmoBZNXoJjmobcqFZgYotD2Rwsp3PoWwvyQ/qgR9G+DFRgE', 'title': 'San Diego, CA', 'type': 'web_search_result_location', 'url': 'https://www.weather.gov/sgx'}], 'text': 'Temperatures are increasing through late week, with highs reaching into the mid-70s for inland areas — a few degrees warmer than yesterday.', 'type': 'text'}, {'citations': None, 'text': \"\\n\\nOverall, it's a pleasant late-February day in San Diego!\", 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 9209, 'output_tokens': 310, 'server_tool_use': {'web_fetch_requests': 0, 'web_search_requests': 1}, 'service_tier': 'standard'}\n\n\n\n\nThe search_conf() function creates the necessary configuration for the web search tool. You can customize it with several parameters:\nsearch_conf(\n    max_uses=None,               # Maximum number of searches Claude can perform\n    allowed_domains=None,        # List of domains to search within (e.g., ['wikipedia.org'])\n    blocked_domains=None,        # List of domains to exclude (e.g., ['twitter.com'])\n    user_location=None           # Location context for search\n)\nWhen Claude uses the web search tool, the response includes citations linking to the source information. Claudette automatically formats these citations and provides them as footnotes in the response.\nWeb search usage is tracked separately from normal token usage in the usage statistics:\n\nchat.use\n\nIn: 9209; Out: 310; Cache create: 0; Cache read: 0; Total Tokens: 9519; Search: 1; Fetch: 0\n\n\nWeb search requests have their own pricing. As of May 2024, web searches cost $10 per 1,000 requests.",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#text-editor-tool",
    "href": "index.html#text-editor-tool",
    "title": "claudette",
    "section": "Text Editor Tool",
    "text": "Text Editor Tool\nClaudette provides support for Anthropic’s special Text Editor Tool, which allows Claude to view and modify files directly. Unlike regular function-calling tools, the text editor tool uses a predefined schema built into Claude’s model.\nImportant notes about the text editor tool:\n\nIt’s schema-less - you provide a configuration but not a schema\nIt uses type identifiers like “text_editor_20250124” specific to Claude models\nYou must implement a dispatcher function (in Claudette, it’s str_replace_based_edit_tool)\nDifferent commands route through this single dispatcher function\n\nThe text editor tool allows Claude to:\n\nView file or directory contents\nCreate new files\nInsert text at specific line numbers\nReplace text within files\n\n# Create a chat with the text editor tool\nchat = Chat(model, sp='Be concise in your responses.',\n            tools=[text_editor_conf['sonnet']], ns=mk_ns(str_replace_based_edit_tool))\n\n# Now Claude can explore files\nfor o in chat.toolloop('Please explain concisely what my _quarto.yml does. Use your tools, and explain before each usage what you are doing.'):\n    if not isinstance(o,dict): display(o)",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#other-model-providers",
    "href": "index.html#other-model-providers",
    "title": "claudette",
    "section": "Other model providers",
    "text": "Other model providers\nYou can also use 3rd party providers of Anthropic models, as shown here.\n\nAmazon Bedrock\nThese are the models available through Bedrock:\n\nmodels_aws\n\n['anthropic.claude-opus-4-1-20250805-v1:0',\n 'anthropic.claude-sonnet-4-20250514-v1:0',\n 'claude-3-5-haiku-20241022',\n 'claude-3-7-sonnet-20250219',\n 'anthropic.claude-3-opus-20240229-v1:0',\n 'anthropic.claude-3-5-sonnet-20241022-v2:0']\n\n\nTo use them, call AnthropicBedrock with your access details, and pass that to Client:\nfrom anthropic import AnthropicBedrock\n\nab = AnthropicBedrock(\n    aws_access_key=os.environ['AWS_ACCESS_KEY'],\n    aws_secret_key=os.environ['AWS_SECRET_KEY'],\n)\nclient = Client(models_aws[-1], ab)\n\nchat = Chat(cli=client)\nchat(\"I'm Jeremy\")\n\n\nGoogle Vertex\nThese are the models available through Vertex:\n\nmodels_goog\n\n['claude-opus-4-1@20250805',\n 'anthropic.claude-3-sonnet-20240229-v1:0',\n 'anthropic.claude-3-haiku-20240307-v1:0',\n 'claude-3-opus@20240229',\n 'claude-3-5-sonnet-v2@20241022',\n 'claude-3-sonnet@20240229',\n 'claude-3-haiku@20240307']\n\n\nTo use them, call AnthropicVertex with your access details, and pass that to Client:\nfrom anthropic import AnthropicVertex\nimport google.auth\n\nproject_id = google.auth.default()[1]\ngv = AnthropicVertex(project_id=project_id, region=\"us-east5\")\nclient = Client(models_goog[-1], gv)\n\nchat = Chat(cli=client)\nchat(\"I'm Jeremy\")",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#extensions",
    "href": "index.html#extensions",
    "title": "claudette",
    "section": "Extensions",
    "text": "Extensions\n\nPydantic Structured Ouput",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "index.html#footnotes",
    "href": "index.html#footnotes",
    "title": "claudette",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nhttps://weather.yahoo.com/us/ca/san-diego/ “Mostly Sunny today with a high of 68°F and a low of 46°F.”↩︎\nhttps://www.wunderground.com/weather/us/ca/san-diego “Winds NW at 5 to 10 mph.”↩︎\nhttps://www.wunderground.com/forecast/us/ca/san-diego “Current Station · Personal Weather … Top Video Stories · Additional Conditions · Pressure · 30.14 °in · Visibility · 10 °miles · Clouds · Partly Clo…”↩︎\nhttps://www.wunderground.com/forecast/us/ca/san-diego “Current Station · Personal Weather … Top Video Stories · Additional Conditions · Pressure · 30.14 °in · Visibility · 10 °miles · Clouds · Partly Clo…”↩︎\nhttps://www.weather.gov/sgx “High Temperatures Today · Increasing temperatures through late week · High temperatures this afternoon will reach into the mid-70s for inland areas, a…”↩︎",
    "crumbs": [
      "claudette"
    ]
  },
  {
    "objectID": "CHANGELOG.html",
    "href": "CHANGELOG.html",
    "title": "",
    "section": "",
    "text": "Code"
  },
  {
    "objectID": "CHANGELOG.html#section",
    "href": "CHANGELOG.html#section",
    "title": "",
    "section": "0.3.14",
    "text": "0.3.14\n\nNew Features\n\nAdd Claude 4.6 models, web_fetch support (#109)"
  },
  {
    "objectID": "CHANGELOG.html#section-1",
    "href": "CHANGELOG.html#section-1",
    "title": "",
    "section": "0.3.13",
    "text": "0.3.13\n\nBugs Squashed\n\nUse r.model_dump(exclude_none=True) (#104)"
  },
  {
    "objectID": "CHANGELOG.html#section-2",
    "href": "CHANGELOG.html#section-2",
    "title": "",
    "section": "0.3.12",
    "text": "0.3.12\n\nBugs Squashed\n\nFix blks2cited_txt crash for document-based citations (#101), thanks to @erikgaas"
  },
  {
    "objectID": "CHANGELOG.html#section-3",
    "href": "CHANGELOG.html#section-3",
    "title": "",
    "section": "0.3.11",
    "text": "0.3.11\n\nNew Features\n\nValidate tool names returned by model against allowed tools (#103), thanks to @PiotrCzapla"
  },
  {
    "objectID": "CHANGELOG.html#section-4",
    "href": "CHANGELOG.html#section-4",
    "title": "",
    "section": "0.3.10",
    "text": "0.3.10\n\nBugs Squashed\n\nfind_blocks does not handle dicts (#96)"
  },
  {
    "objectID": "CHANGELOG.html#section-5",
    "href": "CHANGELOG.html#section-5",
    "title": "",
    "section": "0.3.7",
    "text": "0.3.7\n\nNew Features\n\nAdd Haiku and Sonnet 4.5 (#95)"
  },
  {
    "objectID": "CHANGELOG.html#section-6",
    "href": "CHANGELOG.html#section-6",
    "title": "",
    "section": "0.3.6",
    "text": "0.3.6\n\nNew Features\n\nSupport opus 4.1 (#93)"
  },
  {
    "objectID": "CHANGELOG.html#section-7",
    "href": "CHANGELOG.html#section-7",
    "title": "",
    "section": "0.3.5",
    "text": "0.3.5\n\nNew Features\n\nSupport async functions in async toolloop (#92)"
  },
  {
    "objectID": "CHANGELOG.html#section-8",
    "href": "CHANGELOG.html#section-8",
    "title": "",
    "section": "0.3.4",
    "text": "0.3.4\n\nBugs Squashed\n\nEscape Quotes in markdown footnotes (#90), thanks to @ncoop57"
  },
  {
    "objectID": "CHANGELOG.html#section-9",
    "href": "CHANGELOG.html#section-9",
    "title": "",
    "section": "0.3.2",
    "text": "0.3.2\n\nNew Features\n\nSuport for tool functions returning ToolResult image values (#88), thanks to @austinvhuang"
  },
  {
    "objectID": "CHANGELOG.html#section-10",
    "href": "CHANGELOG.html#section-10",
    "title": "",
    "section": "0.3.1",
    "text": "0.3.1\n\nNew Features\n\nUse msglm 0.0.9 (#87)"
  },
  {
    "objectID": "CHANGELOG.html#section-11",
    "href": "CHANGELOG.html#section-11",
    "title": "",
    "section": "0.3.0",
    "text": "0.3.0\n\nBreaking Changes\n\nRemove obj support (#85)"
  },
  {
    "objectID": "CHANGELOG.html#section-12",
    "href": "CHANGELOG.html#section-12",
    "title": "",
    "section": "0.2.2",
    "text": "0.2.2\n\nNew Features\n\nMake full messages available after streaming (#84)"
  },
  {
    "objectID": "CHANGELOG.html#section-13",
    "href": "CHANGELOG.html#section-13",
    "title": "",
    "section": "0.2.0",
    "text": "0.2.0\n\nBreaking Changes\n\ntoolloop now returns an iterator of every message, including each tool request and result\n\n\n\nNew Features\n\nAdd tool call results to toolloop result (#83)\nshow_thk param for contents (#82)"
  },
  {
    "objectID": "CHANGELOG.html#section-14",
    "href": "CHANGELOG.html#section-14",
    "title": "",
    "section": "0.1.11",
    "text": "0.1.11\n\nNew Features\n\nUse updated text editor tool (#80)\nSkip hidden directories in view()"
  },
  {
    "objectID": "CHANGELOG.html#section-15",
    "href": "CHANGELOG.html#section-15",
    "title": "",
    "section": "0.1.10",
    "text": "0.1.10\n\nNew Features\n\nSupport Claude 4 (#79)"
  },
  {
    "objectID": "CHANGELOG.html#section-16",
    "href": "CHANGELOG.html#section-16",
    "title": "",
    "section": "0.1.9",
    "text": "0.1.9\n\nNew Features\n\nTool loop now continues when function calls return an error (#78), thanks to @erikgaas\nfeat: add text editor tool implementation (#71), thanks to @ncoop57"
  },
  {
    "objectID": "CHANGELOG.html#section-17",
    "href": "CHANGELOG.html#section-17",
    "title": "",
    "section": "0.1.8",
    "text": "0.1.8\n\nNew Features\n\nAdd exhausted tool loop warning (#75)\nText editor tool implementation (#71), thanks to @ncoop57\nAsync tool loop (#70)\nPre-serialized funcs in tool calling (#67), thanks to @erikgaas\nExtended Thinking (#66)"
  },
  {
    "objectID": "CHANGELOG.html#section-18",
    "href": "CHANGELOG.html#section-18",
    "title": "",
    "section": "0.1.7",
    "text": "0.1.7\n\nBugs Squashed\n\nBump required msglm version"
  },
  {
    "objectID": "CHANGELOG.html#section-19",
    "href": "CHANGELOG.html#section-19",
    "title": "",
    "section": "0.1.6",
    "text": "0.1.6\n\nBugs Squashed\n\nBump required anthropic version"
  },
  {
    "objectID": "CHANGELOG.html#section-20",
    "href": "CHANGELOG.html#section-20",
    "title": "",
    "section": "0.1.5",
    "text": "0.1.5\n\nNew Features\n\nadd extended thinking (#65), thanks to @comhar\nMake Sonnet 3.7 the default sonnet model (#63)\nAdd model capabilities attributes has_streaming_models, has_temperature_models, and has_system_prompt_models (#57), thanks to @austinvhuang\n\n\n\nBugs Squashed\n\nfix bedrock usage reporting (#60), thanks to @hamelsmu"
  },
  {
    "objectID": "CHANGELOG.html#section-21",
    "href": "CHANGELOG.html#section-21",
    "title": "",
    "section": "0.1.3",
    "text": "0.1.3\n\nNew Features\n\nadd caching to async client too (#55), thanks to @bclavie"
  },
  {
    "objectID": "CHANGELOG.html#section-22",
    "href": "CHANGELOG.html#section-22",
    "title": "",
    "section": "0.1.2",
    "text": "0.1.2\n\nNew Features\n\nAdd continuously-updated cache support to Chat and Client (#54), thanks to @bclavie\nEnhance AsyncChat with improved tool support and message handling (#52), thanks to @ncoop57\nAdd support for user defined types in tool calling functions (#51), thanks to @austinvhuang\nAdd detailed cost breakdown and improve content handling (#49), thanks to @ncoop57"
  },
  {
    "objectID": "CHANGELOG.html#section-23",
    "href": "CHANGELOG.html#section-23",
    "title": "",
    "section": "0.1.1",
    "text": "0.1.1\n\nNew Features\n\nadd structured to async (#48), thanks to @hamelsmu\nadd msglm (#46), thanks to @comhar\nAdd support for new Claude 3.5 Haiku model (#44), thanks to @ncoop57\ntrace history instead of chat response in toolloop (#39), thanks to @comhar"
  },
  {
    "objectID": "CHANGELOG.html#section-24",
    "href": "CHANGELOG.html#section-24",
    "title": "",
    "section": "0.1.0",
    "text": "0.1.0\n\nBreaking Changes\n\ntool_choice is no longer a Chat instance variable; instead it is a parameter to Chat.__call__\n\n\n\nNew Features\n\nAdd temp param to Chat (#38)\n\n\n\nBugs Squashed\n\npr included but not used (#37)\nfix tool use bug (#35), thanks to @comhar"
  },
  {
    "objectID": "CHANGELOG.html#section-25",
    "href": "CHANGELOG.html#section-25",
    "title": "",
    "section": "0.0.10",
    "text": "0.0.10\n\nNew Features\n\nAdd Client.structured (#32)\nUse dict2obj (#30)\nStore tool call result without stringifying (#29)"
  },
  {
    "objectID": "CHANGELOG.html#section-26",
    "href": "CHANGELOG.html#section-26",
    "title": "",
    "section": "0.0.9",
    "text": "0.0.9\n\nNew Features\n\nAsync support (#21)"
  },
  {
    "objectID": "CHANGELOG.html#section-27",
    "href": "CHANGELOG.html#section-27",
    "title": "",
    "section": "0.0.7",
    "text": "0.0.7\n\nNew Features\n\nPrompt caching (#20)\nadd markdown to doc output (#19)\nSupport vscode details tags (#18)\nAdd a cont_pr param to Chat as a “default” prompt #15), thanks to @tom-pollak\n\n\n\nBugs Squashed\n\nExplicit tool_choice causes chat() to call tool twice. (#11)"
  },
  {
    "objectID": "CHANGELOG.html#section-28",
    "href": "CHANGELOG.html#section-28",
    "title": "",
    "section": "0.0.6",
    "text": "0.0.6\n\nNew Features\n\nDefault chat prompt & function calling refactor (#15), thanks to @tom-pollak"
  },
  {
    "objectID": "CHANGELOG.html#section-29",
    "href": "CHANGELOG.html#section-29",
    "title": "",
    "section": "0.0.5",
    "text": "0.0.5\n\nNew Features\n\nBetter support for stop sequences (#12), thanks to @xl0"
  },
  {
    "objectID": "CHANGELOG.html#section-30",
    "href": "CHANGELOG.html#section-30",
    "title": "",
    "section": "0.0.3",
    "text": "0.0.3\n\nNew Features\n\nAmazon Bedrock and Google Vertex support (#7)\n\n\n\nBug Fixes\n\nUpdate model paths for non-beta tool use (#2), thanks to @sarahpannn"
  },
  {
    "objectID": "CHANGELOG.html#section-31",
    "href": "CHANGELOG.html#section-31",
    "title": "",
    "section": "0.0.1",
    "text": "0.0.1\n\nInitial release"
  },
  {
    "objectID": "async.html",
    "href": "async.html",
    "title": "The async version",
    "section": "",
    "text": "from cachy import enable_cachy\n\n\nenable_cachy()\n\n\nfrom IPython.display import display,Image",
    "crumbs": [
      "The async version"
    ]
  },
  {
    "objectID": "async.html#setup",
    "href": "async.html#setup",
    "title": "The async version",
    "section": "",
    "text": "from cachy import enable_cachy\n\n\nenable_cachy()\n\n\nfrom IPython.display import display,Image",
    "crumbs": [
      "The async version"
    ]
  },
  {
    "objectID": "async.html#async-sdk",
    "href": "async.html#async-sdk",
    "title": "The async version",
    "section": "Async SDK",
    "text": "Async SDK\n\nmodel = models[1]\ncli = AsyncAnthropic()\n\n\nprompt = \"I'm Jeremy\"\nm = mk_msg(prompt)\nr = await cli.messages.create(messages=[m], model=model, max_tokens=100)\nr\n\nHi Jeremy! Nice to meet you. How can I help you today?\n\n\nid: msg_01Q3123HGtAxWnUraLL65H24\ncontainer: None\ncontent: [{'citations': None, 'text': 'Hi Jeremy! Nice to meet you. How can I help you today?', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 10, 'output_tokens': 18, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nmsgs = mk_msgs([prompt, r, \"I forgot my name. Can you remind me please?\"]) \nmsgs\n\n[{'role': 'user', 'content': \"I'm Jeremy\"},\n {'role': 'assistant',\n  'content': [TextBlock(citations=None, text='Hi Jeremy! Nice to meet you. How can I help you today?', type='text')]},\n {'role': 'user', 'content': 'I forgot my name. Can you remind me please?'}]\n\n\n\nawait cli.messages.create(messages=msgs, model=model, max_tokens=200)\n\nYour name is Jeremy! You told me that at the start of our conversation. 😊\n\n\nid: msg_01QTvdUwQAyKRQT3H73STdU3\ncontainer: None\ncontent: [{'citations': None, 'text': 'Your name is Jeremy! You told me that at the start of our conversation. 😊', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 42, 'output_tokens': 22, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nsource\n\nAsyncClient\n\ndef AsyncClient(\n    model, cli:NoneType=None, log:bool=False, cache:bool=False\n):\n\nAsync Anthropic messages client.\n\n\nExported source\nclass AsyncClient(Client):\n    def __init__(self, model, cli=None, log=False, cache=False):\n        \"Async Anthropic messages client.\"\n        super().__init__(model,cli,log,cache)\n        if not cli: self.c = AsyncAnthropic(default_headers={'anthropic-beta': 'prompt-caching-2024-07-31'})\n\n\n\nc = AsyncClient(model)\n\n\nc._r(r)\nc.use\n\nIn: 10; Out: 18; Cache create: 0; Cache read: 0; Total Tokens: 28; Search: 0; Fetch: 0\n\n\n\nsource\n\n\nAsyncClient.__call__\n\ndef __call__(\n    msgs:list, # List of messages in the dialog\n    sp:str='', # The system prompt\n    temp:int=0, # Temperature\n    maxtok:int=4096, # Maximum tokens\n    maxthinktok:int=0, # Maximum thinking tokens\n    prefill:str='', # Optional prefill to pass to Claude as start of its response\n    stream:bool=False, # Stream response?\n    stop:NoneType=None, # Stop sequence\n    tools:Optional=None, # List of tools to make available to Claude\n    tool_choice:Optional=None, # Optionally force use of some tool\n    cb:NoneType=None, # Callback to pass result to when complete\n    cli:NoneType=None, log:bool=False, cache:bool=False\n):\n\nMake an async call to Claude.\n\n\nExported source\n@asave_iter\nasync def _astream(o, cm, prefill, cb):\n    async with cm as s:\n        yield prefill\n        async for x in s.text_stream: yield x\n        o.value = await s.get_final_message()\n        await cb(o.value)\n\n\n\n\nExported source\n@patch\n@delegates(Client)\nasync def __call__(self:AsyncClient,\n             msgs:list, # List of messages in the dialog\n             sp='', # The system prompt\n             temp=0, # Temperature\n             maxtok=4096, # Maximum tokens\n             maxthinktok=0, # Maximum thinking tokens\n             prefill='', # Optional prefill to pass to Claude as start of its response\n             stream:bool=False, # Stream response?\n             stop=None, # Stop sequence\n             tools:Optional[list]=None, # List of tools to make available to Claude\n             tool_choice:Optional[dict]=None, # Optionally force use of some tool\n             cb=None, # Callback to pass result to when complete\n             **kwargs):\n    \"Make an async call to Claude.\"\n    msgs,kwargs = self._precall(msgs, prefill, sp, temp, maxtok, maxthinktok, stream,\n                                stop, tools, tool_choice, kwargs)\n    m = self.c.messages\n    f = m.stream if stream else m.create\n    res = f(model=self.model, messages=msgs, **kwargs)\n    async def _cb(v):\n        self._log(v, prefill=prefill, msgs=msgs, **kwargs)\n        if cb: await cb(v)\n    if stream: return _astream(res, prefill, _cb)\n    res = await res\n    try: return res\n    finally: await _cb(res)\n\n\n\nc = AsyncClient(model, log=True)\nc.use\n\nIn: 0; Out: 0; Cache create: 0; Cache read: 0; Total Tokens: 0; Search: 0; Fetch: 0\n\n\n\nc.model = models[1]\nawait c('Hi')\n\nHi there! How are you doing? Is there something I can help you with today? 😊\n\n\nid: msg_01NSbD7ZmQJKeY16gJ6apjAH\ncontainer: None\ncontent: [{'citations': None, 'text': 'Hi there! How are you doing? Is there something I can help you with today? 😊', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 8, 'output_tokens': 24, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nc.use\n\nIn: 8; Out: 24; Cache create: 0; Cache read: 0; Total Tokens: 32; Search: 0; Fetch: 0\n\n\n\ndef sums(\n    a:int,  # First thing to sum\n    b:int=1 # Second thing to sum\n) -&gt; int: # The sum of the inputs\n    \"Adds a + b.\"\n    print(f\"Finding the sum of {a} and {b}\")\n    return a + b\n\n\na,b = 604542,6458932\npr = f\"What is {a}+{b}?\"\nsp = \"You are a summing expert.\"\n\n\ntools=[sums]\nchoice = mk_tool_choice('sums')\nchoice\n\n{'type': 'tool', 'name': 'sums'}\n\n\n\nmsgs = mk_msgs(pr)\nr = await c(msgs, sp=sp, tools=tools, tool_choice=choice)\nr\n\n[ToolUseBlock(id=‘toolu_016CNnqECCx2AcanFfQAR6Dz’, caller=DirectCaller(type=‘direct’), input={‘a’: 604542, ‘b’: 6458932}, name=‘sums’, type=‘tool_use’)]\n\n\nid: msg_013mLdHfZhRGsihW3NxusZWB\ncontainer: None\ncontent: [{'id': 'toolu_016CNnqECCx2AcanFfQAR6Dz', 'caller': {'type': 'direct'}, 'input': {'a': 604542, 'b': 6458932}, 'name': 'sums', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 719, 'output_tokens': 57, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nsource\n\n\nmk_funcres_async\n\ndef mk_funcres_async(\n    fc, ns\n):\n\nGiven tool use block fc, get tool result, and create a tool_result response.\n\nsource\n\n\nmk_toolres_async\n\ndef mk_toolres_async(\n    r:Mapping, # Tool use request response from Claude\n    ns:Optional=None, # Namespace to search for tools\n):\n\nCreate a tool_result message from response r.\n\ntr = await mk_toolres_async(r, ns=globals())\ntr\n\nFinding the sum of 604542 and 6458932\n\n\n[{'role': 'assistant',\n  'content': [{'id': 'toolu_016CNnqECCx2AcanFfQAR6Dz',\n    'caller': {'type': 'direct'},\n    'input': {'a': 604542, 'b': 6458932},\n    'name': 'sums',\n    'type': 'tool_use'}]},\n {'role': 'user',\n  'content': [{'type': 'tool_result',\n    'tool_use_id': 'toolu_016CNnqECCx2AcanFfQAR6Dz',\n    'content': '7063474'}]}]\n\n\n\nmsgs += tr\nr = contents(await c(msgs, sp=sp, tools=sums))\nr\n\n'The result of **604,542 + 6,458,932 = 7,063,474**!'",
    "crumbs": [
      "The async version"
    ]
  },
  {
    "objectID": "async.html#structured-output",
    "href": "async.html#structured-output",
    "title": "The async version",
    "section": "Structured Output",
    "text": "Structured Output\n\nsource\n\nAsyncClient.structured\n\ndef structured(\n    msgs:list, # List of messages in the dialog\n    tools:Optional=None, # List of tools to make available to Claude\n    ns:Optional=None, # Namespace to search for tools\n    sp:str='', # The system prompt\n    temp:int=0, # Temperature\n    maxtok:int=4096, # Maximum tokens\n    maxthinktok:int=0, # Maximum thinking tokens\n    prefill:str='', # Optional prefill to pass to Claude as start of its response\n    stream:bool=False, # Stream response?\n    stop:NoneType=None, # Stop sequence\n    tool_choice:Optional=None, # Optionally force use of some tool\n    cb:NoneType=None, # Callback to pass result to when complete\n    cache_control:Optional[CacheControlEphemeralParam] | Omit=&lt;anthropic.Omit object at 0x7ffa654a49b0&gt;,\n    container:Optional[str] | Omit=&lt;anthropic.Omit object at 0x7ffa654a49b0&gt;,\n    inference_geo:Optional[str] | Omit=&lt;anthropic.Omit object at 0x7ffa654a49b0&gt;,\n    metadata:MetadataParam | Omit=&lt;anthropic.Omit object at 0x7ffa654a49b0&gt;,\n    output_config:OutputConfigParam | Omit=&lt;anthropic.Omit object at 0x7ffa654a49b0&gt;,\n    service_tier:Literal['auto', 'standard_only'] | Omit=&lt;anthropic.Omit object at 0x7ffa654a49b0&gt;,\n    stop_sequences:SequenceNotStr[str] | Omit=&lt;anthropic.Omit object at 0x7ffa654a49b0&gt;,\n    system:Union[str, Iterable[TextBlockParam]] | Omit=&lt;anthropic.Omit object at 0x7ffa654a49b0&gt;,\n    temperature:float | Omit=&lt;anthropic.Omit object at 0x7ffa654a49b0&gt;,\n    thinking:ThinkingConfigParam | Omit=&lt;anthropic.Omit object at 0x7ffa654a49b0&gt;,\n    top_k:int | Omit=&lt;anthropic.Omit object at 0x7ffa654a49b0&gt;,\n    top_p:float | Omit=&lt;anthropic.Omit object at 0x7ffa654a49b0&gt;,\n    extra_headers:Headers | None=None, # Use the following arguments if you need to pass additional parameters to the API that aren't available via kwargs.\nThe extra values given here take precedence over values defined on the client or passed to this method.\n    extra_query:Query | None=None, extra_body:Body | None=None,\n    timeout:float | httpx.Timeout | None | NotGiven=NOT_GIVEN\n):\n\nReturn the value of all tool calls (generally used for structured outputs)\n\nawait c.structured(pr, sums)\n\nFinding the sum of 604542 and 6458932\n\n\n[7063474]\n\n\n\nc\n\n[ToolUseBlock(id=‘toolu_01ENhz5EnfqZFT8PeizJ3gKr’, caller=DirectCaller(type=‘direct’), input={‘a’: 604542, ‘b’: 6458932}, name=‘sums’, type=‘tool_use’)]\n\n\n\nMetric\nCount\nCost (USD)\n\n\n\n\nInput tokens\n2,153\n0.006459\n\n\nOutput tokens\n166\n0.002490\n\n\nCache tokens\n0\n0.000000\n\n\nServer tool use\n0\n0.000000\n\n\nTotal\n2,319\n$0.008949",
    "crumbs": [
      "The async version"
    ]
  },
  {
    "objectID": "async.html#asyncchat",
    "href": "async.html#asyncchat",
    "title": "The async version",
    "section": "AsyncChat",
    "text": "AsyncChat\n\nsource\n\nAsyncChat\n\ndef AsyncChat(\n    model:Optional=None, # Model to use (leave empty if passing `cli`)\n    cli:Optional=None, # Client to use (leave empty if passing `model`)\n    sp:str='', # Optional system prompt\n    tools:Optional=None, # List of tools to make available to Claude\n    temp:int=0, # Temperature\n    cont_pr:Optional=None, # User prompt to continue an assistant response\n    cache:bool=False, # Use Claude cache?\n    hist:list=None, # Initialize history\n    ns:Optional=None, # Namespace to search for tools\n):\n\nAnthropic async chat client.\n\n\nExported source\n@delegates()\nclass AsyncChat(Chat):\n    def __init__(self,\n                 model:Optional[str]=None, # Model to use (leave empty if passing `cli`)\n                 cli:Optional[Client]=None, # Client to use (leave empty if passing `model`)\n                 **kwargs):\n        \"Anthropic async chat client.\"\n        super().__init__(model, cli, **kwargs)\n        if not cli: self.c = AsyncClient(model)\n\n\n\nsp = \"Always use tools if available, and calculations are requested.\"\nchat = AsyncChat(model, sp=sp)\nchat.c.use, chat.h\n\n(In: 0; Out: 0; Cache create: 0; Cache read: 0; Total Tokens: 0; Search: 0; Fetch: 0,\n [])\n\n\n\nsource\n\n\nAsyncChat.__call__\n\ndef __call__(\n    pr:NoneType=None, # Prompt / message\n    temp:NoneType=None, # Temperature\n    maxtok:int=4096, # Maximum tokens\n    maxthinktok:int=0, # Maximum thinking tokens\n    stream:bool=False, # Stream response?\n    prefill:str='', # Optional prefill to pass to Claude as start of its response\n    tool_choice:Union=None, # Optionally force use of some tool\n    kw:VAR_KEYWORD\n):\n\nCall self as a function.\n\n\nExported source\n@patch\nasync def _append_pr(self:AsyncChat, pr=None):\n    prev_role = nested_idx(self.h, -1, 'role') if self.h else 'assistant' # First message should be 'user' if no history\n    if pr and prev_role == 'user': await self()\n    self._post_pr(pr, prev_role)\n\n\n\n\nExported source\n@patch\nasync def __call__(self:AsyncChat,\n                   pr=None,  # Prompt / message\n                   temp=None, # Temperature\n                   maxtok=4096, # Maximum tokens\n                   maxthinktok=0, # Maximum thinking tokens\n                   stream=False, # Stream response?\n                   prefill='', # Optional prefill to pass to Claude as start of its response\n                   tool_choice:Optional[Union[str,bool,dict]]=None, # Optionally force use of some tool\n                   **kw):\n    if temp is None: temp=self.temp\n    await self._append_pr(pr)\n    async def _cb(v):\n        self.last = await mk_toolres_async(v, ns=limit_ns(self.ns, self.tools, tool_choice))\n        self.h += self.last\n    return await self.c(self.h, stream=stream, prefill=prefill, sp=self.sp, temp=temp, maxtok=maxtok, maxthinktok=maxthinktok, tools=self.tools, tool_choice=tool_choice, cb=_cb, **kw)\n\n\n\nawait chat(\"I'm Jeremy\")\nawait chat(\"What's my name?\")\n\nYour name is Jeremy! You told me at the start of our conversation. 😊\n\n\nid: msg_01VyEoh1pWoHVEKzCh5SeRWP\ncontainer: None\ncontent: [{'citations': None, 'text': 'Your name is Jeremy! You told me at the start of our conversation. 😊', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 48, 'output_tokens': 21, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat = AsyncChat(model, sp=sp)\nr = await chat(\"I'm Jeremy\", stream=True)\nasync for o in r: print(o, end='')\nr.value\n\nHi Jeremy! Nice to meet you. How can I help you today?\n\n\nHi Jeremy! Nice to meet you. How can I help you today?\n\n\nid: msg_01JbxS96JDjpS6GtjdyjbHKa\ncontainer: None\ncontent: [{'citations': None, 'text': 'Hi Jeremy! Nice to meet you. How can I help you today?', 'type': 'text', 'parsed_output': None}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 22, 'output_tokens': 18, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\npr = f\"What is {a}+{b}?\"\nchat = AsyncChat(model, sp=sp, tools=[sums])\nr = await chat(pr)\nr\n\nFinding the sum of 604542 and 6458932\n\n\nI’ll calculate the sum of 604542 and 6458932 right away!\n\n\nid: msg_01AjLTTKCzEr2PgYoqcQrpPy\ncontainer: None\ncontent: [{'citations': None, 'text': \"I'll calculate the sum of 604542 and 6458932 right away!\", 'type': 'text'}, {'id': 'toolu_01KhnEGLFGsYP9ePCfn6gf8b', 'caller': {'type': 'direct'}, 'input': {'a': 604542, 'b': 6458932}, 'name': 'sums', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 631, 'output_tokens': 92, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nawait chat()\n\nThe sum of 604,542 + 6,458,932 = 7,063,474!\n\n\nid: msg_01MzE8hrFtWfJ8fT3PsZ8s9b\ncontainer: None\ncontent: [{'citations': None, 'text': 'The sum of **604,542 + 6,458,932 = 7,063,474**!', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 738, 'output_tokens': 28, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nAsyncChat handles missing tools gracefully. When a tool is called but not found in the namespace, it returns an error message rather than crashing.\nIn this test, we intentionally empty the namespace (chat.ns={}) to simulate what would happen if Claude hallucinated a tool or if a tool was missing. The limit_ns function (used in the _cb callback) would normally filter out hallucinated tools, but here we’re testing the fallback behavior when tools aren’t available.\n\npr = f\"What is {a}+{b}?\"\nchat = AsyncChat(model, sp=sp, tools=[sums])\nchat.ns={}\nr = await chat(pr)\nr\n\nI’ll calculate the sum of 604542 and 6458932 right away!\n\n\nid: msg_01AjLTTKCzEr2PgYoqcQrpPy\ncontainer: None\ncontent: [{'citations': None, 'text': \"I'll calculate the sum of 604542 and 6458932 right away!\", 'type': 'text'}, {'id': 'toolu_01KhnEGLFGsYP9ePCfn6gf8b', 'caller': {'type': 'direct'}, 'input': {'a': 604542, 'b': 6458932}, 'name': 'sums', 'type': 'tool_use'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: tool_use\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 631, 'output_tokens': 92, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat.h\n\n[{'role': 'user', 'content': 'What is 604542+6458932?'},\n {'role': 'assistant',\n  'content': [{'text': \"I'll calculate the sum of 604542 and 6458932 right away!\",\n    'type': 'text'},\n   {'id': 'toolu_01KhnEGLFGsYP9ePCfn6gf8b',\n    'caller': {'type': 'direct'},\n    'input': {'a': 604542, 'b': 6458932},\n    'name': 'sums',\n    'type': 'tool_use'}]},\n {'role': 'user',\n  'content': [{'type': 'tool_result',\n    'tool_use_id': 'toolu_01KhnEGLFGsYP9ePCfn6gf8b',\n    'content': 'Error - tool not defined in the tool_schemas: sums'}]}]\n\n\n\nfn = Path('samples/puppy.jpg')\nimg = fn.read_bytes()\nImage(img)\n\n\n\n\n\n\n\n\n\nq = \"In brief, what color flowers are in this image?\"\nmsg = mk_msg([img, q])\nawait c([msg])\n\nThe flowers in the image are purple/lavender (blue-purple). They appear to be asters.\n\n\nid: msg_01DUds87tAj47fozgFfbEPrQ\ncontainer: None\ncontent: [{'citations': None, 'text': 'The flowers in the image are **purple/lavender** (blue-purple). They appear to be **asters**.', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 110, 'output_tokens': 28, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nAdd cache=True to automatically add to Claude’s KV cache.\n\nchat = AsyncChat(model, sp=sp, cache=True)\nawait chat(\"Lorem ipsum dolor sit amet\" * 150)\n\nIt looks like you’ve sent a large block of repeated “Lorem ipsum dolor sit amet” placeholder text.\nCould you clarify what you need? For example:\n\n❓ Do you have a question?\n📝 Do you need help with writing or editing?\n🛠️ Was this sent by mistake?\n\nI’m happy to help once I know what you’re looking for! 😊\n\n\nid: msg_01VhxH3pUWt1Z6ERyWFEpLvY\ncontainer: None\ncontent: [{'citations': None, 'text': 'It looks like you\\'ve sent a large block of repeated **\"Lorem ipsum dolor sit amet\"** placeholder text.\\n\\nCould you clarify what you need? For example:\\n\\n- ❓ Do you have a **question**?\\n- 📝 Do you need help with **writing or editing**?\\n- 🛠️ Was this sent **by mistake**?\\n\\nI\\'m happy to help once I know what you\\'re looking for! 😊', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 1067, 'output_tokens': 103, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat.use\n\nIn: 1067; Out: 103; Cache create: 0; Cache read: 0; Total Tokens: 1170; Search: 0; Fetch: 0\n\n\nIn this followup call, nearly all the tokens are cached, so the only the new additional tokens are charged at the full rate.\n\nawait chat(\"Whoops, sorry about that!\")\n\nNo worries at all! 😄 It happens!\nSo, what can I help you with today?\n\n\nid: msg_013Z7HrwVhkDCPEhnj3yNHor\ncontainer: None\ncontent: [{'citations': None, 'text': 'No worries at all! 😄 It happens! \\n\\nSo, what can I help you with today?', 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 1181, 'output_tokens': 28, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nchat.use\n\nIn: 2248; Out: 131; Cache create: 0; Cache read: 0; Total Tokens: 2379; Search: 0; Fetch: 0",
    "crumbs": [
      "The async version"
    ]
  },
  {
    "objectID": "async.html#extended-thinking",
    "href": "async.html#extended-thinking",
    "title": "The async version",
    "section": "Extended Thinking",
    "text": "Extended Thinking\nLet’s call the model without extended thinking enabled.\n\nchat = AsyncChat(model)\nawait chat(\"Write a sentence about Python!\")\n\nHere’s a sentence about Python:\nPython is a versatile, beginner-friendly programming language known for its clean, readable syntax and wide range of applications, from web development and data science to artificial intelligence and automation.\nWould you like to know more about Python? 🐍\n\n\nid: msg_0133ueaeXR2KvELPiPDnpFAC\ncontainer: None\ncontent: [{'citations': None, 'text': \"Here's a sentence about Python:\\n\\n**Python is a versatile, beginner-friendly programming language known for its clean, readable syntax and wide range of applications, from web development and data science to artificial intelligence and automation.**\\n\\nWould you like to know more about Python? 🐍\", 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 13, 'output_tokens': 63, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\nNow, let’s call the model with extended thinking enabled.\n\nr = await chat(\"Write a sentence about Python!\", maxthinktok=1024)\nr\n\nHere’s a sentence about Python:\nPython is one of the most popular programming languages in the world, loved by developers for its simplicity, powerful libraries, and ability to handle complex tasks with just a few lines of code.\nFun fact: Python was named after the British comedy group Monty Python, not the snake! 🐍😄\nWould you like to learn more about Python?\n\n\nThinking\n\nThe user wants another sentence about Python. Let me write a different one this time.\n\n\n\nid: msg_01Vuqd8xUwuB2tTnmcexcfFp\ncontainer: None\ncontent: [{'signature': 'Ev0BCkYICxgCKkAmUcWkc6z1j9s2pIRVL/EIaNbJYCaXR1stNeEAhQoCylzrssuUy2ZTq4vGWUl7WbH2AbV30H8aRazSNGwgnQp+Egzq7GmzjPUY/hkdH1oaDKbN8/A53z7nu/TenyIwIAhQomWRMzdCY7ueYlSChv7bcBIpnPT6Pf1gboh/KOlgAQIV0DRGX3r28/rVxj0KKmXdM/z1lMTxHXSMLE5PQkpDsNEavF0XqqGZlFXgd1Sg4mZSiaV3/9h9FTb2VWNtbpsvtztVbdvt4BbTnrO6YtNv5ehK0/7kaArbOwi61aQtZson8/+gmZgnox2vDieBHhpCc6t3ThgB', 'thinking': 'The user wants another sentence about Python. Let me write a different one this time.', 'type': 'thinking'}, {'citations': None, 'text': \"Here's a sentence about Python:\\n\\n**Python is one of the most popular programming languages in the world, loved by developers for its simplicity, powerful libraries, and ability to handle complex tasks with just a few lines of code.**\\n\\nFun fact: Python was named after the British comedy group **Monty Python**, not the snake! 🐍😄\\n\\nWould you like to learn more about Python?\", 'type': 'text'}]\nmodel: claude-sonnet-4-6\nrole: assistant\nstop_reason: end_turn\nstop_sequence: None\ntype: message\nusage: {'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 0}, 'cache_creation_input_tokens': 0, 'cache_read_input_tokens': 0, 'inference_geo': 'global', 'input_tokens': 114, 'output_tokens': 113, 'server_tool_use': None, 'service_tier': 'standard'}\n\n\n\n\n\nr.content\n\n[ThinkingBlock(signature='Ev0BCkYICxgCKkAmUcWkc6z1j9s2pIRVL/EIaNbJYCaXR1stNeEAhQoCylzrssuUy2ZTq4vGWUl7WbH2AbV30H8aRazSNGwgnQp+Egzq7GmzjPUY/hkdH1oaDKbN8/A53z7nu/TenyIwIAhQomWRMzdCY7ueYlSChv7bcBIpnPT6Pf1gboh/KOlgAQIV0DRGX3r28/rVxj0KKmXdM/z1lMTxHXSMLE5PQkpDsNEavF0XqqGZlFXgd1Sg4mZSiaV3/9h9FTb2VWNtbpsvtztVbdvt4BbTnrO6YtNv5ehK0/7kaArbOwi61aQtZson8/+gmZgnox2vDieBHhpCc6t3ThgB', thinking='The user wants another sentence about Python. Let me write a different one this time.', type='thinking'),\n TextBlock(citations=None, text=\"Here's a sentence about Python:\\n\\n**Python is one of the most popular programming languages in the world, loved by developers for its simplicity, powerful libraries, and ability to handle complex tasks with just a few lines of code.**\\n\\nFun fact: Python was named after the British comedy group **Monty Python**, not the snake! 🐍😄\\n\\nWould you like to learn more about Python?\", type='text')]",
    "crumbs": [
      "The async version"
    ]
  },
  {
    "objectID": "text_editor.html",
    "href": "text_editor.html",
    "title": "Text Editor",
    "section": "",
    "text": "from cachy import enable_cachy\n\n\nenable_cachy()\n\n\nif Path('test.txt').exists(): Path('test.txt').unlink()\n\n\nsource\n\nview\n\ndef view(\n    path:str, view_range:tuple=None, nums:bool=False\n):\n\nView directory or file contents with optional line range and numbers\n\n\nExported source\ndef view(path:str, view_range:tuple[int,int]=None, nums:bool=False):\n    'View directory or file contents with optional line range and numbers'\n    try:\n        p = Path(path).expanduser().resolve()\n        if not p.exists(): return f'Error: File not found: {p}'\n        if p.is_dir():\n            res = [str(f) for f in p.glob('**/*') \n                   if not any(part.startswith('.') for part in f.relative_to(p).parts)]\n            return f'Directory contents of {p}:\\n' + '\\n'.join(res)\n        \n        lines = p.read_text().splitlines()\n        s,e = 1,len(lines)\n        if view_range:\n            s,e = view_range\n            if not (1 &lt;= s &lt;= len(lines)): return f'Error: Invalid start line {s}'\n            if e != -1 and not (s &lt;= e &lt;= len(lines)): return f'Error: Invalid end line {e}'\n            lines = lines[s-1:None if e==-1 else e]\n            \n        return '\\n'.join([f'{i+s-1:6d} │ {l}' for i,l in enumerate(lines,1)] if nums else lines)\n    except Exception as e: return f'Error viewing file: {str(e)}'\n\n\n\nprint(view('_quarto.yml', (1,10), nums=True))\n\n     1 │ project:\n     2 │   type: website\n     3 │   resources: \n     4 │     - \"*.txt\"\n     5 │   preview:\n     6 │     port: 3000\n     7 │     browser: false\n     8 │ \n     9 │ format:\n    10 │   html:\n\n\n\nsource\n\n\ncreate\n\ndef create(\n    path:str, file_text:str, overwrite:bool=False\n)-&gt;str:\n\nCreates a new file with the given content at the specified path\n\n\nExported source\ndef create(path: str, file_text: str, overwrite:bool=False) -&gt; str:\n    'Creates a new file with the given content at the specified path'\n    try:\n        p = Path(path)\n        if p.exists():\n            if not overwrite: return f'Error: File already exists: {p}'\n        p.parent.mkdir(parents=True, exist_ok=True)\n        p.write_text(file_text)\n        return f'Created file {p} containing:\\n{file_text}'\n    except Exception as e: return f'Error creating file: {str(e)}'\n\n\n\nprint(create('test.txt', 'Hello, world!'))\nprint(view('test.txt', nums=True))\n\nCreated file test.txt containing:\nHello, world!\n     1 │ Hello, world!\n\n\n\nsource\n\n\ninsert\n\ndef insert(\n    path:str, insert_line:int, new_str:str\n)-&gt;str:\n\nInsert new_str at specified line number\n\n\nExported source\ndef insert(path: str, insert_line: int, new_str: str) -&gt; str:\n    'Insert new_str at specified line number'\n    try:\n        p = Path(path)\n        if not p.exists(): return f'Error: File not found: {p}'\n            \n        content = p.read_text().splitlines()\n        if not (0 &lt;= insert_line &lt;= len(content)): return f'Error: Invalid line number {insert_line}'\n            \n        content.insert(insert_line, new_str)\n        new_content = '\\n'.join(content)\n        p.write_text(new_content)\n        return f'Inserted text at line {insert_line} in {p}.\\nNew contents:\\n{new_content}'\n    except Exception as e: return f'Error inserting text: {str(e)}'\n\n\n\ninsert('test.txt', 0, 'Let\\'s add a new line')\nprint(view('test.txt', nums=True))\n\n     1 │ Let's add a new line\n     2 │ Hello, world!\n\n\n\nsource\n\n\nstr_replace\n\ndef str_replace(\n    path:str, old_str:str, new_str:str\n)-&gt;str:\n\nReplace first occurrence of old_str with new_str in file\n\n\nExported source\ndef str_replace(path: str, old_str: str, new_str: str) -&gt; str:\n    'Replace first occurrence of old_str with new_str in file'\n    try:\n        p = Path(path)\n        if not p.exists(): return f'Error: File not found: {p}'\n            \n        content = p.read_text()\n        count = content.count(old_str)\n        \n        if count == 0: return 'Error: Text not found in file'\n        if count &gt; 1: return f'Error: Multiple matches found ({count})'\n            \n        new_content = content.replace(old_str, new_str, 1)\n        p.write_text(new_content)\n        return f'Replaced text in {p}.\\nNew contents:\\n{new_content}'\n    except Exception as e: return f'Error replacing text: {str(e)}'\n\n\n\nstr_replace('test.txt', 'new line', '')\nprint(view('test.txt', nums=True))\n\n     1 │ Let's add a \n     2 │ Hello, world!\n\n\n\nsource\n\n\nstr_replace_based_edit_tool\n\ndef str_replace_based_edit_tool(\n    kwargs:dict\n)-&gt;str:\n\nDispatcher for Anthropic Text Editor tool commands: view, str_replace, create, insert.\n\n\nExported source\ndef str_replace_editor(**kwargs: dict[str, str]) -&gt; str:\n    'Dispatcher for Anthropic Text Editor tool commands: view, str_replace, create, insert, undo_edit.'\n    cmd = kwargs.pop('command', '')\n    if cmd == 'view': return view(**kwargs)\n    elif cmd == 'str_replace': return str_replace(**kwargs) \n    elif cmd == 'create': return create(**kwargs)\n    elif cmd == 'insert': return insert(**kwargs)\n    elif cmd == 'undo_edit': return 'Undo edit is not supported yet.'\n    else: return f'Unknown command: {cmd}'\n\ndef str_replace_based_edit_tool(**kwargs: dict[str, str]) -&gt; str:\n    'Dispatcher for Anthropic Text Editor tool commands: view, str_replace, create, insert.'\n    return str_replace_editor(**kwargs)\n\n\n\nsource\n\n\nstr_replace_editor\n\ndef str_replace_editor(\n    kwargs:dict\n)-&gt;str:\n\nDispatcher for Anthropic Text Editor tool commands: view, str_replace, create, insert, undo_edit.\n\nmodel = models[1]\n\n\nc = Chat(model, tools=[text_editor_conf['sonnet']], ns=mk_ns(str_replace_based_edit_tool))\n# c.toolloop('Please explain what my _quarto.yml does. Use your tools')",
    "crumbs": [
      "Text Editor"
    ]
  }
]